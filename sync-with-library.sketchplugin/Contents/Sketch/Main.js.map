{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports//Users/ooto/node_modules/@skpm/fs/index.js","webpack://exports//Users/ooto/node_modules/@skpm/fs/utils.js","webpack://exports/./node_modules/@skpm/promise/index.js","webpack://exports/./node_modules/d3-color/src/color.js","webpack://exports/./node_modules/d3-color/src/cubehelix.js","webpack://exports/./node_modules/d3-color/src/define.js","webpack://exports/./node_modules/d3-color/src/index.js","webpack://exports/./node_modules/d3-color/src/lab.js","webpack://exports/./node_modules/d3-color/src/math.js","webpack://exports/./node_modules/delta-e/src/dE00.js","webpack://exports/./node_modules/delta-e/src/dE76.js","webpack://exports/./node_modules/delta-e/src/dE94.js","webpack://exports/./node_modules/delta-e/src/index.js","webpack://exports/./node_modules/mocha-js-delegate/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/browser-api.js","webpack://exports/./node_modules/sketch-module-web-view/lib/constants.js","webpack://exports/./node_modules/sketch-module-web-view/lib/dispatch-first-click.js","webpack://exports/./node_modules/sketch-module-web-view/lib/execute-javascript.js","webpack://exports/./node_modules/sketch-module-web-view/lib/fitSubview.js","webpack://exports/./node_modules/sketch-module-web-view/lib/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/inject-client-messaging.js","webpack://exports/./node_modules/sketch-module-web-view/lib/movable-area.js","webpack://exports/./node_modules/sketch-module-web-view/lib/parseWebArguments.js","webpack://exports/./node_modules/sketch-module-web-view/lib/set-delegates.js","webpack://exports/./node_modules/sketch-module-web-view/lib/webview-api.js","webpack://exports/./node_modules/sketch-module-web-view/remote.js","webpack://exports/./resources/mergeduplicatelayerstyles.html","webpack://exports/./resources/mergeduplicatesymbols.html","webpack://exports/./resources/mergeduplicatetextstyles.html","webpack://exports/./resources/register.html","webpack://exports/./resources/settings.html","webpack://exports/./src/EditSettings.js","webpack://exports/./src/Helpers.js","webpack://exports/./src/Main.js","webpack://exports/./src/MergeDuplicateSymbols.js","webpack://exports/./src/MergeLayerStyles.js","webpack://exports/./src/MergeTextStyles.js","webpack://exports/external \"buffer\"","webpack://exports/external \"events\"","webpack://exports/external \"sketch/ui\""],"names":["Helpers","require","webviewEsIdentifier","globalSettingsFile","EditSettings","context","optionss","identifier","width","height","show","remembersWindowFrame","titleBarStyle","browserWindow","BrowserWindow","webContents","loadURL","getSettings","once","on","executeJavaScript","getLogsEnabled","getLibrariesEnabled","catch","console","error","s","clog","onShutdown","logsEnabled","_0xc104","jsonDef","MSPluginManager","webviewID","existingWebview","getWebview","close","DeltaE","fs","D3","settingsFile","librariesEnabledByDefault","valStatus","app","no","over","noCon","commands","mergeduplicatesymbols","mergeselectedsymbols","mergeselectedtextstyles","mergesimilartextstyles","mergeduplicatetextstyles","mergesimilarlayerstyles","mergeselectedlayerstyles","mergeduplicatelayerstyles","editsettings","sketchlocalfile","libraryPrefix","_0x28fb","curl_async","_0x1cd5x2","_0x1cd5x3","_0x1cd5x4","NSTask","_0x1cd5x5","NSPipe","_0x1cd5x6","_0x1cd5x7","_0x1cd5x8","_0x1cd5x9","NSString","NSUTF8StringEncoding","_0x1cd5xa","_0x1cd5xb","_0x1cd5xc","tryParseJSON","_0x4adb","IsInTrial","_0x2714x2","jsonFromFile","e","ExiGuthrie","_0x2714x4","Guthrie","_0x2714x6","_0x2714x7","_0x2714x8","toString","jsonString","o","JSON","parse","writeTextToFile","text","filePath","t","stringWithFormat","f","writeFileSync","stringify","encoding","readFromFile","readFileSync","mutable","read","GetTextBasedOnCount","number","shouldEnableContrastMode","color","UI","theme","getTheme","labReferenceColor","lab","labComparisonColor","color1","L","l","A","a","B","b","color2","deltaE","getDeltaE76","parseFloat","brightnessByColor","isHEX","indexOf","isRGB","m","substr","match","length","r","parseInt","g","containsIDOrViceversa","id1","id2","contains","splitId2","split","compareId2","replace","splitId1","compareId1","indexOfForeignStyle","array","style","index","i","remoteShareID","duplicates","j","positions","indexOfForeignStyle2","objectID","getColorDependingOnBrightness","colorBrightness","MSColor","colorWithRed_green_blue_alpha","isString","obj","isKindOfClass","getAlignment","alignment","containsTextStyle","textStyle","filter","containsLayerStyle","layerStyle","createView","frame","view","NSView","alloc","initWithFrame","getAllTextLayers","layers","NSMutableArray","document","pages","forEach","page","predicate","NSPredicate","predicateWithFormat","instances","children","filteredArrayUsingPredicate","instanceLoop","objectEnumerator","instance","nextObject","addObject","getAllLayers","createSeparator","separator","setWantsLayer","layer","setBackgroundColor","getColorDependingOnTheme","CGColorCreateGenericRGB","compareStyleArrays","name","compareSymbolNames","alreadyInList","originalStyle","localeCompare","getIndexOf","FindSimilarTextStyles","referenceStyle","styles","checkSameFont","checkSameWeight","checkSameSize","checkSameColor","checkSameParagraphSpacing","checkSameLineHeight","checkSameAlignment","checkSameCharacterSpacing","similarStyles","sameFont","attributes","NSFont","familyName","sameWeight","NSFontManager","sharedFontManager","weightOfFont_","sameSize","pointSize","sameColor","MSAttributedStringColorAttribute","hexValue","sameParagraphSpacing","NSParagraphStyle","paragraphSpacing","sameLineHeight","minimumLineHeight","sameAlignment","sameCharacterSpacing","NSKern","isSimilar","push","FindAllSimilarTextStyles","includeAllStylesFromExternalLibraries","stylesWithSimilarStyles","stylesAlreadyProcessed","definedTextStyles","getDefinedTextStyles","libraryName","thisStyleSimilarStyles","processedStyle","unshift","FindSimilarLayerStyles","checkSameFillColor","checkSameBorderColor","checkSameBorderThickness","checkSameShadowColor","checkSameShadowParams","sameFillColor","firstEnabledFill","immutableModelObject","sameBorderColor","firstEnabledBorder","sameBorderThickness","thickness","sameShadowColor","firstEnabledShadow","sameShadowParams","offsetX","offsetY","blurRadius","spread","FindAllSimilarLayerStyles","definedLayerStyles","getDefinedLayerStyles","styleName","textStyles","localTextStyles","documentData","layerTextStyles","objects","count","objectAtIndex","getTextStyleDescription","getTextThumbnail","getTextStyleColor","foreignTextStyles","localObject","indexOfForeign","foreignLib","getLibraryByID","libraryID","localShareID","correlativeStyles","libraries","NSApp","delegate","librariesController","availableLibraries","lib","enabled","libraryStyle","sort","GetRecomposedSymbolName","symbol","symbolName","recomposedSymbolName","charAt","getSymbolInstances","symbolMaster","symbolInstances","pageLoop","getSymbolOverrides","symbolOverrides","overrides","FindOverrideSymbolID","level","key","symbolID","IsForeign","refSymbol","foreignSymbols","countAllSymbols","includeAllSymbolsFromExternalLibraries","counter","allSymbols","sortArray","getDuplicateSymbols","selection","nameDictionary","alreadyAddedIDs","isForeign","foreignObject","symbolObject","counterLibs","counterLibSymbols","librarySymbol","existsAlready","Object","keys","splice","containsLibrarySymbols","GetSpecificLayerStyleData","layerStyles","thumbnail","getOvalThumbnail","GetSpecificTextStyleData","GetSpecificSymbolData","symbols","totalInstances","totalOverrides","getBase64","numInstances","numOverrides","textInfo","fontString","String","font","substring","formatInfo","getLayerStyleDescription","getLayerStyleColor","MSOvalShape","init","MSRect","rectWithRect","NSMakeRect","currentPage","addLayer","base64","removeFromParent","importForeignSymbol","library","objectReference","MSShareableObjectReference","referenceForShareableObject_inLibrary","AppController","sharedInstance","importShareableObjectReference_intoDocument","data","MSTextLayer","new","stringValue","getDuplicateLayerStyles","allStyles","localLayerStyle","layerStyleObject","foreignLayerStyles","foreignStyle","containsLibraryStyles","foreign","getDuplicateTextStyles","localTextStyle","textStyleObject","libID","localLayerStyles","getImageData64","imageData","mimeType","base64EncodedStringWithOptions","getNSImageData","nsImage","cgRef","CGImageForProposedRect_context_hints","nil","newRep","NSBitmapImageRep","initWithCGImage","setSize","size","pngData","representationUsingType_properties","NSPNGFileType","getThumbnail","element","exportRequest","MSExportRequest","exportRequestsFromExportableLayer_inRect_useIDForName_","absoluteInfluenceRect","firstObject","format","scaleX","rect","scaleY","scale","colorSpace","NSColorSpace","sRGBColorSpace","exporter","MSExporter","exporterForRequest_colorSpace_","imageRep","bitmapImageRep","image","NSImage","autorelease","addRepresentation","message","log","_0xedc5","LoadSettings","module","exports","MergeSymbols","MergeLayerStyles","MergeTextStyles","Settings","webviewRegIdentifier","globalRemainingDays","globalIsInTrial","globalIsExpired","globalIsOver","globalCommand","MergeDuplicateSymbols","onValidate","MergeDuplicateTextStyles","MergeDuplicateLayerStyles","_0x1647","_0x8a0ax2","_0x8a0ax3","triggerMethod","showRegistration","_0x8a0ax4","_0x8a0ax5","Date","_0x8a0ax6","_0x8a0ax7","Math","options","regWindow","webContentsReg","_0xff74","_0x5234x1","_0x5234x2","_0x5234x3","_0x5234x4","cog","NSWorkspace","sharedWorkspace","openURL","NSURL","URLWithString","webviewIdentifier","generateUUID","d","getTime","now","uuid","c","random","floor","GetSymbolsByName","matchingSymbols","FindSymbolInstances","originalSymbol","duplicateSymbolsByName","instancesPerSymbol","FindSymbolOverrides","overridesPerSymbol","symbolToMerge","symbolToKeep","symbolsIDsToRemove","symbolToApply","instancesChanged","overridesChanged","symbolsRemoved","externalLibrary","foreignSymbolReference","foreignSymbol","instancesOfSymbol","overridesOfSymbol","wasUnlinked","unlinkFromRemote","k","changeInstanceToSymbol","overridesToReplace","currentOverrides","NSMutableDictionary","dictionaryWithDictionary","overrideOuterKeys","allKeys","x","keyIndex","ascOverride","test","overrideInnerKeys","innerNewOverride","y","innerkeyIndex","shallbereplaced","overridePoints","overridePoint","setValue_forOverridePoint_","removeObject","duplicatedSymbols","mergeSession","numberOfSymbols","CalculateDuplicates","editedMergeSession","duplicatesSolved","mergedSymbols","mergeResults","symbolWithDuplicates","isUnchecked","selectedIndex","localMergeResults","replacedStuff","showMessage","webviewMDLSIdentifier","checkingAlsoLibraries","currentSelectedStyles","getLayerPredicate","styleToKeep","layersChangedCounter","overridesChangedCounter","layersWithOtherStyles","layersWithSameStyle","countercorrelative","predicateCorrelative","layersWithSameStyleCorrelative","instanceLoopCorrelative","instanceCorrelative","foreignStyleReference","setSharedStyle","localSharedStyle","UpdateLayerOverrides","removeSharedStyle","allSymbolInstances","symbolInstance","overridePointsToReplace","availableOverrides","availableOverride","allOverridesThatWeShouldReplace","getAllLayerOverridesThatWeShouldReplace","verbose","layerName","currentValue","defaultValue","child","layerStylesNames","layerDuplicatedStylesNames","onlyDuplicatedLayerStyles","layerStyleWithDuplicates","mergedStyles","affectedLayers","results","webviewMDTSIdentifier","getTextPredicate","UpdateTextOverrides","getAllTextOverridesThatWeShouldReplace","textStylesNames","onlyDuplicatedTextStyles","textStyleWithDuplicates"],"mappings":";;;;;;;;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA;AACA,aAAa,mBAAO,CAAC,sBAAQ;AAC7B,YAAY,mBAAO,CAAC,wDAAS;AAC7B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,OAAO;AAC1B;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB,kBAAkB;AACnC;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;AClbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9JA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA,aAAa,SAAS;AACtB;AACA,aAAa,kBAAkB;AAC/B;AACA,aAAa,kBAAkB;AAC/B;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC,SAAS;AAC9C;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;;AC9QA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA2C;;AAEpC;;AAEA;AACA;;AAEP;AACA;AACA;AACA,yBAAyB,IAAI;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,0DAAM;AACN;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA;;AAEO;AACP;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA;;AAEA,0DAAM,WAAW,yDAAM;AACvB;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,0DAAM,WAAW,yDAAM;AACvB;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClXA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA2C;AACyB;AACzB;;AAE3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,qBAAqB,6CAAG,OAAO,4DAAU;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,gDAAO;AACzC;AACA;;AAEe;AACf;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA;;AAEA,0DAAM,uBAAuB,yDAAM,CAAC,+CAAK;AACzC;AACA,oBAAoB,kDAAQ,YAAY,kDAAQ;AAChD;AACA,GAAG;AACH;AACA,oBAAoB,gDAAM,YAAY,gDAAM;AAC5C;AACA,GAAG;AACH;AACA,iDAAiD,gDAAO;AACxD;AACA;AACA;AACA;AACA,eAAe,6CAAG;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;;;AC5DD;AAAA;AAAe;AACf;AACA;AACA,CAAC;;AAEM;AACP;AACA;AACA;AACA;;;;;;;;;;;;;ACTA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAsD;AACE;AACJ;;;;;;;;;;;;;ACFpD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA2C;AACO;AACP;;AAE3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB,6CAAG,OAAO,4DAAU;AACzC;AACA;AACA;AACA;AACA,oCAAoC;AACpC;AACA;AACA;AACA;AACA;;AAEO;AACP;AACA;;AAEe;AACf;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA;;AAEA,0DAAM,WAAW,yDAAM,CAAC,+CAAK;AAC7B;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,6CAAG;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iCAAiC,gDAAO;AACxC;AACA;;AAEO;AACP;AACA;;AAEO;AACP;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,gDAAO;AACvB;AACA;;AAEA,0DAAM,WAAW,yDAAM,CAAC,+CAAK;AAC7B;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,CAAC;;;;;;;;;;;;;AC1HD;AAAA;AAAA;AAAO;AACA;;;;;;;;;;;;;ACDM;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB;AACA;AACA,QAAQ,iBAAiB;AACzB,QAAQ,kBAAkB;AAC1B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA,sB;;;;;;;;;;;;ACxTa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB;AACA;AACA,QAAQ,iBAAiB;AACzB,QAAQ,kBAAkB;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,sB;;;;;;;;;;;;AC7Ca;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB;AACA;AACA,QAAQ,iBAAiB;AACzB,QAAQ,kBAAkB;AAC1B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,sB;;;;;;;;;;;;AC3Ha;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB,oBAAoB;AACpB;AACA;AACA;AACA,WAAW,mBAAO,CAAC,kDAAQ;AAC3B,WAAW,mBAAO,CAAC,kDAAQ;AAC3B,WAAW,mBAAO,CAAC,kDAAQ;;AAE3B;;AAEA;AACA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,aAAa,OAAO;AACpB;AACA,oBAAoB;AACpB,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,aAAa,OAAO;AACpB;AACA,oBAAoB;AACpB,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,cAAc,OAAO;AACrB,aAAa,OAAO;AACpB;AACA,oBAAoB;AACpB,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,4B;;;;;;;;;;;ACjGA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc,wDAAwD,EAAE;AACxE;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,uCAAuC;AACvC;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,+BAA+B;AACnE;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,+BAA+B;AACtC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oCAAoC,aAAa;AACjD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AClmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,yCAAyC;AACzC,uDAAuD;AACvD,6DAA6D;AAC7D,+BAA+B;AAC/B,MAAM;AACN;AACA;AACA;AACA,QAAQ;AACR,gBAAgB;AAChB,MAAM,eAAe;AACrB,0CAA0C,cAAc;AACxD,MAAM;AACN;AACA;;;;;;;;;;;;ACzBA,+DAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,YAAY;AACZ,gCAAgC;AAChC,wFAAwF;AACxF,qCAAqC;AACrC;AACA;AACA,mBAAmB;AACnB,YAAY;AACZ,kCAAkC;AAClC;AACA;AACA,kBAAkB;AAClB,YAAY;AACZ,UAAU,OAAO;AACjB;AACA;AACA,kBAAkB;AAClB,UAAU;AACV,QAAQ,cAAc;AACtB;AACA;AACA,kBAAkB;AAClB,QAAQ;AACR,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrBA;AACA;AACA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,sBAAsB,mBAAO,CAAC,+EAAe;AAC7C,kBAAkB,mBAAO,CAAC,+EAAe;AACzC,uBAAuB,mBAAO,CAAC,6EAAc;AAC7C,yBAAyB,mBAAO,CAAC,iGAAwB;AACzD,4BAA4B,mBAAO,CAAC,uGAA2B;AAC/D,kBAAkB,mBAAO,CAAC,iFAAgB;AAC1C,wBAAwB,mBAAO,CAAC,6FAAsB;AACtD,mBAAmB,mBAAO,CAAC,mFAAiB;;AAE5C;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;ACxWA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,qDAAqD;AACrD,gDAAgD;AAChD,yBAAyB;AACzB;AACA,QAAQ;AACR,uDAAuD;AACvD,6CAA6C;AAC7C,0BAA0B;AAC1B,sDAAsD;AACtD;AACA;AACA,uBAAuB;AACvB;AACA;AACA,sBAAsB;AACtB;AACA;AACA,wCAAwC;AACxC,QAAQ,EAAE;AACV,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjCA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,mBAAmB;AACnB,yDAAyD;AACzD;AACA,kCAAkC;AAClC,2CAA2C,4BAA4B,eAAe;AACtF,gCAAgC,yBAAyB,cAAc;AACvE;AACA,OAAO;AACP;AACA,8BAA8B;AAC9B,qDAAqD,SAAS;AAC9D;AACA;AACA,QAAQ;AACR,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;;;;;;;;;;;;AC/DA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AClBA,+DAAgB,mBAAO,CAAC,oEAAmB;AAC3C,wBAAwB,mBAAO,CAAC,2FAAqB;AACrD,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,2CAA2C;AAC3C,OAAO;;AAEP;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;;AAEH;AACA,+DAA+D;AAC/D;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,sBAAsB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,OAAO;AACP;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;;;;;;;;;;;;AChZA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,wBAAwB,mBAAO,CAAC,6FAAsB;;AAEtD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;AACA,QAAQ,kCAAkC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;ACrOA;AACA;;AAEA;AACA,SAAS,mBAAO,CAAC,iEAAO;AACxB;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AClCA,gM;;;;;;;;;;;ACA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","file":"Main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/Main.js\");\n","// TODO: async. Should probably be done with NSFileHandle and some notifications\n// TODO: file descriptor. Needs to be done with NSFileHandle\nvar Buffer = require(\"buffer\").Buffer;\nvar utils = require(\"./utils\");\nvar parseStat = utils.parseStat;\nvar fsError = utils.fsError;\nvar fsErrorForPath = utils.fsErrorForPath;\nvar encodingFromOptions = utils.encodingFromOptions;\nvar NOT_IMPLEMENTED = utils.NOT_IMPLEMENTED;\n\nmodule.exports.constants = {\n  F_OK: 0,\n  R_OK: 4,\n  W_OK: 2,\n  X_OK: 1\n};\n\nmodule.exports.access = NOT_IMPLEMENTED(\"access\");\n\nmodule.exports.accessSync = function(path, mode) {\n  mode = mode | 0;\n  var fileManager = NSFileManager.defaultManager();\n\n  switch (mode) {\n    case 0:\n      canAccess = module.exports.existsSync(path);\n      break;\n    case 1:\n      canAccess = Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n    case 2:\n      canAccess = Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 3:\n      canAccess =\n        Boolean(Number(fileManager.isExecutableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 4:\n      canAccess = Boolean(Number(fileManager.isReadableFileAtPath(path)));\n      break;\n    case 5:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n    case 6:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path)));\n      break;\n    case 7:\n      canAccess =\n        Boolean(Number(fileManager.isReadableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isWritableFileAtPath(path))) &&\n        Boolean(Number(fileManager.isExecutableFileAtPath(path)));\n      break;\n  }\n\n  if (!canAccess) {\n    throw new Error(\"Can't access \" + String(path));\n  }\n};\n\nmodule.exports.appendFile = NOT_IMPLEMENTED(\"appendFile\");\n\nmodule.exports.appendFileSync = function(file, data, options) {\n  if (!module.exports.existsSync(file)) {\n    return module.exports.writeFileSync(file, data, options);\n  }\n\n  var handle = NSFileHandle.fileHandleForWritingAtPath(file);\n  handle.seekToEndOfFile();\n\n  var encoding = encodingFromOptions(options, \"utf8\");\n\n  var nsdata = Buffer.from(\n    data,\n    encoding === \"NSData\" || encoding === \"buffer\" ? undefined : encoding\n  ).toNSData();\n\n  handle.writeData(nsdata);\n};\n\nmodule.exports.chmod = NOT_IMPLEMENTED(\"chmod\");\n\nmodule.exports.chmodSync = function(path, mode) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.setAttributes_ofItemAtPath_error(\n    {\n      NSFilePosixPermissions: mode\n    },\n    path,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n};\n\nmodule.exports.chown = NOT_IMPLEMENTED(\"chown\");\nmodule.exports.chownSync = NOT_IMPLEMENTED(\"chownSync\");\n\nmodule.exports.close = NOT_IMPLEMENTED(\"close\");\nmodule.exports.closeSync = NOT_IMPLEMENTED(\"closeSync\");\n\nmodule.exports.copyFile = NOT_IMPLEMENTED(\"copyFile\");\n\nmodule.exports.copyFileSync = function(path, dest, flags) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.copyItemAtPath_toPath_error(path, dest, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, false, err.value());\n  }\n};\n\nmodule.exports.createReadStream = NOT_IMPLEMENTED(\"createReadStream\");\nmodule.exports.createWriteStream = NOT_IMPLEMENTED(\"createWriteStream\");\n\nmodule.exports.exists = NOT_IMPLEMENTED(\"exists\");\n\nmodule.exports.existsSync = function(path) {\n  var fileManager = NSFileManager.defaultManager();\n  return Boolean(Number(fileManager.fileExistsAtPath(path)));\n};\n\nmodule.exports.fchmod = NOT_IMPLEMENTED(\"fchmod\");\nmodule.exports.fchmodSync = NOT_IMPLEMENTED(\"fchmodSync\");\nmodule.exports.fchown = NOT_IMPLEMENTED(\"fchown\");\nmodule.exports.fchownSync = NOT_IMPLEMENTED(\"fchownSync\");\nmodule.exports.fdatasync = NOT_IMPLEMENTED(\"fdatasync\");\nmodule.exports.fdatasyncSync = NOT_IMPLEMENTED(\"fdatasyncSync\");\nmodule.exports.fstat = NOT_IMPLEMENTED(\"fstat\");\nmodule.exports.fstatSync = NOT_IMPLEMENTED(\"fstatSync\");\nmodule.exports.fsync = NOT_IMPLEMENTED(\"fsync\");\nmodule.exports.fsyncSync = NOT_IMPLEMENTED(\"fsyncSync\");\nmodule.exports.ftruncate = NOT_IMPLEMENTED(\"ftruncate\");\nmodule.exports.ftruncateSync = NOT_IMPLEMENTED(\"ftruncateSync\");\nmodule.exports.futimes = NOT_IMPLEMENTED(\"futimes\");\nmodule.exports.futimesSync = NOT_IMPLEMENTED(\"futimesSync\");\n\nmodule.exports.lchmod = NOT_IMPLEMENTED(\"lchmod\");\nmodule.exports.lchmodSync = NOT_IMPLEMENTED(\"lchmodSync\");\nmodule.exports.lchown = NOT_IMPLEMENTED(\"lchown\");\nmodule.exports.lchownSync = NOT_IMPLEMENTED(\"lchownSync\");\n\nmodule.exports.link = NOT_IMPLEMENTED(\"link\");\n\nmodule.exports.linkSync = function(existingPath, newPath) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.linkItemAtPath_toPath_error(existingPath, newPath, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(existingPath, undefined, err.value());\n  }\n};\n\nmodule.exports.lstat = NOT_IMPLEMENTED(\"lstat\");\n\nmodule.exports.lstatSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.attributesOfItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n\n  return parseStat(result);\n};\n\nmodule.exports.mkdir = NOT_IMPLEMENTED(\"mkdir\");\n\nmodule.exports.mkdirSync = function(path, options) {\n  var mode = 0o777;\n  var recursive = false;\n  if (options && options.mode) {\n    mode = options.mode;\n  }\n  if (options && options.recursive) {\n    recursive = options.recursive;\n  }\n  if (typeof options === \"number\") {\n    mode = options;\n  }\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.createDirectoryAtPath_withIntermediateDirectories_attributes_error(\n    path,\n    recursive,\n    {\n      NSFilePosixPermissions: mode\n    },\n    err\n  );\n\n  if (err.value() !== null) {\n    throw new Error(err.value());\n  }\n};\n\nmodule.exports.mkdtemp = NOT_IMPLEMENTED(\"mkdtemp\");\n\nmodule.exports.mkdtempSync = function(path) {\n  function makeid() {\n    var text = \"\";\n    var possible =\n      \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n    for (var i = 0; i < 6; i++)\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n\n    return text;\n  }\n  var tempPath = path + makeid();\n  module.exports.mkdirSync(tempPath);\n  return tempPath;\n};\n\nmodule.exports.open = NOT_IMPLEMENTED(\"open\");\nmodule.exports.openSync = NOT_IMPLEMENTED(\"openSync\");\n\nmodule.exports.read = NOT_IMPLEMENTED(\"read\");\n\nmodule.exports.readdir = NOT_IMPLEMENTED(\"readdir\");\n\nmodule.exports.readdirSync = function(path, options) {\n  var encoding = encodingFromOptions(options, \"utf8\");\n  var fileManager = NSFileManager.defaultManager();\n  var paths = fileManager.subpathsAtPath(path);\n  var arr = [];\n  for (var i = 0; i < paths.length; i++) {\n    var pathName = paths[i];\n    arr.push(encoding === \"buffer\" ? Buffer.from(pathName) : String(pathName));\n  }\n  return arr;\n};\n\nmodule.exports.readFile = NOT_IMPLEMENTED(\"readFile\");\n\nmodule.exports.readFileSync = function(path, options) {\n  var encoding = encodingFromOptions(options, \"buffer\");\n  var fileManager = NSFileManager.defaultManager();\n  var data = fileManager.contentsAtPath(path);\n  if (!data) {\n    throw fsErrorForPath(path, false);\n  }\n\n  var buffer = Buffer.from(data);\n\n  if (encoding === \"buffer\") {\n    return buffer;\n  } else if (encoding === \"NSData\") {\n    return buffer.toNSData();\n  } else {\n    return buffer.toString(encoding);\n  }\n};\n\nmodule.exports.readlink = NOT_IMPLEMENTED(\"readlink\");\n\nmodule.exports.readlinkSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.destinationOfSymbolicLinkAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n\n  return String(result);\n};\n\nmodule.exports.readSync = NOT_IMPLEMENTED(\"readSync\");\n\nmodule.exports.realpath = NOT_IMPLEMENTED(\"realpath\");\nmodule.exports.realpath.native = NOT_IMPLEMENTED(\"realpath.native\");\n\nmodule.exports.realpathSync = function(path) {\n  return String(NSString.stringWithString(path).stringByResolvingSymlinksInPath());\n};\n\nmodule.exports.realpathSync.native = NOT_IMPLEMENTED(\"realpathSync.native\");\n\nmodule.exports.rename = NOT_IMPLEMENTED(\"rename\");\n\nmodule.exports.renameSync = function(oldPath, newPath) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  fileManager.moveItemAtPath_toPath_error(oldPath, newPath, err);\n\n  var error = err.value();\n\n  if (error !== null) {\n    // if there is already a file, we need to overwrite it\n    if (\n      String(error.domain()) === \"NSCocoaErrorDomain\" &&\n      Number(error.code()) === 516\n    ) {\n      var err2 = MOPointer.alloc().init();\n      fileManager.replaceItemAtURL_withItemAtURL_backupItemName_options_resultingItemURL_error(\n        NSURL.fileURLWithPath(newPath),\n        NSURL.fileURLWithPath(oldPath),\n        null,\n        NSFileManagerItemReplacementUsingNewMetadataOnly,\n        null,\n        err2\n      );\n      if (err2.value() !== null) {\n        throw fsErrorForPath(oldPath, undefined, err2.value());\n      }\n    } else {\n      throw fsErrorForPath(oldPath, undefined, error);\n    }\n  }\n};\n\nmodule.exports.rmdir = NOT_IMPLEMENTED(\"rmdir\");\n\nmodule.exports.rmdirSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var isDirectory = module.exports.lstatSync(path).isDirectory();\n  if (!isDirectory) {\n    throw fsError(\"ENOTDIR\", {\n      path: path,\n      syscall: \"rmdir\"\n    });\n  }\n  fileManager.removeItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, true, err.value(), \"rmdir\");\n  }\n};\n\nmodule.exports.stat = NOT_IMPLEMENTED(\"stat\");\n\n// the only difference with lstat is that we resolve symlinks\n//\n// > lstat() is identical to stat(), except that if pathname is a symbolic\n// > link, then it returns information about the link itself, not the file\n// > that it refers to.\n// http://man7.org/linux/man-pages/man2/lstat.2.html\nmodule.exports.statSync = function(path) {\n  return module.exports.lstatSync(module.exports.realpathSync(path));\n};\n\nmodule.exports.symlink = NOT_IMPLEMENTED(\"symlink\");\n\nmodule.exports.symlinkSync = function(target, path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.createSymbolicLinkAtPath_withDestinationPath_error(\n    path,\n    target,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw new Error(err.value());\n  }\n};\n\nmodule.exports.truncate = NOT_IMPLEMENTED(\"truncate\");\n\nmodule.exports.truncateSync = function(path, len) {\n  var hFile = NSFileHandle.fileHandleForUpdatingAtPath(sFilePath);\n  hFile.truncateFileAtOffset(len || 0);\n  hFile.closeFile();\n};\n\nmodule.exports.unlink = NOT_IMPLEMENTED(\"unlink\");\n\nmodule.exports.unlinkSync = function(path) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var isDirectory = module.exports.lstatSync(path).isDirectory();\n  if (isDirectory) {\n    throw fsError(\"EPERM\", {\n      path: path,\n      syscall: \"unlink\"\n    });\n  }\n  var result = fileManager.removeItemAtPath_error(path, err);\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, false, err.value());\n  }\n};\n\nmodule.exports.unwatchFile = NOT_IMPLEMENTED(\"unwatchFile\");\n\nmodule.exports.utimes = NOT_IMPLEMENTED(\"utimes\");\n\nmodule.exports.utimesSync = function(path, aTime, mTime) {\n  var err = MOPointer.alloc().init();\n  var fileManager = NSFileManager.defaultManager();\n  var result = fileManager.setAttributes_ofItemAtPath_error(\n    {\n      NSFileModificationDate: aTime\n    },\n    path,\n    err\n  );\n\n  if (err.value() !== null) {\n    throw fsErrorForPath(path, undefined, err.value());\n  }\n};\n\nmodule.exports.watch = NOT_IMPLEMENTED(\"watch\");\nmodule.exports.watchFile = NOT_IMPLEMENTED(\"watchFile\");\n\nmodule.exports.write = NOT_IMPLEMENTED(\"write\");\n\nmodule.exports.writeFile = NOT_IMPLEMENTED(\"writeFile\");\n\nmodule.exports.writeFileSync = function(path, data, options) {\n  var encoding = encodingFromOptions(options, \"utf8\");\n\n  var nsdata = Buffer.from(\n    data,\n    encoding === \"NSData\" || encoding === \"buffer\" ? undefined : encoding\n  ).toNSData();\n\n  nsdata.writeToFile_atomically(path, true);\n};\n\nmodule.exports.writeSync = NOT_IMPLEMENTED(\"writeSync\");\n","module.exports.parseStat = function parseStat(result) {\n  return {\n    dev: String(result.NSFileDeviceIdentifier),\n    // ino: 48064969, The file system specific \"Inode\" number for the file.\n    mode: result.NSFileType | result.NSFilePosixPermissions,\n    nlink: Number(result.NSFileReferenceCount),\n    uid: String(result.NSFileOwnerAccountID),\n    gid: String(result.NSFileGroupOwnerAccountID),\n    // rdev: 0, A numeric device identifier if the file is considered \"special\".\n    size: Number(result.NSFileSize),\n    // blksize: 4096, The file system block size for i/o operations.\n    // blocks: 8, The number of blocks allocated for this file.\n    atimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    mtimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    ctimeMs:\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000,\n    birthtimeMs:\n      Number(result.NSFileCreationDate.timeIntervalSince1970()) * 1000,\n    atime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ), // the 0.5 comes from the node source. Not sure why it's added but in doubt...\n    mtime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    ctime: new Date(\n      Number(result.NSFileModificationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    birthtime: new Date(\n      Number(result.NSFileCreationDate.timeIntervalSince1970()) * 1000 + 0.5\n    ),\n    isBlockDevice: function() {\n      return result.NSFileType === NSFileTypeBlockSpecial;\n    },\n    isCharacterDevice: function() {\n      return result.NSFileType === NSFileTypeCharacterSpecial;\n    },\n    isDirectory: function() {\n      return result.NSFileType === NSFileTypeDirectory;\n    },\n    isFIFO: function() {\n      return false;\n    },\n    isFile: function() {\n      return result.NSFileType === NSFileTypeRegular;\n    },\n    isSocket: function() {\n      return result.NSFileType === NSFileTypeSocket;\n    },\n    isSymbolicLink: function() {\n      return result.NSFileType === NSFileTypeSymbolicLink;\n    }\n  };\n};\n\nvar ERRORS = {\n  EPERM: {\n    message: \"operation not permitted\",\n    errno: -1\n  },\n  ENOENT: {\n    message: \"no such file or directory\",\n    errno: -2\n  },\n  EACCES: {\n    message: \"permission denied\",\n    errno: -13\n  },\n  ENOTDIR: {\n    message: \"not a directory\",\n    errno: -20\n  },\n  EISDIR: {\n    message: \"illegal operation on a directory\",\n    errno: -21\n  }\n};\n\nfunction fsError(code, options) {\n  var error = new Error(\n    code +\n      \": \" +\n      ERRORS[code].message +\n      \", \" +\n      (options.syscall || \"\") +\n      (options.path ? \" '\" + options.path + \"'\" : \"\")\n  );\n\n  Object.keys(options).forEach(function(k) {\n    error[k] = options[k];\n  });\n\n  error.code = code;\n  error.errno = ERRORS[code].errno;\n\n  return error;\n}\n\nmodule.exports.fsError = fsError;\n\nmodule.exports.fsErrorForPath = function fsErrorForPath(\n  path,\n  shouldBeDir,\n  err,\n  syscall\n) {\n  var fileManager = NSFileManager.defaultManager();\n  var doesExist = fileManager.fileExistsAtPath(path);\n  if (!doesExist) {\n    return fsError(\"ENOENT\", {\n      path: path,\n      syscall: syscall || \"open\"\n    });\n  }\n  var isReadable = fileManager.isReadableFileAtPath(path);\n  if (!isReadable) {\n    return fsError(\"EACCES\", {\n      path: path,\n      syscall: syscall || \"open\"\n    });\n  }\n  if (typeof shouldBeDir !== \"undefined\") {\n    var isDirectory = module.exports.lstatSync(path).isDirectory();\n    if (isDirectory && !shouldBeDir) {\n      return fsError(\"EISDIR\", {\n        path: path,\n        syscall: syscall || \"read\"\n      });\n    } else if (!isDirectory && shouldBeDir) {\n      return fsError(\"ENOTDIR\", {\n        path: path,\n        syscall: syscall || \"read\"\n      });\n    }\n  }\n  return new Error(err || \"Unknown error while manipulating \" + path);\n};\n\nmodule.exports.encodingFromOptions = function encodingFromOptions(\n  options,\n  defaultValue\n) {\n  return options && options.encoding\n    ? String(options.encoding)\n    : options\n    ? String(options)\n    : defaultValue;\n};\n\nmodule.exports.NOT_IMPLEMENTED = function NOT_IMPLEMENTED(name) {\n  return function() {\n    throw new Error(\n      \"fs.\" +\n        name +\n        \" is not implemented yet. If you feel like implementing it, any contribution will be gladly accepted on https://github.com/skpm/fs\"\n    );\n  };\n};\n","/* from https://github.com/taylorhakes/promise-polyfill */\n\nfunction promiseFinally(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nfunction noop() {}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError(\"Promises must be constructed via new\");\n  if (typeof fn !== \"function\") throw new TypeError(\"not a function\");\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError(\"A promise cannot be resolved with itself.\");\n    if (\n      newValue &&\n      (typeof newValue === \"object\" || typeof newValue === \"function\")\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === \"function\") {\n        doResolve(then.bind(newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value, self);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : null;\n  this.onRejected = typeof onRejected === \"function\" ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) {\n          Promise._multipleResolvesFn(\"resolve\", self, value);\n          return;\n        }\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) {\n          Promise._multipleResolvesFn(\"reject\", self, reason);\n          return;\n        }\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) {\n      Promise._multipleResolvesFn(\"reject\", self, ex);\n      return;\n    }\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype[\"catch\"] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype[\"finally\"] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!Array.isArray(arr)) {\n      return reject(new TypeError(\"Promise.all accepts an array\"));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === \"object\" || typeof val === \"function\")) {\n          var then = val.then;\n          if (typeof then === \"function\") {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === \"object\" && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!Array.isArray(arr)) {\n      return reject(new TypeError(\"Promise.race accepts an array\"));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn = setImmediate;\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err, promise) {\n  if (\n    typeof process !== \"undefined\" &&\n    process.listenerCount &&\n    (process.listenerCount(\"unhandledRejection\") ||\n      process.listenerCount(\"uncaughtException\"))\n  ) {\n    process.emit(\"unhandledRejection\", err, promise);\n    process.emit(\"uncaughtException\", err, \"unhandledRejection\");\n  } else if (typeof console !== \"undefined\" && console) {\n    console.warn(\"Possible Unhandled Promise Rejection:\", err);\n  }\n};\n\nPromise._multipleResolvesFn = function _multipleResolvesFn(\n  type,\n  promise,\n  value\n) {\n  if (typeof process !== \"undefined\" && process.emit) {\n    process.emit(\"multipleResolves\", type, promise, value);\n  }\n};\n\nmodule.exports = Promise;\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(\"^rgb\\\\(\" + [reI, reI, reI] + \"\\\\)$\"),\n    reRgbPercent = new RegExp(\"^rgb\\\\(\" + [reP, reP, reP] + \"\\\\)$\"),\n    reRgbaInteger = new RegExp(\"^rgba\\\\(\" + [reI, reI, reI, reN] + \"\\\\)$\"),\n    reRgbaPercent = new RegExp(\"^rgba\\\\(\" + [reP, reP, reP, reN] + \"\\\\)$\"),\n    reHslPercent = new RegExp(\"^hsl\\\\(\" + [reN, reP, reP] + \"\\\\)$\"),\n    reHslaPercent = new RegExp(\"^hsla\\\\(\" + [reN, reP, reP, reN] + \"\\\\)$\");\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy: function(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable: function() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb: function() {\n    return this;\n  },\n  displayable: function() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return \"#\" + hex(this.r) + hex(this.g) + hex(this.b);\n}\n\nfunction rgb_formatRgb() {\n  var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n  return (a === 1 ? \"rgb(\" : \"rgba(\")\n      + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.b) || 0))\n      + (a === 1 ? \")\" : \", \" + a + \")\");\n}\n\nfunction hex(value) {\n  value = Math.max(0, Math.min(255, Math.round(value) || 0));\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  displayable: function() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl: function() {\n    var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n    return (a === 1 ? \"hsl(\" : \"hsla(\")\n        + (this.h || 0) + \", \"\n        + (this.s || 0) * 100 + \"%, \"\n        + (this.l || 0) * 100 + \"%\"\n        + (a === 1 ? \")\" : \", \" + a + \")\");\n  }\n}));\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb, darker, brighter} from \"./color.js\";\nimport {deg2rad, rad2deg} from \"./math.js\";\n\nvar A = -0.14861,\n    B = +1.78277,\n    C = -0.29227,\n    D = -0.90649,\n    E = +1.97294,\n    ED = E * D,\n    EB = E * B,\n    BC_DA = B * C - D * A;\n\nfunction cubehelixConvert(o) {\n  if (o instanceof Cubehelix) return new Cubehelix(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      l = (BC_DA * b + ED * r - EB * g) / (BC_DA + ED - EB),\n      bl = b - l,\n      k = (E * (g - l) - C * bl) / D,\n      s = Math.sqrt(k * k + bl * bl) / (E * l * (1 - l)), // NaN if l=0 or l=1\n      h = s ? Math.atan2(k, bl) * rad2deg - 120 : NaN;\n  return new Cubehelix(h < 0 ? h + 360 : h, s, l, o.opacity);\n}\n\nexport default function cubehelix(h, s, l, opacity) {\n  return arguments.length === 1 ? cubehelixConvert(h) : new Cubehelix(h, s, l, opacity == null ? 1 : opacity);\n}\n\nexport function Cubehelix(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Cubehelix, cubehelix, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = isNaN(this.h) ? 0 : (this.h + 120) * deg2rad,\n        l = +this.l,\n        a = isNaN(this.s) ? 0 : this.s * l * (1 - l),\n        cosh = Math.cos(h),\n        sinh = Math.sin(h);\n    return new Rgb(\n      255 * (l + a * (A * cosh + B * sinh)),\n      255 * (l + a * (C * cosh + D * sinh)),\n      255 * (l + a * (E * cosh)),\n      this.opacity\n    );\n  }\n}));\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","export {default as color, rgb, hsl} from \"./color.js\";\nexport {default as lab, hcl, lch, gray} from \"./lab.js\";\nexport {default as cubehelix} from \"./cubehelix.js\";\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb} from \"./color.js\";\nimport {deg2rad, rad2deg} from \"./math.js\";\n\n// https://observablehq.com/@mbostock/lab-and-rgb\nvar K = 18,\n    Xn = 0.96422,\n    Yn = 1,\n    Zn = 0.82521,\n    t0 = 4 / 29,\n    t1 = 6 / 29,\n    t2 = 3 * t1 * t1,\n    t3 = t1 * t1 * t1;\n\nfunction labConvert(o) {\n  if (o instanceof Lab) return new Lab(o.l, o.a, o.b, o.opacity);\n  if (o instanceof Hcl) return hcl2lab(o);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = rgb2lrgb(o.r),\n      g = rgb2lrgb(o.g),\n      b = rgb2lrgb(o.b),\n      y = xyz2lab((0.2225045 * r + 0.7168786 * g + 0.0606169 * b) / Yn), x, z;\n  if (r === g && g === b) x = z = y; else {\n    x = xyz2lab((0.4360747 * r + 0.3850649 * g + 0.1430804 * b) / Xn);\n    z = xyz2lab((0.0139322 * r + 0.0971045 * g + 0.7141733 * b) / Zn);\n  }\n  return new Lab(116 * y - 16, 500 * (x - y), 200 * (y - z), o.opacity);\n}\n\nexport function gray(l, opacity) {\n  return new Lab(l, 0, 0, opacity == null ? 1 : opacity);\n}\n\nexport default function lab(l, a, b, opacity) {\n  return arguments.length === 1 ? labConvert(l) : new Lab(l, a, b, opacity == null ? 1 : opacity);\n}\n\nexport function Lab(l, a, b, opacity) {\n  this.l = +l;\n  this.a = +a;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Lab, lab, extend(Color, {\n  brighter: function(k) {\n    return new Lab(this.l + K * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  darker: function(k) {\n    return new Lab(this.l - K * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  rgb: function() {\n    var y = (this.l + 16) / 116,\n        x = isNaN(this.a) ? y : y + this.a / 500,\n        z = isNaN(this.b) ? y : y - this.b / 200;\n    x = Xn * lab2xyz(x);\n    y = Yn * lab2xyz(y);\n    z = Zn * lab2xyz(z);\n    return new Rgb(\n      lrgb2rgb( 3.1338561 * x - 1.6168667 * y - 0.4906146 * z),\n      lrgb2rgb(-0.9787684 * x + 1.9161415 * y + 0.0334540 * z),\n      lrgb2rgb( 0.0719453 * x - 0.2289914 * y + 1.4052427 * z),\n      this.opacity\n    );\n  }\n}));\n\nfunction xyz2lab(t) {\n  return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\n}\n\nfunction lab2xyz(t) {\n  return t > t1 ? t * t * t : t2 * (t - t0);\n}\n\nfunction lrgb2rgb(x) {\n  return 255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055);\n}\n\nfunction rgb2lrgb(x) {\n  return (x /= 255) <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\n}\n\nfunction hclConvert(o) {\n  if (o instanceof Hcl) return new Hcl(o.h, o.c, o.l, o.opacity);\n  if (!(o instanceof Lab)) o = labConvert(o);\n  if (o.a === 0 && o.b === 0) return new Hcl(NaN, 0 < o.l && o.l < 100 ? 0 : NaN, o.l, o.opacity);\n  var h = Math.atan2(o.b, o.a) * rad2deg;\n  return new Hcl(h < 0 ? h + 360 : h, Math.sqrt(o.a * o.a + o.b * o.b), o.l, o.opacity);\n}\n\nexport function lch(l, c, h, opacity) {\n  return arguments.length === 1 ? hclConvert(l) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function hcl(h, c, l, opacity) {\n  return arguments.length === 1 ? hclConvert(h) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function Hcl(h, c, l, opacity) {\n  this.h = +h;\n  this.c = +c;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\nfunction hcl2lab(o) {\n  if (isNaN(o.h)) return new Lab(o.l, 0, 0, o.opacity);\n  var h = o.h * deg2rad;\n  return new Lab(o.l, Math.cos(h) * o.c, Math.sin(h) * o.c, o.opacity);\n}\n\ndefine(Hcl, hcl, extend(Color, {\n  brighter: function(k) {\n    return new Hcl(this.h, this.c, this.l + K * (k == null ? 1 : k), this.opacity);\n  },\n  darker: function(k) {\n    return new Hcl(this.h, this.c, this.l - K * (k == null ? 1 : k), this.opacity);\n  },\n  rgb: function() {\n    return hcl2lab(this).rgb();\n  }\n}));\n","export var deg2rad = Math.PI / 180;\nexport var rad2deg = 180 / Math.PI;\n","'use strict';\r\n\r\n/**\r\n * @class dE00\r\n * @classdesc\r\n * The CIE2000 color difference algorithm.\r\n * http://en.wikipedia.org/wiki/Color_difference#CIEDE2000\r\n * @constructs dE00\r\n * @memberOf DeltaE\r\n * @property {object} x1 The LAB color configuration object.\r\n * @property {number} x1.L The lightness value, on scale of 0-100.\r\n * @property {number} x1.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x1.B The hue value, on scale of -128 to 128.\r\n * @property {object} x2 The LAB color configuration object.\r\n * @property {number} x2.L The lightness value, on scale of 0-100.\r\n * @property {number} x2.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x2.B The hue value, on scale of -128 to 128.\r\n * @property {object} weights The weights configuration object.\r\n * @property {number} weights.lightness A weight factor to apply to lightness.\r\n * @property {number} weights.chroma A weight factor to apply to chroma.\r\n * @property {number} weights.hue A weight factor to apply to hue.\r\n * @example\r\n * var deltaE = new dE00(\r\n *     {L:50, A:50, B:50},\r\n *     {L:100, A:50, B:50},\r\n * );\r\n * console.log(deltaE.getDeltaE());\r\n */\r\nfunction dE00(x1, x2, weights) {\r\n    var sqrt = Math.sqrt;\r\n    var pow = Math.pow;\r\n    \r\n    this.x1 = x1;\r\n    this.x2 = x2;\r\n    \r\n    this.weights = weights || {};\r\n    this.ksubL = this.weights.lightness || 1;\r\n    this.ksubC = this.weights.chroma || 1;\r\n    this.ksubH = this.weights.hue || 1;\r\n    \r\n    // Delta L Prime\r\n    this.deltaLPrime = x2.L - x1.L;\r\n    \r\n    // L Bar\r\n    this.LBar = (x1.L + x2.L) / 2;\r\n    \r\n    // C1 & C2\r\n    this.C1 = sqrt(pow(x1.A, 2) + pow(x1.B, 2));\r\n    this.C2 = sqrt(pow(x2.A, 2) + pow(x2.B, 2));\r\n    \r\n    // C Bar\r\n    this.CBar = (this.C1 + this.C2) / 2;\r\n    \r\n    // A Prime 1\r\n    this.aPrime1 = x1.A +\r\n        (x1.A / 2) *\r\n        (1 - sqrt(\r\n            pow(this.CBar, 7) /\r\n            (pow(this.CBar, 7) + pow(25, 7))\r\n        ));\r\n\r\n    // A Prime 2\r\n    this.aPrime2 = x2.A +\r\n        (x2.A / 2) *\r\n        (1 - sqrt(\r\n            pow(this.CBar, 7) /\r\n            (pow(this.CBar, 7) + pow(25, 7))\r\n        ));\r\n\r\n    // C Prime 1\r\n    this.CPrime1 = sqrt(\r\n        pow(this.aPrime1, 2) +\r\n        pow(x1.B, 2)\r\n    );\r\n    \r\n    // C Prime 2\r\n    this.CPrime2 = sqrt(\r\n        pow(this.aPrime2, 2) +\r\n        pow(x2.B, 2)\r\n    );\r\n    \r\n    // C Bar Prime\r\n    this.CBarPrime = (this.CPrime1 + this.CPrime2) / 2;\r\n    \r\n    // Delta C Prime\r\n    this.deltaCPrime = this.CPrime2 - this.CPrime1;\r\n    \r\n    // S sub L\r\n    this.SsubL = 1 + (\r\n        (0.015 * pow(this.LBar - 50, 2)) /\r\n        sqrt(20 + pow(this.LBar - 50, 2))\r\n    );\r\n    \r\n    // S sub C\r\n    this.SsubC = 1 + 0.045 * this.CBarPrime;\r\n    \r\n    /**\r\n     * Properties set in getDeltaE method, for access to convenience functions\r\n     */\r\n    // h Prime 1\r\n    this.hPrime1 = 0;\r\n    \r\n    // h Prime 2\r\n    this.hPrime2 = 0;\r\n    \r\n    // Delta h Prime\r\n    this.deltahPrime = 0;\r\n    \r\n    // Delta H Prime\r\n    this.deltaHPrime = 0;\r\n    \r\n    // H Bar Prime\r\n    this.HBarPrime = 0;\r\n    \r\n    // T\r\n    this.T = 0;\r\n    \r\n    // S sub H\r\n    this.SsubH = 0;\r\n    \r\n    // R sub T\r\n    this.RsubT = 0;\r\n}\r\n\r\n/**\r\n * Returns the deltaE value.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.getDeltaE = function() {\r\n    var sqrt = Math.sqrt;\r\n    var sin = Math.sin;\r\n    var pow = Math.pow;\r\n    \r\n    // h Prime 1\r\n    this.hPrime1 = this.gethPrime1();\r\n    \r\n    // h Prime 2\r\n    this.hPrime2 = this.gethPrime2();\r\n    \r\n    // Delta h Prime\r\n    this.deltahPrime = this.getDeltahPrime();\r\n    \r\n    // Delta H Prime\r\n    this.deltaHPrime = 2 * sqrt(this.CPrime1 * this.CPrime2) * sin(this.degreesToRadians(this.deltahPrime) / 2);\r\n    \r\n    // H Bar Prime\r\n    this.HBarPrime = this.getHBarPrime();\r\n    \r\n    // T\r\n    this.T = this.getT();\r\n    \r\n    // S sub H\r\n    this.SsubH = 1 + 0.015 * this.CBarPrime * this.T;\r\n    \r\n    // R sub T\r\n    this.RsubT = this.getRsubT();\r\n    \r\n    // Put it all together!\r\n    var lightness = this.deltaLPrime / (this.ksubL * this.SsubL);\r\n    var chroma = this.deltaCPrime / (this.ksubC * this.SsubC);\r\n    var hue = this.deltaHPrime / (this.ksubH * this.SsubH);\r\n   \r\n    return sqrt(\r\n        pow(lightness, 2) +\r\n        pow(chroma, 2) +\r\n        pow(hue, 2) +\r\n        this.RsubT * chroma * hue\r\n    );\r\n};\r\n\r\n/**\r\n * Returns the RT variable calculation.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.getRsubT = function() {\r\n    var sin = Math.sin;\r\n    var sqrt = Math.sqrt;\r\n    var pow = Math.pow;\r\n    var exp = Math.exp;\r\n    \r\n    return -2 *\r\n        sqrt(\r\n            pow(this.CBarPrime, 7) /\r\n            (pow(this.CBarPrime, 7) + pow(25, 7))\r\n        ) *\r\n        sin(this.degreesToRadians(\r\n            60 *\r\n            exp(\r\n                -(\r\n                    pow(\r\n                        (this.HBarPrime - 275) / 25, 2\r\n                    )\r\n                )\r\n            )\r\n        ));\r\n};\r\n\r\n/**\r\n * Returns the T variable calculation.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.getT = function() {\r\n    var cos = Math.cos;\r\n    \r\n    return 1 -\r\n        0.17 * cos(this.degreesToRadians(this.HBarPrime - 30)) +\r\n        0.24 * cos(this.degreesToRadians(2 * this.HBarPrime)) +\r\n        0.32 * cos(this.degreesToRadians(3 * this.HBarPrime + 6)) -\r\n        0.20 * cos(this.degreesToRadians(4 * this.HBarPrime - 63));\r\n};\r\n\r\n/**\r\n * Returns the H Bar Prime variable calculation.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.getHBarPrime= function() {\r\n    var abs = Math.abs;\r\n    \r\n    if (abs(this.hPrime1 - this.hPrime2) > 180) {\r\n        return (this.hPrime1 + this.hPrime2 + 360) / 2\r\n    }\r\n    \r\n    return (this.hPrime1 + this.hPrime2) / 2\r\n};\r\n\r\n/**\r\n * Returns the Delta h Prime variable calculation.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.getDeltahPrime = function() {\r\n    var abs = Math.abs;\r\n    \r\n    // When either C′1 or C′2 is zero, then Δh′ is irrelevant and may be set to\r\n    // zero.\r\n    if (0 === this.C1 || 0 === this.C2) {\r\n        return 0;\r\n    }\r\n    \r\n    if (abs(this.hPrime1 - this.hPrime2) <= 180) {\r\n        return this.hPrime2 - this.hPrime1;\r\n    }\r\n    \r\n    if (this.hPrime2 <= this.hPrime1) {\r\n        return this.hPrime2 - this.hPrime1 + 360;\r\n    } else {\r\n        return this.hPrime2 - this.hPrime1 - 360;\r\n    }\r\n};\r\n\r\n/**\r\n * Returns the h Prime 1 variable calculation.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.gethPrime1 = function() {\r\n    return this._gethPrimeFn(this.x1.B, this.aPrime1);\r\n};\r\n\r\n/**\r\n * Returns the h Prime 2 variable calculation.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.gethPrime2 = function() {\r\n    return this._gethPrimeFn(this.x2.B, this.aPrime2);\r\n};\r\n\r\n/**\r\n * A helper function to calculate the h Prime 1 and h Prime 2 values.\r\n * @method\r\n * @private\r\n * @returns {number}\r\n */\r\ndE00.prototype._gethPrimeFn = function(x, y) {\r\n    var hueAngle;\r\n    \r\n    if (x === 0 && y === 0) {\r\n        return 0;\r\n    }\r\n    \r\n    hueAngle = this.radiansToDegrees(Math.atan2(x, y));\r\n    \r\n    if (hueAngle >= 0) {\r\n        return hueAngle;\r\n    } else {\r\n        return hueAngle + 360;\r\n    }\r\n};\r\n\r\n/**\r\n * Gives the radian equivalent of a specified degree angle.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.radiansToDegrees = function(radians) {\r\n    return radians * (180 / Math.PI);\r\n};\r\n\r\n/**\r\n * Gives the degree equivalent of a specified radian.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE00.prototype.degreesToRadians = function(degrees) {\r\n    return degrees * (Math.PI / 180);\r\n};\r\n\r\nmodule.exports = dE00;","'use strict';\r\n\r\n/**\r\n * @class dE76\r\n * @classdesc\r\n * The CIE76 color difference algorithm: a simple euclidean distance calculation.\r\n * http://en.wikipedia.org/wiki/Color_difference#CIE76\r\n * @constructs dE76\r\n * @memberOf DeltaE\r\n * @property {object} x1 The LAB color configuration object.\r\n * @property {number} x1.L The lightness value, on scale of 0-100.\r\n * @property {number} x1.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x1.B The hue value, on scale of -128 to 128.\r\n * @property {object} x2 The LAB color configuration object.\r\n * @property {number} x2.L The lightness value, on scale of 0-100.\r\n * @property {number} x2.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x2.B The hue value, on scale of -128 to 128.\r\n * @example\r\n * var deltaE = new dE76(\r\n *     {L:50, A:50, B:50},\r\n *     {L:100, A:50, B:50},\r\n * );\r\n * console.log(deltaE.getDeltaE());\r\n */\r\nfunction dE76(x1, x2) {\r\n    this.x1 = x1;\r\n    this.x2 = x2;\r\n}\r\n\r\n/**\r\n * Returns the dE76 value.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE76.prototype.getDeltaE = function() {\r\n    var x1 = this.x1;\r\n    var x2 = this.x2;\r\n    \r\n    return Math.sqrt(\r\n        Math.pow(x2.L - x1.L, 2) +\r\n        Math.pow(x2.A - x1.A, 2) +\r\n        Math.pow(x2.B - x1.B, 2)\r\n    );\r\n};\r\n\r\nmodule.exports = dE76;","'use strict';\r\n\r\n/**\r\n * @class dE94\r\n * @classdesc\r\n * The CIE94 algorithm: an iteration of the CIE76 algorithm.\r\n * http://en.wikipedia.org/wiki/Color_difference#CIE94\r\n * @constructs dE94\r\n * @memberOf DeltaE\r\n * @property {object} x1 The LAB color configuration object.\r\n * @property {number} x1.L The lightness value, on scale of 0-100.\r\n * @property {number} x1.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x1.B The hue value, on scale of -128 to 128.\r\n * @property {object} x2 The LAB color configuration object.\r\n * @property {number} x2.L The lightness value, on scale of 0-100.\r\n * @property {number} x2.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x2.B The hue value, on scale of -128 to 128.\r\n * @property {object} weights The weights configuration object.\r\n * @property {number} weights.lightness A weight factor to apply to lightness.\r\n * @property {number} weights.chroma A weight factor to apply to chroma.\r\n * @property {number} weights.hue A weight factor to apply to hue.\r\n * @example\r\n * var deltaE = new dE94(\r\n *     {L:50, A:50, B:50},\r\n *     {L:100, A:50, B:50},\r\n * );\r\n * console.log(deltaE.getDeltaE());\r\n */\r\nfunction dE94(x1, x2, weights) {\r\n    this.x1 = x1;\r\n    this.x2 = x2;\r\n    \r\n    this.weights = weights || {};\r\n    this.weights.lightness = this.weights.lightness || 1;\r\n    this.weights.chroma = this.weights.chroma || 1;\r\n    this.weights.hue = this.weights.hue || 1;\r\n    \r\n    if (1 === this.weights.lightness) {\r\n        this.weights.K1 = 0.045;\r\n        this.weights.K2 = 0.015;\r\n    } else {\r\n        this.weights.K1 = 0.048;\r\n        this.weights.K2 = 0.014;\r\n    }\r\n}\r\n\r\n/**\r\n * Returns the dE94 value.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE94.prototype.getDeltaE = function() {\r\n    var x1 = this.x1;\r\n    var x2 = this.x2;\r\n    var sqrt = Math.sqrt;\r\n    var pow = Math.pow;\r\n    \r\n    return sqrt(\r\n        pow(this.calculateL(x1, x2), 2) +\r\n        pow(this.calculateA(x1, x2), 2) +\r\n        pow(this.calculateB(x1, x2), 2)\r\n    );\r\n};\r\n\r\n/**\r\n * Calculates the lightness value.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE94.prototype.calculateL = function(x1, x2) {\r\n    return (x1.L - x2.L) / this.weights.lightness;\r\n};\r\n\r\n/**\r\n * Calculates the chroma value.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE94.prototype.calculateA = function(x1, x2) {\r\n    var sqrt = Math.sqrt;\r\n    var pow = Math.pow;\r\n    \r\n    //top\r\n    var c1 = sqrt(pow(x1.A, 2) + pow(x1.B, 2));\r\n    var c2 = sqrt(pow(x2.A, 2) + pow(x2.B, 2));\r\n    var cab = c1 - c2;\r\n    \r\n    // bottom\r\n    var sc = 1 + (this.weights.K1 * c1);\r\n    \r\n    return cab / (this.weights.chroma * sc);\r\n};\r\n\r\n/**\r\n * Calculates the hue value.\r\n * @method\r\n * @returns {number}\r\n */\r\ndE94.prototype.calculateB = function(x1, x2) {\r\n    var sqrt = Math.sqrt;\r\n    var pow = Math.pow;\r\n    \r\n    // cab\r\n    var c1 = sqrt(pow(x1.A, 2) + pow(x1.B, 2));\r\n    var c2 = sqrt(pow(x2.A, 2) + pow(x2.B, 2));\r\n    var cab = c1 - c2;\r\n    \r\n    // top\r\n    var a = x1.A - x2.A;\r\n    var b = x1.B - x2.B;\r\n    var hab = sqrt(\r\n        pow(a, 2) +\r\n        pow(b, 2) -\r\n        pow(cab, 2)\r\n    );\r\n    \r\n    // bottom\r\n    var c1 = sqrt(pow(x1.A, 2) + pow(x1.B, 2));\r\n    var sh = 1 + (this.weights.K2 * c1);\r\n    \r\n    return hab / sh;\r\n};\r\n\r\nmodule.exports = dE94;","'use strict';\r\n\r\n/**\r\n * @class DeltaE\r\n * @classdesc\r\n * A package of dE76, dE94, and dE00 algorithms.\r\n * @constructs DeltaE\r\n * @example\r\n * var DeltaE = new DeltaE();\r\n * var labColor1 = {L: 50, A: 50, B: 50};\r\n * var labColor2 = {L: 20, A: 20, B: 20};\r\n * \r\n * DeltaE.getDeltaE94(labColor1, labColor2);\r\n */\r\nvar dE76 = require('./dE76');\r\nvar dE94 = require('./dE94');\r\nvar dE00 = require('./dE00');\r\n\r\nfunction DeltaE() {}\r\n\r\n/**\r\n * The CIE76 color difference algorithm: a simple euclidean distance calculation.\r\n * http://en.wikipedia.org/wiki/Color_difference#CIE76\r\n * @property {object} x1 The LAB color configuration object.\r\n * @property {number} x1.L The lightness value, on scale of 0-100.\r\n * @property {number} x1.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x1.B The hue value, on scale of -128 to 128.\r\n * @property {object} x2 The LAB color configuration object.\r\n * @property {number} x2.L The lightness value, on scale of 0-100.\r\n * @property {number} x2.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x2.B The hue value, on scale of -128 to 128.\r\n * @returns {number} The computed dE76 value.\r\n * @example\r\n * var labColor1 = {L: 50, A: 50, B: 50};\r\n * var labColor2 = {L: 20, A: 20, B: 20};\r\n * \r\n * DeltaE.getDeltaE76(labColor1, labColor2);\r\n */\r\nDeltaE.prototype.getDeltaE76 = function(lab1, lab2) {\r\n    var deltaE = new dE76(lab1, lab2);\r\n    return deltaE.getDeltaE();\r\n};\r\n\r\n/**\r\n * The CIE94 algorithm: an iteration of the CIE76 algorithm.\r\n * http://en.wikipedia.org/wiki/Color_difference#CIE94\r\n * @property {object} x1 The LAB color configuration object.\r\n * @property {number} x1.L The lightness value, on scale of 0-100.\r\n * @property {number} x1.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x1.B The hue value, on scale of -128 to 128.\r\n * @property {object} x2 The LAB color configuration object.\r\n * @property {number} x2.L The lightness value, on scale of 0-100.\r\n * @property {number} x2.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x2.B The hue value, on scale of -128 to 128.\r\n * @property {object} weights The weights configuration object.\r\n * @property {number} weights.lightness A weight factor to apply to lightness.\r\n * @property {number} weights.chroma A weight factor to apply to chroma.\r\n * @property {number} weights.hue A weight factor to apply to hue.\r\n * @returns {number} The computed dE94 value.\r\n * @example\r\n * var labColor1 = {L: 50, A: 50, B: 50};\r\n * var labColor2 = {L: 20, A: 20, B: 20};\r\n * \r\n * DeltaE.getDeltaE94(labColor1, labColor2);\r\n */\r\nDeltaE.prototype.getDeltaE94 = function(lab1, lab2) {\r\n    var deltaE = new dE94(lab1, lab2);\r\n    return deltaE.getDeltaE();\r\n};\r\n\r\n/**\r\n * The CIE2000 color difference algorithm.\r\n * http://en.wikipedia.org/wiki/Color_difference#CIEDE2000\r\n * @property {object} x1 The LAB color configuration object.\r\n * @property {number} x1.L The lightness value, on scale of 0-100.\r\n * @property {number} x1.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x1.B The hue value, on scale of -128 to 128.\r\n * @property {object} x2 The LAB color configuration object.\r\n * @property {number} x2.L The lightness value, on scale of 0-100.\r\n * @property {number} x2.A The chroma value, on scale of -128 to 128.\r\n * @property {number} x2.B The hue value, on scale of -128 to 128.\r\n * @property {object} weights The weights configuration object.\r\n * @property {number} weights.lightness A weight factor to apply to lightness.\r\n * @property {number} weights.chroma A weight factor to apply to chroma.\r\n * @property {number} weights.hue A weight factor to apply to hue.\r\n * @returns {number} The computed dE00 value.\r\n * @example\r\n * var labColor1 = {L: 50, A: 50, B: 50};\r\n * var labColor2 = {L: 20, A: 20, B: 20};\r\n * \r\n * DeltaE.getDeltaE00(labColor1, labColor2);\r\n */\r\nDeltaE.prototype.getDeltaE00 = function(lab1, lab2) {\r\n    var deltaE = new dE00(lab1, lab2);\r\n    return deltaE.getDeltaE();\r\n};\r\n\r\nmodule.exports = new DeltaE;","/* globals MOClassDescription, NSObject, NSSelectorFromString, NSClassFromString, MOPropertyDescription */\n\nmodule.exports = function MochaDelegate(definition, superclass) {\n  var uniqueClassName =\n    'MochaJSDelegate_DynamicClass_' + NSUUID.UUID().UUIDString()\n\n  var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(\n    uniqueClassName,\n    superclass || NSObject\n  )\n\n  // Storage\n  var handlers = {}\n  var ivars = {}\n\n  // Define an instance method\n  function setHandlerForSelector(selectorString, func) {\n    var handlerHasBeenSet = selectorString in handlers\n    var selector = NSSelectorFromString(selectorString)\n\n    handlers[selectorString] = func\n\n    /*\n      For some reason, Mocha acts weird about arguments: https://github.com/logancollins/Mocha/issues/28\n      We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n    */\n    if (!handlerHasBeenSet) {\n      var args = []\n      var regex = /:/g\n      while (regex.exec(selectorString)) {\n        args.push('arg' + args.length)\n      }\n\n      // eslint-disable-next-line no-eval\n      var dynamicFunction = eval(\n        '(function (' +\n          args.join(', ') +\n          ') { return handlers[selectorString].apply(this, arguments); })'\n      )\n\n      delegateClassDesc.addInstanceMethodWithSelector_function(\n        selector,\n        dynamicFunction\n      )\n    }\n  }\n\n  // define a property\n  function setIvar(key, value) {\n    var ivarHasBeenSet = key in handlers\n\n    ivars[key] = value\n\n    if (!ivarHasBeenSet) {\n      delegateClassDesc.addInstanceVariableWithName_typeEncoding(key, '@')\n      var description = MOPropertyDescription.new()\n      description.name = key\n      description.typeEncoding = '@'\n      description.weak = true\n      description.ivarName = key\n      delegateClassDesc.addProperty(description)\n    }\n  }\n\n  this.getClass = function() {\n    return NSClassFromString(uniqueClassName)\n  }\n\n  this.getClassInstance = function(instanceVariables) {\n    var instance = NSClassFromString(uniqueClassName).new()\n    Object.keys(ivars).forEach(function(key) {\n      instance[key] = ivars[key]\n    })\n    Object.keys(instanceVariables || {}).forEach(function(key) {\n      instance[key] = instanceVariables[key]\n    })\n    return instance\n  }\n  // alias\n  this.new = this.getClassInstance\n\n  // Convenience\n  if (typeof definition === 'object') {\n    Object.keys(definition).forEach(\n      function(key) {\n        if (typeof definition[key] === 'function') {\n          setHandlerForSelector(key, definition[key])\n        } else {\n          setIvar(key, definition[key])\n        }\n      }\n    )\n  }\n\n  delegateClassDesc.registerClass()\n}\n","function parseHexColor(color) {\n  // Check the string for incorrect formatting.\n  if (!color || color[0] !== '#') {\n    if (\n      color &&\n      typeof color.isKindOfClass === 'function' &&\n      color.isKindOfClass(NSColor)\n    ) {\n      return color\n    }\n    throw new Error(\n      'Incorrect color formating. It should be an hex color: #RRGGBBAA'\n    )\n  }\n\n  // append FF if alpha channel is not specified.\n  var source = color.substr(1)\n  if (source.length === 3) {\n    source += 'F'\n  } else if (source.length === 6) {\n    source += 'FF'\n  }\n  // Convert the string from #FFF format to #FFFFFF format.\n  var hex\n  if (source.length === 4) {\n    for (var i = 0; i < 4; i += 1) {\n      hex += source[i]\n      hex += source[i]\n    }\n  } else if (source.length === 8) {\n    hex = source\n  } else {\n    return NSColor.whiteColor()\n  }\n\n  var r = parseInt(hex.slice(0, 2), 16)\n  var g = parseInt(hex.slice(2, 4), 16)\n  var b = parseInt(hex.slice(4, 6), 16)\n  var a = parseInt(hex.slice(6, 8), 16)\n\n  return NSColor.colorWithSRGBRed_green_blue_alpha(r, g, b, a)\n}\n\nmodule.exports = function(browserWindow, panel, webview) {\n  // keep reference to the subviews\n  browserWindow._panel = panel\n  browserWindow._webview = webview\n  browserWindow._destroyed = false\n\n  browserWindow.destroy = function() {\n    return panel.close()\n  }\n\n  browserWindow.close = function() {\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      var shouldClose = true\n      browserWindow.emit('close', {\n        get defaultPrevented() {\n          return !shouldClose\n        },\n        preventDefault: function() {\n          shouldClose = false\n        },\n      })\n      if (shouldClose) {\n        panel.delegate().utils.parentWindow.endSheet(panel)\n      }\n      return\n    }\n\n    if (!browserWindow.isClosable()) {\n      return\n    }\n\n    panel.performClose(null)\n  }\n\n  function focus(focused) {\n    if (!browserWindow.isVisible()) {\n      return\n    }\n    if (focused) {\n      NSApplication.sharedApplication().activateIgnoringOtherApps(true)\n      panel.makeKeyAndOrderFront(null)\n    } else {\n      panel.orderBack(null)\n      NSApp.mainWindow().makeKeyAndOrderFront(null)\n    }\n  }\n\n  browserWindow.focus = focus.bind(this, true)\n  browserWindow.blur = focus.bind(this, false)\n\n  browserWindow.isFocused = function() {\n    return panel.isKeyWindow()\n  }\n\n  browserWindow.isDestroyed = function() {\n    return browserWindow._destroyed\n  }\n\n  browserWindow.show = function() {\n    // This method is supposed to put focus on window, however if the app does not\n    // have focus then \"makeKeyAndOrderFront\" will only show the window.\n    NSApp.activateIgnoringOtherApps(true)\n\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      return panel.delegate().utils.parentWindow.beginSheet_completionHandler(\n        panel,\n        __mocha__.createBlock_function('v16@?0q8', function() {\n          browserWindow.emit('closed')\n        })\n      )\n    }\n\n    return panel.makeKeyAndOrderFront(null)\n  }\n\n  browserWindow.showInactive = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.hide = function() {\n    return panel.orderOut(null)\n  }\n\n  browserWindow.isVisible = function() {\n    return panel.isVisible()\n  }\n\n  browserWindow.isModal = function() {\n    return false\n  }\n\n  browserWindow.maximize = function() {\n    if (!browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n  browserWindow.unmaximize = function() {\n    if (browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n\n  browserWindow.isMaximized = function() {\n    if ((panel.styleMask() & NSResizableWindowMask) !== 0) {\n      return panel.isZoomed()\n    }\n    var rectScreen = NSScreen.mainScreen().visibleFrame()\n    var rectWindow = panel.frame()\n    return (\n      rectScreen.origin.x == rectWindow.origin.x &&\n      rectScreen.origin.y == rectWindow.origin.y &&\n      rectScreen.size.width == rectWindow.size.width &&\n      rectScreen.size.height == rectWindow.size.height\n    )\n  }\n\n  browserWindow.minimize = function() {\n    return panel.miniaturize(null)\n  }\n\n  browserWindow.restore = function() {\n    return panel.deminiaturize(null)\n  }\n\n  browserWindow.isMinimized = function() {\n    return panel.isMiniaturized()\n  }\n\n  browserWindow.setFullScreen = function(fullscreen) {\n    if (fullscreen !== browserWindow.isFullscreen()) {\n      panel.toggleFullScreen(null)\n    }\n  }\n\n  browserWindow.isFullscreen = function() {\n    return panel.styleMask() & NSFullScreenWindowMask\n  }\n\n  browserWindow.setAspectRatio = function(aspectRatio /* , extraSize */) {\n    // Reset the behaviour to default if aspect_ratio is set to 0 or less.\n    if (aspectRatio > 0.0) {\n      panel.setAspectRatio(NSMakeSize(aspectRatio, 1.0))\n    } else {\n      panel.setResizeIncrements(NSMakeSize(1.0, 1.0))\n    }\n  }\n\n  browserWindow.setBounds = function(bounds, animate) {\n    if (!bounds) {\n      return\n    }\n\n    // Do nothing if in fullscreen mode.\n    if (browserWindow.isFullscreen()) {\n      return\n    }\n\n    const newBounds = Object.assign(browserWindow.getBounds(), bounds)\n\n    // TODO: Check size constraints since setFrame does not check it.\n    // var size = bounds.size\n    // size.SetToMax(GetMinimumSize());\n    // gfx::Size max_size = GetMaximumSize();\n    // if (!max_size.IsEmpty())\n    //   size.SetToMin(max_size);\n\n    var cocoaBounds = NSMakeRect(\n      newBounds.x,\n      0,\n      newBounds.width,\n      newBounds.height\n    )\n    // Flip Y coordinates based on the primary screen\n    var screen = NSScreen.screens().firstObject()\n    cocoaBounds.origin.y = NSHeight(screen.frame()) - newBounds.y\n\n    panel.setFrame_display_animate(cocoaBounds, true, animate)\n  }\n\n  browserWindow.getBounds = function() {\n    const cocoaBounds = panel.frame()\n    var mainScreenRect = NSScreen.screens()\n      .firstObject()\n      .frame()\n    return {\n      x: cocoaBounds.origin.x,\n      y: Math.round(NSHeight(mainScreenRect) - cocoaBounds.origin.y),\n      width: cocoaBounds.size.width,\n      height: cocoaBounds.size.height,\n    }\n  }\n\n  browserWindow.setContentBounds = function(bounds, animate) {\n    // TODO:\n    browserWindow.setBounds(bounds, animate)\n  }\n\n  browserWindow.getContentBounds = function() {\n    // TODO:\n    return browserWindow.getBounds()\n  }\n\n  browserWindow.setSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setBounds({ width: width, height: height }, animate)\n  }\n\n  browserWindow.getSize = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setContentSize = function(width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setContentBounds(\n      { width: width, height: height },\n      animate\n    )\n  }\n\n  browserWindow.getContentSize = function() {\n    var bounds = browserWindow.getContentBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setMinimumSize = function(width, height) {\n    const minSize = CGSizeMake(width, height)\n    panel.setContentMinSize(minSize)\n  }\n\n  browserWindow.getMinimumSize = function() {\n    const size = panel.contentMinSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setMaximumSize = function(width, height) {\n    const maxSize = CGSizeMake(width, height)\n    panel.setContentMaxSize(maxSize)\n  }\n\n  browserWindow.getMaximumSize = function() {\n    const size = panel.contentMaxSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setResizable = function(resizable) {\n    return browserWindow._setStyleMask(resizable, NSResizableWindowMask)\n  }\n\n  browserWindow.isResizable = function() {\n    return panel.styleMask() & NSResizableWindowMask\n  }\n\n  browserWindow.setMovable = function(movable) {\n    return panel.setMovable(movable)\n  }\n  browserWindow.isMovable = function() {\n    return panel.isMovable()\n  }\n\n  browserWindow.setMinimizable = function(minimizable) {\n    return browserWindow._setStyleMask(minimizable, NSMiniaturizableWindowMask)\n  }\n\n  browserWindow.isMinimizable = function() {\n    return panel.styleMask() & NSMiniaturizableWindowMask\n  }\n\n  browserWindow.setMaximizable = function(maximizable) {\n    if (panel.standardWindowButton(NSWindowZoomButton)) {\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(maximizable)\n    }\n  }\n\n  browserWindow.isMaximizable = function() {\n    return (\n      panel.standardWindowButton(NSWindowZoomButton) &&\n      panel.standardWindowButton(NSWindowZoomButton).isEnabled()\n    )\n  }\n\n  browserWindow.setFullScreenable = function(fullscreenable) {\n    browserWindow._setCollectionBehavior(\n      fullscreenable,\n      NSWindowCollectionBehaviorFullScreenPrimary\n    )\n    // On EL Capitan this flag is required to hide fullscreen button.\n    browserWindow._setCollectionBehavior(\n      !fullscreenable,\n      NSWindowCollectionBehaviorFullScreenAuxiliary\n    )\n  }\n\n  browserWindow.isFullScreenable = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorFullScreenPrimary\n  }\n\n  browserWindow.setClosable = function(closable) {\n    browserWindow._setStyleMask(closable, NSClosableWindowMask)\n  }\n\n  browserWindow.isClosable = function() {\n    return panel.styleMask() & NSClosableWindowMask\n  }\n\n  browserWindow.setAlwaysOnTop = function(top, level, relativeLevel) {\n    var windowLevel = NSNormalWindowLevel\n    var maxWindowLevel = CGWindowLevelForKey(kCGMaximumWindowLevelKey)\n    var minWindowLevel = CGWindowLevelForKey(kCGMinimumWindowLevelKey)\n\n    if (top) {\n      if (level === 'normal') {\n        windowLevel = NSNormalWindowLevel\n      } else if (level === 'torn-off-menu') {\n        windowLevel = NSTornOffMenuWindowLevel\n      } else if (level === 'modal-panel') {\n        windowLevel = NSModalPanelWindowLevel\n      } else if (level === 'main-menu') {\n        windowLevel = NSMainMenuWindowLevel\n      } else if (level === 'status') {\n        windowLevel = NSStatusWindowLevel\n      } else if (level === 'pop-up-menu') {\n        windowLevel = NSPopUpMenuWindowLevel\n      } else if (level === 'screen-saver') {\n        windowLevel = NSScreenSaverWindowLevel\n      } else if (level === 'dock') {\n        // Deprecated by macOS, but kept for backwards compatibility\n        windowLevel = NSDockWindowLevel\n      } else {\n        windowLevel = NSFloatingWindowLevel\n      }\n    }\n\n    var newLevel = windowLevel + (relativeLevel || 0)\n    if (newLevel >= minWindowLevel && newLevel <= maxWindowLevel) {\n      panel.setLevel(newLevel)\n    } else {\n      throw new Error(\n        'relativeLevel must be between ' +\n          minWindowLevel +\n          ' and ' +\n          maxWindowLevel\n      )\n    }\n  }\n\n  browserWindow.isAlwaysOnTop = function() {\n    return panel.level() !== NSNormalWindowLevel\n  }\n\n  browserWindow.moveTop = function() {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.center = function() {\n    panel.center()\n  }\n\n  browserWindow.setPosition = function(x, y, animate) {\n    return browserWindow.setBounds({ x: x, y: y }, animate)\n  }\n\n  browserWindow.getPosition = function() {\n    var bounds = browserWindow.getBounds()\n    return [bounds.x, bounds.y]\n  }\n\n  browserWindow.setTitle = function(title) {\n    panel.setTitle(title)\n  }\n\n  browserWindow.getTitle = function() {\n    return String(panel.title())\n  }\n\n  var attentionRequestId = 0\n  browserWindow.flashFrame = function(flash) {\n    if (flash) {\n      attentionRequestId = NSApp.requestUserAttention(NSInformationalRequest)\n    } else {\n      NSApp.cancelUserAttentionRequest(attentionRequestId)\n      attentionRequestId = 0\n    }\n  }\n\n  browserWindow.getNativeWindowHandle = function() {\n    return panel\n  }\n\n  browserWindow.getNativeWebViewHandle = function() {\n    return webview\n  }\n\n  browserWindow.loadURL = function(url) {\n    // When frameLocation is a file, prefix it with the Sketch Resources path\n    if (/^(?!https?|file).*\\.html?$/.test(url)) {\n      if (typeof __command !== 'undefined' && __command.pluginBundle()) {\n        url =\n          'file://' +\n          __command\n            .pluginBundle()\n            .urlForResourceNamed(url)\n            .path()\n      }\n    }\n\n    if (/^file:\\/\\/.*\\.html?$/.test(url)) {\n      // ensure URLs containing spaces are properly handled\n      url = NSString.alloc().initWithString(url)\n      url = url.stringByAddingPercentEncodingWithAllowedCharacters(\n        NSCharacterSet.URLQueryAllowedCharacterSet()\n      )\n      webview.loadFileURL_allowingReadAccessToURL(\n        NSURL.URLWithString(url),\n        NSURL.URLWithString('file:///')\n      )\n      return\n    }\n\n    const properURL = NSURL.URLWithString(url)\n    const urlRequest = NSURLRequest.requestWithURL(properURL)\n\n    webview.loadRequest(urlRequest)\n  }\n\n  browserWindow.reload = function() {\n    webview.reload()\n  }\n\n  browserWindow.setHasShadow = function(hasShadow) {\n    return panel.setHasShadow(hasShadow)\n  }\n\n  browserWindow.hasShadow = function() {\n    return panel.hasShadow()\n  }\n\n  browserWindow.setOpacity = function(opacity) {\n    return panel.setAlphaValue(opacity)\n  }\n\n  browserWindow.getOpacity = function() {\n    return panel.alphaValue()\n  }\n\n  browserWindow.setVisibleOnAllWorkspaces = function(visible) {\n    return browserWindow._setCollectionBehavior(\n      visible,\n      NSWindowCollectionBehaviorCanJoinAllSpaces\n    )\n  }\n\n  browserWindow.isVisibleOnAllWorkspaces = function() {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorCanJoinAllSpaces\n  }\n\n  browserWindow.setIgnoreMouseEvents = function(ignore) {\n    return panel.setIgnoresMouseEvents(ignore)\n  }\n\n  browserWindow.setContentProtection = function(enable) {\n    panel.setSharingType(enable ? NSWindowSharingNone : NSWindowSharingReadOnly)\n  }\n\n  browserWindow.setAutoHideCursor = function(autoHide) {\n    panel.setDisableAutoHideCursor(autoHide)\n  }\n\n  browserWindow.setVibrancy = function(type) {\n    var effectView = browserWindow._vibrantView\n\n    if (!type) {\n      if (effectView == null) {\n        return\n      }\n\n      effectView.removeFromSuperview()\n      panel.setVibrantView(null)\n      return\n    }\n\n    if (effectView == null) {\n      var contentView = panel.contentView()\n      effectView = NSVisualEffectView.alloc().initWithFrame(\n        contentView.bounds()\n      )\n      browserWindow._vibrantView = effectView\n\n      effectView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n      effectView.setBlendingMode(NSVisualEffectBlendingModeBehindWindow)\n      effectView.setState(NSVisualEffectStateActive)\n      effectView.setFrame(contentView.bounds())\n      contentView.addSubview_positioned_relativeTo(\n        effectView,\n        NSWindowBelow,\n        null\n      )\n    }\n\n    var vibrancyType = NSVisualEffectMaterialLight\n\n    if (type === 'appearance-based') {\n      vibrancyType = NSVisualEffectMaterialAppearanceBased\n    } else if (type === 'light') {\n      vibrancyType = NSVisualEffectMaterialLight\n    } else if (type === 'dark') {\n      vibrancyType = NSVisualEffectMaterialDark\n    } else if (type === 'titlebar') {\n      vibrancyType = NSVisualEffectMaterialTitlebar\n    } else if (type === 'selection') {\n      vibrancyType = NSVisualEffectMaterialSelection\n    } else if (type === 'menu') {\n      vibrancyType = NSVisualEffectMaterialMenu\n    } else if (type === 'popover') {\n      vibrancyType = NSVisualEffectMaterialPopover\n    } else if (type === 'sidebar') {\n      vibrancyType = NSVisualEffectMaterialSidebar\n    } else if (type === 'medium-light') {\n      vibrancyType = NSVisualEffectMaterialMediumLight\n    } else if (type === 'ultra-dark') {\n      vibrancyType = NSVisualEffectMaterialUltraDark\n    }\n\n    effectView.setMaterial(vibrancyType)\n  }\n\n  browserWindow._setBackgroundColor = function(colorName) {\n    var color = parseHexColor(colorName)\n    webview.setValue_forKey(false, 'drawsBackground')\n    panel.backgroundColor = color\n  }\n\n  browserWindow._invalidate = function() {\n    panel.flushWindow()\n    panel.contentView().setNeedsDisplay(true)\n  }\n\n  browserWindow._setStyleMask = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setStyleMask(panel.styleMask() | flag)\n    } else {\n      panel.setStyleMask(panel.styleMask() & ~flag)\n    }\n    // Change style mask will make the zoom button revert to default, probably\n    // a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._setCollectionBehavior = function(on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setCollectionBehavior(panel.collectionBehavior() | flag)\n    } else {\n      panel.setCollectionBehavior(panel.collectionBehavior() & ~flag)\n    }\n    // Change collectionBehavior will make the zoom button revert to default,\n    // probably a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._showWindowButton = function(button) {\n    var view = panel.standardWindowButton(button)\n    view.superview().addSubview_positioned_relative(view, NSWindowAbove, null)\n  }\n}\n","module.exports = {\n  JS_BRIDGE: '__skpm_sketchBridge',\n  JS_BRIDGE_RESULT_SUCCESS: '__skpm_sketchBridge_success',\n  JS_BRIDGE_RESULT_ERROR: '__skpm_sketchBridge_error',\n  START_MOVING_WINDOW: '__skpm_startMovingWindow',\n  EXECUTE_JAVASCRIPT: '__skpm_executeJS',\n  EXECUTE_JAVASCRIPT_SUCCESS: '__skpm_executeJS_success_',\n  EXECUTE_JAVASCRIPT_ERROR: '__skpm_executeJS_error_',\n}\n","var tagsToFocus =\n  '[\"text\", \"textarea\", \"date\", \"datetime-local\", \"email\", \"number\", \"month\", \"password\", \"search\", \"tel\", \"time\", \"url\", \"week\" ]'\n\nmodule.exports = function(webView, event) {\n  var point = webView.convertPoint_fromView(event.locationInWindow(), null)\n  return (\n    'var el = document.elementFromPoint(' + // get the DOM element that match the event\n    point.x +\n    ', ' +\n    point.y +\n    '); ' +\n    'if (el && el.tagName === \"SELECT\") {' + // select needs special handling\n    '  var event = document.createEvent(\"MouseEvents\");' +\n    '  event.initMouseEvent(\"mousedown\", true, true, window);' +\n    '  el.dispatchEvent(event);' +\n    '} else if (el && ' + // some tags need to be focused instead of clicked\n    tagsToFocus +\n    '.indexOf(el.type) >= 0 && ' +\n    'el.focus' +\n    ') {' +\n    'el.focus();' + // so focus them\n    '} else if (el) {' +\n    'el.dispatchEvent(new Event(\"click\", {bubbles: true}))' + // click the others\n    '}'\n  )\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webview, browserWindow) {\n  function executeJavaScript(script, userGesture, callback) {\n    if (typeof userGesture === 'function') {\n      callback = userGesture\n      userGesture = false\n    }\n    var fiber = coscript.createFiber()\n\n    // if the webview is not ready yet, defer the execution until it is\n    if (\n      webview.navigationDelegate().state &&\n      webview.navigationDelegate().state.wasReady == 0\n    ) {\n      return new Promise(function(resolve, reject) {\n        browserWindow.once('ready-to-show', function() {\n          executeJavaScript(script, userGesture, callback)\n            .then(resolve)\n            .catch(reject)\n          fiber.cleanup()\n        })\n      })\n    }\n\n    return new Promise(function(resolve, reject) {\n      var requestId = Math.random()\n\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS + requestId,\n        function(res) {\n          try {\n            if (callback) {\n              callback(null, res)\n            }\n            resolve(res)\n          } catch (err) {\n            reject(err)\n          }\n          fiber.cleanup()\n        }\n      )\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_ERROR + requestId,\n        function(err) {\n          try {\n            if (callback) {\n              callback(err)\n              resolve()\n            } else {\n              reject(err)\n            }\n          } catch (err2) {\n            reject(err2)\n          }\n          fiber.cleanup()\n        }\n      )\n\n      webview.evaluateJavaScript_completionHandler(\n        module.exports.wrapScript(script, requestId),\n        null\n      )\n    })\n  }\n\n  return executeJavaScript\n}\n\nmodule.exports.wrapScript = function(script, requestId) {\n  return (\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    '(' +\n    requestId +\n    ', ' +\n    JSON.stringify(script) +\n    ')'\n  )\n}\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    ' = function(id, script) {' +\n    '  try {' +\n    '    var res = eval(script);' +\n    '    if (res && typeof res.then === \"function\" && typeof res.catch === \"function\") {' +\n    '      res.then(function (res2) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res2);' +\n    '      })' +\n    '      .catch(function (err) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '      })' +\n    '    } else {' +\n    '      window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res);' +\n    '    }' +\n    '  } catch (err) {' +\n    '    window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '  }' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","function addEdgeConstraint(edge, subview, view, constant) {\n  view.addConstraint(\n    NSLayoutConstraint.constraintWithItem_attribute_relatedBy_toItem_attribute_multiplier_constant(\n      subview,\n      edge,\n      NSLayoutRelationEqual,\n      view,\n      edge,\n      1,\n      constant\n    )\n  )\n}\nmodule.exports = function fitSubviewToView(subview, view, constants) {\n  constants = constants || []\n  subview.setTranslatesAutoresizingMaskIntoConstraints(false)\n\n  addEdgeConstraint(NSLayoutAttributeLeft, subview, view, constants[0] || 0)\n  addEdgeConstraint(NSLayoutAttributeTop, subview, view, constants[1] || 0)\n  addEdgeConstraint(NSLayoutAttributeRight, subview, view, constants[2] || 0)\n  addEdgeConstraint(NSLayoutAttributeBottom, subview, view, constants[3] || 0)\n}\n","/* let's try to match the API from Electron's Browser window\n(https://github.com/electron/electron/blob/master/docs/api/browser-window.md) */\nvar EventEmitter = require('events')\nvar buildBrowserAPI = require('./browser-api')\nvar buildWebAPI = require('./webview-api')\nvar fitSubviewToView = require('./fitSubview')\nvar dispatchFirstClick = require('./dispatch-first-click')\nvar injectClientMessaging = require('./inject-client-messaging')\nvar movableArea = require('./movable-area')\nvar executeJavaScript = require('./execute-javascript')\nvar setDelegates = require('./set-delegates')\n\nfunction BrowserWindow(options) {\n  options = options || {}\n\n  var identifier = options.identifier || NSUUID.UUID().UUIDString()\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  var existingBrowserWindow = BrowserWindow.fromId(identifier)\n\n  // if we already have a window opened, reuse it\n  if (existingBrowserWindow) {\n    return existingBrowserWindow\n  }\n\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (options.modal && !options.parent) {\n    throw new Error('A modal needs to have a parent.')\n  }\n\n  // Long-running script\n  var fiber = coscript.createFiber()\n\n  // Window size\n  var width = options.width || 800\n  var height = options.height || 600\n  var mainScreenRect = NSScreen.screens()\n    .firstObject()\n    .frame()\n  var cocoaBounds = NSMakeRect(\n    typeof options.x !== 'undefined'\n      ? options.x\n      : Math.round((NSWidth(mainScreenRect) - width) / 2),\n    typeof options.y !== 'undefined'\n      ? NSHeight(mainScreenRect) - options.y\n      : Math.round((NSHeight(mainScreenRect) - height) / 2),\n    width,\n    height\n  )\n\n  if (options.titleBarStyle && options.titleBarStyle !== 'default') {\n    options.frame = false\n  }\n\n  var useStandardWindow = options.windowType !== 'textured'\n  var styleMask = NSTitledWindowMask\n\n  // this is commented out because the toolbar doesn't appear otherwise :thinking-face:\n  // if (!useStandardWindow || options.frame === false) {\n  //   styleMask = NSFullSizeContentViewWindowMask\n  // }\n  if (options.minimizable !== false) {\n    styleMask |= NSMiniaturizableWindowMask\n  }\n  if (options.closable !== false) {\n    styleMask |= NSClosableWindowMask\n  }\n  if (options.resizable !== false) {\n    styleMask |= NSResizableWindowMask\n  }\n  if (!useStandardWindow || options.transparent || options.frame === false) {\n    styleMask |= NSTexturedBackgroundWindowMask\n  }\n\n  var panel = NSPanel.alloc().initWithContentRect_styleMask_backing_defer(\n    cocoaBounds,\n    styleMask,\n    NSBackingStoreBuffered,\n    true\n  )\n\n  var wkwebviewConfig = WKWebViewConfiguration.alloc().init()\n  var webView = WKWebView.alloc().initWithFrame_configuration(\n    CGRectMake(0, 0, options.width || 800, options.height || 600),\n    wkwebviewConfig\n  )\n  injectClientMessaging(webView)\n  webView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n  setDelegates(browserWindow, panel, webView, options)\n\n  if (options.windowType === 'desktop') {\n    panel.setLevel(kCGDesktopWindowLevel - 1)\n    // panel.setCanBecomeKeyWindow(false)\n    panel.setCollectionBehavior(\n      NSWindowCollectionBehaviorCanJoinAllSpaces |\n        NSWindowCollectionBehaviorStationary |\n        NSWindowCollectionBehaviorIgnoresCycle\n    )\n  }\n\n  if (\n    typeof options.minWidth !== 'undefined' ||\n    typeof options.minHeight !== 'undefined'\n  ) {\n    browserWindow.setMinimumSize(options.minWidth || 0, options.minHeight || 0)\n  }\n\n  if (\n    typeof options.maxWidth !== 'undefined' ||\n    typeof options.maxHeight !== 'undefined'\n  ) {\n    browserWindow.setMaximumSize(\n      options.maxWidth || 10000,\n      options.maxHeight || 10000\n    )\n  }\n\n  // if (options.focusable === false) {\n  //   panel.setCanBecomeKeyWindow(false)\n  // }\n\n  if (options.transparent || options.frame === false) {\n    panel.titlebarAppearsTransparent = true\n    panel.titleVisibility = NSWindowTitleHidden\n    panel.setOpaque(0)\n    panel.isMovableByWindowBackground = true\n    var toolbar2 = NSToolbar.alloc().initWithIdentifier(\n      'titlebarStylingToolbar'\n    )\n    toolbar2.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar2)\n  }\n\n  if (options.titleBarStyle === 'hiddenInset') {\n    var toolbar = NSToolbar.alloc().initWithIdentifier('titlebarStylingToolbar')\n    toolbar.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar)\n  }\n\n  if (options.frame === false || !options.useContentSize) {\n    browserWindow.setSize(width, height)\n  }\n\n  if (options.center) {\n    browserWindow.center()\n  }\n\n  if (options.alwaysOnTop) {\n    browserWindow.setAlwaysOnTop(true)\n  }\n\n  if (options.fullscreen) {\n    browserWindow.setFullScreen(true)\n  }\n  browserWindow.setFullScreenable(!!options.fullscreenable)\n\n  let title = options.title\n  if (options.frame === false) {\n    title = undefined\n  } else if (\n    typeof title === 'undefined' &&\n    typeof __command !== 'undefined' &&\n    __command.pluginBundle()\n  ) {\n    title = __command.pluginBundle().name()\n  }\n\n  if (title) {\n    browserWindow.setTitle(title)\n  }\n\n  var backgroundColor = options.backgroundColor\n  if (options.transparent) {\n    backgroundColor = NSColor.clearColor()\n  }\n  if (!backgroundColor && options.frame === false && options.vibrancy) {\n    backgroundColor = NSColor.clearColor()\n  }\n\n  browserWindow._setBackgroundColor(\n    backgroundColor || NSColor.windowBackgroundColor()\n  )\n\n  if (options.hasShadow === false) {\n    browserWindow.setHasShadow(false)\n  }\n\n  if (typeof options.opacity !== 'undefined') {\n    browserWindow.setOpacity(options.opacity)\n  }\n\n  options.webPreferences = options.webPreferences || {}\n\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.devTools !== false,\n      'developerExtrasEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.javascript !== false,\n      'javaScriptEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(!!options.webPreferences.plugins, 'plugInsEnabled')\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.minimumFontSize || 0,\n      'minimumFontSize'\n    )\n\n  if (options.webPreferences.zoomFactor) {\n    webView.setMagnification(options.webPreferences.zoomFactor)\n  }\n\n  var contentView = panel.contentView()\n\n  if (options.frame !== false) {\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n  } else {\n    // In OSX 10.10, adding subviews to the root view for the NSView hierarchy\n    // produces warnings. To eliminate the warnings, we resize the contentView\n    // to fill the window, and add subviews to that.\n    // http://crbug.com/380412\n    contentView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n    fitSubviewToView(contentView, contentView.superview())\n\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n\n    // The fullscreen button should always be hidden for frameless window.\n    if (panel.standardWindowButton(NSWindowFullScreenButton)) {\n      panel.standardWindowButton(NSWindowFullScreenButton).setHidden(true)\n    }\n\n    if (!options.titleBarStyle || options.titleBarStyle === 'default') {\n      // Hide the window buttons.\n      panel.standardWindowButton(NSWindowZoomButton).setHidden(true)\n      panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true)\n      panel.standardWindowButton(NSWindowCloseButton).setHidden(true)\n\n      // Some third-party macOS utilities check the zoom button's enabled state to\n      // determine whether to show custom UI on hover, so we disable it here to\n      // prevent them from doing so in a frameless app window.\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(false)\n    }\n  }\n\n  if (options.vibrancy) {\n    browserWindow.setVibrancy(options.vibrancy)\n  }\n\n  // Set maximizable state last to ensure zoom button does not get reset\n  // by calls to other APIs.\n  browserWindow.setMaximizable(options.maximizable !== false)\n\n  panel.setHidesOnDeactivate(options.hidesOnDeactivate !== false)\n\n  if (options.remembersWindowFrame) {\n    panel.setFrameAutosaveName(identifier)\n    panel.setFrameUsingName_force(panel.frameAutosaveName(), false)\n  }\n\n  if (options.acceptsFirstMouse) {\n    browserWindow.on('focus', function(event) {\n      if (event.type() === NSEventTypeLeftMouseDown) {\n        browserWindow.webContents\n          .executeJavaScript(dispatchFirstClick(webView, event))\n          .catch(() => {})\n      }\n    })\n  }\n\n  executeJavaScript.injectScript(webView)\n  movableArea.injectScript(webView)\n  movableArea.setupHandler(browserWindow)\n\n  if (options.show !== false) {\n    browserWindow.show()\n  }\n\n  browserWindow.on('closed', function() {\n    browserWindow._destroyed = true\n    threadDictionary.removeObjectForKey(identifier)\n    var observer = threadDictionary[identifier + '.themeObserver']\n    if (observer) {\n      NSApplication.sharedApplication().removeObserver_forKeyPath(\n        observer,\n        'effectiveAppearance'\n      )\n      threadDictionary.removeObjectForKey(identifier + '.themeObserver')\n    }\n    fiber.cleanup()\n  })\n\n  threadDictionary[identifier] = panel\n\n  fiber.onCleanup(function() {\n    if (!browserWindow._destroyed) {\n      browserWindow.destroy()\n    }\n  })\n\n  return browserWindow\n}\n\nBrowserWindow.fromId = function(identifier) {\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  if (threadDictionary[identifier]) {\n    return BrowserWindow.fromPanel(threadDictionary[identifier], identifier)\n  }\n\n  return undefined\n}\n\nBrowserWindow.fromPanel = function(panel, identifier) {\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (!panel || !panel.contentView) {\n    throw new Error('needs to pass an NSPanel')\n  }\n\n  var webView = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webView &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webView = subviews[i]\n    }\n  }\n\n  if (!webView) {\n    throw new Error('The panel needs to have a webview')\n  }\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n\n  return browserWindow\n}\n\nmodule.exports = BrowserWindow\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function(webView) {\n  var source =\n    'window.originalPostMessage = window.postMessage;' +\n    'window.postMessage = function(actionName) {' +\n    '  if (!actionName) {' +\n    \"    throw new Error('missing action name')\" +\n    '  }' +\n    '  var id = String(Math.random()).replace(\".\", \"\");' +\n    '    var args = [].slice.call(arguments);' +\n    '    args.unshift(id);' +\n    '  return new Promise(function (resolve, reject) {' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n    '\" + id] = resolve;' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n    '\" + id] = reject;' +\n    '    window.webkit.messageHandlers.' +\n    CONSTANTS.JS_BRIDGE +\n    '.postMessage(JSON.stringify(args));' +\n    '  });' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports.injectScript = function(webView) {\n  var source =\n    '(function () {' +\n    \"document.addEventListener('mousedown', onMouseDown);\" +\n    '' +\n    'function shouldDrag(target) {' +\n    '  if (!target || (target.dataset || {}).appRegion === \"no-drag\") { return false }' +\n    '  if ((target.dataset || {}).appRegion === \"drag\") { return true }' +\n    '  return shouldDrag(target.parentElement)' +\n    '};' +\n    '' +\n    'function onMouseDown(e) {' +\n    '  if (e.button !== 0 || !shouldDrag(e.target)) { return }' +\n    '  window.postMessage(\"' +\n    CONSTANTS.START_MOVING_WINDOW +\n    '\");' +\n    '};' +\n    '})()'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n}\n\nmodule.exports.setupHandler = function(browserWindow) {\n  var initialMouseLocation = null\n  var initialWindowPosition = null\n  var interval = null\n\n  function moveWindow() {\n    // if the user released the button, stop moving the window\n    if (!initialWindowPosition || NSEvent.pressedMouseButtons() !== 1) {\n      clearInterval(interval)\n      initialMouseLocation = null\n      initialWindowPosition = null\n      return\n    }\n\n    var mouse = NSEvent.mouseLocation()\n    browserWindow.setPosition(\n      initialWindowPosition.x + (mouse.x - initialMouseLocation.x),\n      initialWindowPosition.y + (initialMouseLocation.y - mouse.y), // y is inverted\n      false\n    )\n  }\n\n  browserWindow.webContents.on(CONSTANTS.START_MOVING_WINDOW, function() {\n    initialMouseLocation = NSEvent.mouseLocation()\n    var position = browserWindow.getPosition()\n    initialWindowPosition = {\n      x: position[0],\n      y: position[1],\n    }\n\n    interval = setInterval(moveWindow, 1000 / 60) // 60 fps\n  })\n}\n","module.exports = function(webArguments) {\n  var args = null\n  try {\n    args = JSON.parse(webArguments)\n  } catch (e) {\n    // malformed arguments\n  }\n\n  if (\n    !args ||\n    !args.constructor ||\n    args.constructor !== Array ||\n    args.length == 0\n  ) {\n    return null\n  }\n\n  return args\n}\n","var ObjCClass = require('mocha-js-delegate')\nvar parseWebArguments = require('./parseWebArguments')\nvar CONSTANTS = require('./constants')\n\n// We create one ObjC class for ourselves here\nvar WindowDelegateClass\nvar NavigationDelegateClass\nvar WebScriptHandlerClass\nvar ThemeObserverClass\n\n// TODO: events\n// - 'page-favicon-updated'\n// - 'new-window'\n// - 'did-navigate-in-page'\n// - 'will-prevent-unload'\n// - 'crashed'\n// - 'unresponsive'\n// - 'responsive'\n// - 'destroyed'\n// - 'before-input-event'\n// - 'certificate-error'\n// - 'found-in-page'\n// - 'media-started-playing'\n// - 'media-paused'\n// - 'did-change-theme-color'\n// - 'update-target-url'\n// - 'cursor-changed'\n// - 'context-menu'\n// - 'select-bluetooth-device'\n// - 'paint'\n// - 'console-message'\n\nmodule.exports = function(browserWindow, panel, webview, options) {\n  if (!ThemeObserverClass) {\n    ThemeObserverClass = new ObjCClass({\n      utils: null,\n\n      'observeValueForKeyPath:ofObject:change:context:': function() {\n        this.utils.executeJavaScript(\n          \"document.body.classList.remove('__skpm-\" +\n            (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n              ? 'light'\n              : 'dark') +\n            \"'); document.body.classList.add('__skpm-\" +\n            (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n              ? 'dark'\n              : 'light') +\n            \"')\"\n        )\n      },\n    })\n  }\n\n  if (!WindowDelegateClass) {\n    WindowDelegateClass = new ObjCClass({\n      utils: null,\n      panel: null,\n\n      'windowDidResize:': function() {\n        this.utils.emit('resize')\n      },\n\n      'windowDidMiniaturize:': function() {\n        this.utils.emit('minimize')\n      },\n\n      'windowDidDeminiaturize:': function() {\n        this.utils.emit('restore')\n      },\n\n      'windowDidEnterFullScreen:': function() {\n        this.utils.emit('enter-full-screen')\n      },\n\n      'windowDidExitFullScreen:': function() {\n        this.utils.emit('leave-full-screen')\n      },\n\n      'windowDidMove:': function() {\n        this.utils.emit('move')\n        this.utils.emit('moved')\n      },\n\n      'windowShouldClose:': function() {\n        var shouldClose = 1\n        this.utils.emit('close', {\n          get defaultPrevented() {\n            return !shouldClose\n          },\n          preventDefault: function() {\n            shouldClose = 0\n          },\n        })\n        return shouldClose\n      },\n\n      'windowWillClose:': function() {\n        this.utils.emit('closed')\n      },\n\n      'windowDidBecomeKey:': function() {\n        this.utils.emit('focus', this.panel.currentEvent())\n      },\n\n      'windowDidResignKey:': function() {\n        this.utils.emit('blur')\n      },\n    })\n  }\n\n  if (!NavigationDelegateClass) {\n    NavigationDelegateClass = new ObjCClass({\n      state: {\n        wasReady: 0,\n      },\n      utils: null,\n\n      // // Called when the web view begins to receive web content.\n      'webView:didCommitNavigation:': function(webView) {\n        this.utils.emit('will-navigate', {}, String(String(webView.URL())))\n      },\n\n      // // Called when web content begins to load in a web view.\n      'webView:didStartProvisionalNavigation:': function() {\n        this.utils.emit('did-start-navigation')\n        this.utils.emit('did-start-loading')\n      },\n\n      // Called when a web view receives a server redirect.\n      'webView:didReceiveServerRedirectForProvisionalNavigation:': function() {\n        this.utils.emit('did-get-redirect-request')\n      },\n\n      // // Called when the web view needs to respond to an authentication challenge.\n      // 'webView:didReceiveAuthenticationChallenge:completionHandler:': function(\n      //   webView,\n      //   challenge,\n      //   completionHandler\n      // ) {\n      //   function callback(username, password) {\n      //     completionHandler(\n      //       0,\n      //       NSURLCredential.credentialWithUser_password_persistence(\n      //         username,\n      //         password,\n      //         1\n      //       )\n      //     )\n      //   }\n      //   var protectionSpace = challenge.protectionSpace()\n      //   this.utils.emit(\n      //     'login',\n      //     {},\n      //     {\n      //       method: String(protectionSpace.authenticationMethod()),\n      //       url: 'not implemented', // TODO:\n      //       referrer: 'not implemented', // TODO:\n      //     },\n      //     {\n      //       isProxy: !!protectionSpace.isProxy(),\n      //       scheme: String(protectionSpace.protocol()),\n      //       host: String(protectionSpace.host()),\n      //       port: Number(protectionSpace.port()),\n      //       realm: String(protectionSpace.realm()),\n      //     },\n      //     callback\n      //   )\n      // },\n\n      // Called when an error occurs during navigation.\n      // 'webView:didFailNavigation:withError:': function(\n      //   webView,\n      //   navigation,\n      //   error\n      // ) {},\n\n      // Called when an error occurs while the web view is loading content.\n      'webView:didFailProvisionalNavigation:withError:': function(\n        webView,\n        navigation,\n        error\n      ) {\n        this.utils.emit('did-fail-load', error)\n      },\n\n      // Called when the navigation is complete.\n      'webView:didFinishNavigation:': function() {\n        if (this.state.wasReady == 0) {\n          this.state.wasReady = 1\n          this.utils.emitBrowserEvent('ready-to-show')\n        }\n        this.utils.emit('did-navigate')\n        this.utils.emit('did-frame-navigate')\n        this.utils.emit('did-stop-loading')\n        this.utils.emit('did-finish-load')\n        this.utils.emit('did-frame-finish-load')\n      },\n\n      // Called when the web view’s web content process is terminated.\n      'webViewWebContentProcessDidTerminate:': function() {\n        this.utils.emit('dom-ready')\n      },\n\n      // Decides whether to allow or cancel a navigation.\n      // webView:decidePolicyForNavigationAction:decisionHandler:\n\n      // Decides whether to allow or cancel a navigation after its response is known.\n      // webView:decidePolicyForNavigationResponse:decisionHandler:\n    })\n  }\n\n  if (!WebScriptHandlerClass) {\n    WebScriptHandlerClass = new ObjCClass({\n      utils: null,\n      'userContentController:didReceiveScriptMessage:': function(_, message) {\n        var args = this.utils.parseWebArguments(String(message.body()))\n        if (!args) {\n          return\n        }\n        if (!args[0] || typeof args[0] !== 'string') {\n          return\n        }\n        args[0] = String(args[0])\n\n        this.utils.emit.apply(this, args)\n      },\n    })\n  }\n\n  var themeObserver = ThemeObserverClass.new({\n    utils: {\n      executeJavaScript(script) {\n        webview.evaluateJavaScript_completionHandler(script, null)\n      },\n    },\n  })\n\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    \"document.addEventListener('DOMContentLoaded', function() { document.body.classList.add('__skpm-\" +\n      (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n        ? 'dark'\n        : 'light') +\n      \"') }, false)\",\n    0,\n    true\n  )\n  webview\n    .configuration()\n    .userContentController()\n    .addUserScript(script)\n\n  NSApplication.sharedApplication().addObserver_forKeyPath_options_context(\n    themeObserver,\n    'effectiveAppearance',\n    NSKeyValueChangeNewKey,\n    null\n  )\n\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n  threadDictionary[browserWindow.id + '.themeObserver'] = themeObserver\n\n  var navigationDelegate = NavigationDelegateClass.new({\n    utils: {\n      setTitle: browserWindow.setTitle.bind(browserWindow),\n      emitBrowserEvent() {\n        try {\n          browserWindow.emit.apply(browserWindow, arguments)\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n      emit() {\n        try {\n          browserWindow.webContents.emit.apply(\n            browserWindow.webContents,\n            arguments\n          )\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n    },\n    state: {\n      wasReady: 0,\n    },\n  })\n\n  webview.setNavigationDelegate(navigationDelegate)\n\n  var webScriptHandler = WebScriptHandlerClass.new({\n    utils: {\n      emit(id, type) {\n        if (!type) {\n          webview.evaluateJavaScript_completionHandler(\n            CONSTANTS.JS_BRIDGE_RESULT_SUCCESS + id + '()',\n            null\n          )\n          return\n        }\n\n        var args = []\n        for (var i = 2; i < arguments.length; i += 1) args.push(arguments[i])\n\n        var listeners = browserWindow.webContents.listeners(type)\n\n        Promise.all(\n          listeners.map(function(l) {\n            return Promise.resolve().then(function() {\n              return l.apply(l, args)\n            })\n          })\n        )\n          .then(function(res) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n                id +\n                '(' +\n                JSON.stringify(res) +\n                ')',\n              null\n            )\n          })\n          .catch(function(err) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n                id +\n                '(' +\n                JSON.stringify(err) +\n                ')',\n              null\n            )\n          })\n      },\n      parseWebArguments: parseWebArguments,\n    },\n  })\n\n  webview\n    .configuration()\n    .userContentController()\n    .addScriptMessageHandler_name(webScriptHandler, CONSTANTS.JS_BRIDGE)\n\n  var utils = {\n    emit() {\n      try {\n        browserWindow.emit.apply(browserWindow, arguments)\n      } catch (err) {\n        if (\n          typeof process !== 'undefined' &&\n          process.listenerCount &&\n          process.listenerCount('uncaughtException')\n        ) {\n          process.emit('uncaughtException', err, 'uncaughtException')\n        } else {\n          console.error(err)\n          throw err\n        }\n      }\n    },\n  }\n  if (options.modal) {\n    // find the window of the document\n    var msdocument\n    if (options.parent.type === 'Document') {\n      msdocument = options.parent.sketchObject\n    } else {\n      msdocument = options.parent\n    }\n    if (msdocument && String(msdocument.class()) === 'MSDocumentData') {\n      // we only have an MSDocumentData instead of a MSDocument\n      // let's try to get back to the MSDocument\n      msdocument = msdocument.delegate()\n    }\n    utils.parentWindow = msdocument.windowForSheet()\n  }\n\n  var windowDelegate = WindowDelegateClass.new({\n    utils: utils,\n    panel: panel,\n  })\n\n  panel.setDelegate(windowDelegate)\n}\n","var EventEmitter = require('events')\nvar executeJavaScript = require('./execute-javascript')\n\n// let's try to match https://github.com/electron/electron/blob/master/docs/api/web-contents.md\nmodule.exports = function buildAPI(browserWindow, panel, webview) {\n  var webContents = new EventEmitter()\n\n  webContents.loadURL = browserWindow.loadURL\n\n  webContents.loadFile = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.downloadURL = function(/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.getURL = function() {\n    return String(webview.url())\n  }\n\n  webContents.getTitle = function() {\n    return String(webview.title())\n  }\n\n  webContents.isDestroyed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.focus = browserWindow.focus\n  webContents.isFocused = browserWindow.isFocused\n\n  webContents.isLoading = function() {\n    return !!webview.loading()\n  }\n\n  webContents.isLoadingMainFrame = function() {\n    // TODO:\n    return !!webview.loading()\n  }\n\n  webContents.isWaitingForResponse = function() {\n    return !webview.loading()\n  }\n\n  webContents.stop = function() {\n    webview.stopLoading()\n  }\n  webContents.reload = function() {\n    webview.reload()\n  }\n  webContents.reloadIgnoringCache = function() {\n    webview.reloadFromOrigin()\n  }\n  webContents.canGoBack = function() {\n    return !!webview.canGoBack()\n  }\n  webContents.canGoForward = function() {\n    return !!webview.canGoForward()\n  }\n  webContents.canGoToOffset = function(offset) {\n    return !!webview.backForwardList().itemAtIndex(offset)\n  }\n  webContents.clearHistory = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.goBack = function() {\n    webview.goBack()\n  }\n  webContents.goForward = function() {\n    webview.goForward()\n  }\n  webContents.goToIndex = function(index) {\n    var backForwardList = webview.backForwardList()\n    var backList = backForwardList.backList()\n    var backListLength = backList.count()\n    if (backListLength > index) {\n      webview.loadRequest(NSURLRequest.requestWithURL(backList[index]))\n      return\n    }\n    var forwardList = backForwardList.forwardList()\n    if (forwardList.count() > index - backListLength) {\n      webview.loadRequest(\n        NSURLRequest.requestWithURL(forwardList[index - backListLength])\n      )\n      return\n    }\n    throw new Error('Cannot go to index ' + index)\n  }\n  webContents.goToOffset = function(offset) {\n    if (!webContents.canGoToOffset(offset)) {\n      throw new Error('Cannot go to offset ' + offset)\n    }\n    webview.loadRequest(\n      NSURLRequest.requestWithURL(webview.backForwardList().itemAtIndex(offset))\n    )\n  }\n  webContents.isCrashed = function() {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setUserAgent = function(/* userAgent */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.getUserAgent = function() {\n    const userAgent = webview.customUserAgent()\n    return userAgent ? String(userAgent) : undefined\n  }\n  webContents.insertCSS = function(css) {\n    var source =\n      \"var style = document.createElement('style'); style.innerHTML = \" +\n      css.replace(/\"/, '\\\\\"') +\n      '; document.head.appendChild(style);'\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.insertJS = function(source) {\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview\n      .configuration()\n      .userContentController()\n      .addUserScript(script)\n  }\n  webContents.executeJavaScript = executeJavaScript(webview, browserWindow)\n  webContents.setIgnoreMenuShortcuts = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setAudioMuted = function(/* muted */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.isAudioMuted = function() {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setZoomFactor = function(factor) {\n    webview.setMagnification_centeredAtPoint(factor, CGPointMake(0, 0))\n  }\n  webContents.getZoomFactor = function(callback) {\n    callback(Number(webview.magnification()))\n  }\n  webContents.setZoomLevel = function(level) {\n    // eslint-disable-next-line no-restricted-properties\n    webContents.setZoomFactor(Math.pow(1.2, level))\n  }\n  webContents.getZoomLevel = function(callback) {\n    // eslint-disable-next-line no-restricted-properties\n    callback(Math.log(Number(webview.magnification())) / Math.log(1.2))\n  }\n  webContents.setVisualZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setLayoutZoomLevelLimits = function(/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  // TODO:\n  // webContents.undo = function() {\n  //   webview.undoManager().undo()\n  // }\n  // webContents.redo = function() {\n  //   webview.undoManager().redo()\n  // }\n  // webContents.cut = webview.cut\n  // webContents.copy = webview.copy\n  // webContents.paste = webview.paste\n  // webContents.pasteAndMatchStyle = webview.pasteAsRichText\n  // webContents.delete = webview.delete\n  // webContents.replace = webview.replaceSelectionWithText\n\n  webContents.send = function() {\n    const script =\n      'window.postMessage({' +\n      'isSketchMessage: true,' +\n      \"origin: '\" +\n      String(__command.identifier()) +\n      \"',\" +\n      'args: ' +\n      JSON.stringify([].slice.call(arguments)) +\n      '}, \"*\")'\n    webview.evaluateJavaScript_completionHandler(script, null)\n  }\n\n  webContents.getNativeWebview = function() {\n    return webview\n  }\n\n  browserWindow.webContents = webContents\n}\n","/* globals NSThread */\nvar threadDictionary = NSThread.mainThread().threadDictionary()\n\nmodule.exports.getWebview = function(identifier) {\n  return require('./lib').fromId(identifier) // eslint-disable-line\n}\n\nmodule.exports.isWebviewPresent = function isWebviewPresent(identifier) {\n  return !!threadDictionary[identifier]\n}\n\nmodule.exports.sendToWebview = function sendToWebview(identifier, evalString) {\n  if (!module.exports.isWebviewPresent(identifier)) {\n    return\n  }\n\n  var panel = threadDictionary[identifier]\n  var webview = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webview &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webview = subviews[i]\n    }\n  }\n\n  if (!webview || !webview.evaluateJavaScript_completionHandler) {\n    throw new Error('Webview ' + identifier + ' not found')\n  }\n\n  webview.evaluateJavaScript_completionHandler(evalString, null)\n}\n","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/34c73fc71c785c25ae2ced72bc1dd3fb.html\";","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/ea6c4b2cad9e560d036455aa69fe1cf5.html\";","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/53fd67153dd8c551c9106cb843e372a8.html\";","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/2dcfe345c25214b7acb917c62d76c5da.html\";","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/fec00184c0e32b1fa054c6f73c8e7167.html\";","import BrowserWindow from 'sketch-module-web-view'\nimport { getWebview } from 'sketch-module-web-view/remote'\nconst Helpers = require(\"./Helpers\");\nconst webviewEsIdentifier = 'sync-with-library.webviewSettings';\n\nvar globalSettingsFile;\n\nexport function EditSettings(context) {\n  const optionss = {\n    identifier: webviewEsIdentifier,\n    width: 500,\n    height: 600,\n    show: false,\n    remembersWindowFrame: true,\n    titleBarStyle: 'hidden'\n  }\n  const browserWindow = new BrowserWindow(optionss);\n  const webContents = browserWindow.webContents;\n\n\n  browserWindow.loadURL(require('../resources/settings.html'));\n  globalSettingsFile = Helpers.getSettings();\n\n  browserWindow.once('ready-to-show', () => {\n    browserWindow.show()\n  })\n\n  webContents.on('did-finish-load', () => {\n    webContents.executeJavaScript(`AssignSettings(${Helpers.getLogsEnabled()},${Helpers.getLibrariesEnabled()})`).catch(console.error);\n  })\n\n  webContents.on('nativeLog', s => {\n    Helpers.clog(s);\n  });\n\n  webContents.on('Cancel', () => {\n    onShutdown(webviewEsIdentifier);\n  });\n\n  webContents.on('AcceptSettings', (logsEnabled) => {\n    //d9-06\n    var _0xc104=[\"\\x6C\\x69\\x63\\x65\\x6E\\x73\\x65\\x4B\\x65\\x79\",\"\",\"\\x73\\x74\\x61\\x72\\x74\\x54\\x69\\x6D\\x65\",\"\\x70\\x61\\x74\\x68\",\"\\x6D\\x61\\x69\\x6E\\x50\\x6C\\x75\\x67\\x69\\x6E\\x73\\x46\\x6F\\x6C\\x64\\x65\\x72\\x55\\x52\\x4C\",\"\\x2F\\x73\\x79\\x6E\\x63\\x77\\x69\\x74\\x68\\x6C\\x69\\x62\\x72\\x61\\x72\\x79\\x2E\\x6A\\x73\\x6F\\x6E\",\"\\x77\\x72\\x69\\x74\\x65\\x54\\x65\\x78\\x74\\x54\\x6F\\x46\\x69\\x6C\\x65\"];var jsonDef;if((globalSettingsFile!= null)&& (globalSettingsFile[_0xc104[0]]!= null)){jsonDef= {\"\\x6C\\x69\\x63\\x65\\x6E\\x73\\x65\\x4B\\x65\\x79\":_0xc104[1]+ globalSettingsFile[_0xc104[0]],\"\\x6C\\x6F\\x67\\x73\":logsEnabled}}else {if((globalSettingsFile!= null)&& (globalSettingsFile[_0xc104[2]]!= null)){jsonDef= {\"\\x73\\x74\\x61\\x72\\x74\\x54\\x69\\x6D\\x65\":_0xc104[1]+ globalSettingsFile[_0xc104[2]],\"\\x6C\\x6F\\x67\\x73\":logsEnabled}}};Helpers[_0xc104[6]](jsonDef,MSPluginManager[_0xc104[4]]()[_0xc104[3]]()+ _0xc104[5]);onShutdown(webviewEsIdentifier)\n    //d9-06\n  });\n}\n\nexport function onShutdown(webviewID) {\n  const existingWebview = getWebview(webviewID)\n  if (existingWebview) {\n    existingWebview.close()\n  }\n}","var DeltaE = require('delta-e');\nvar fs = require('@skpm/fs');\nvar D3 = require('d3-color');\n\nvar settingsFile;\nvar logsEnabled = false;\nvar librariesEnabledByDefault = true;\n\nconst valStatus = {\n  app: 'app',\n  no: 'no',\n  over: 'over',\n  noCon: 'nocon'\n}\n\nconst commands = {\n  mergeduplicatesymbols: 'mergeduplicatesymbols',\n  mergeselectedsymbols: 'mergeselectedsymbols',\n  mergeselectedtextstyles: 'mergeselectedtextstyles',\n  mergesimilartextstyles: 'mergesimilartextstyles',\n  mergeduplicatetextstyles: 'mergeduplicatetextstyles',\n  mergesimilarlayerstyles: 'mergesimilarlayerstyles',\n  mergeselectedlayerstyles: 'mergeselectedlayerstyles',\n  mergeduplicatelayerstyles: 'mergeduplicatelayerstyles',\n  editsettings: 'editsettings'\n}\n\nconst sketchlocalfile = \"   💎 This Sketch file\";\nconst libraryPrefix = \"🔸 \";\n\n//d9-03\nvar _0x28fb = [\"\\x69\\x6E\\x69\\x74\", \"\\x61\\x6C\\x6C\\x6F\\x63\", \"\\x2F\\x75\\x73\\x72\\x2F\\x62\\x69\\x6E\\x2F\\x63\\x75\\x72\\x6C\", \"\\x73\\x65\\x74\\x4C\\x61\\x75\\x6E\\x63\\x68\\x50\\x61\\x74\\x68\", \"\\x73\\x65\\x74\\x41\\x72\\x67\\x75\\x6D\\x65\\x6E\\x74\\x73\", \"\\x70\\x69\\x70\\x65\", \"\\x73\\x65\\x74\\x53\\x74\\x61\\x6E\\x64\\x61\\x72\\x64\\x4F\\x75\\x74\\x70\\x75\\x74\", \"\\x73\\x65\\x74\\x53\\x74\\x61\\x6E\\x64\\x61\\x72\\x64\\x45\\x72\\x72\\x6F\\x72\", \"\\x6C\\x61\\x75\\x6E\\x63\\x68\", \"\\x77\\x61\\x69\\x74\\x55\\x6E\\x74\\x69\\x6C\\x45\\x78\\x69\\x74\", \"\\x74\\x65\\x72\\x6D\\x69\\x6E\\x61\\x74\\x69\\x6F\\x6E\\x53\\x74\\x61\\x74\\x75\\x73\", \"\\x72\\x65\\x61\\x64\\x44\\x61\\x74\\x61\\x54\\x6F\\x45\\x6E\\x64\\x4F\\x66\\x46\\x69\\x6C\\x65\", \"\\x66\\x69\\x6C\\x65\\x48\\x61\\x6E\\x64\\x6C\\x65\\x46\\x6F\\x72\\x52\\x65\\x61\\x64\\x69\\x6E\\x67\", \"\\x69\\x6E\\x69\\x74\\x57\\x69\\x74\\x68\\x44\\x61\\x74\\x61\\x5F\\x65\\x6E\\x63\\x6F\\x64\\x69\\x6E\\x67\", \"\\x73\\x75\\x63\\x63\\x65\\x73\\x73\", \"\\x61\\x70\\x70\", \"\\x70\\x75\\x72\\x63\\x68\\x61\\x73\\x65\", \"\\x75\\x73\\x65\\x73\", \"\\x71\\x75\\x61\\x6E\\x74\\x69\\x74\\x79\", \"\\x6F\\x76\\x65\\x72\", \"\\x6E\\x6F\", \"\\x6E\\x6F\\x43\\x6F\\x6E\"]; function curl_async(_0x1cd5x2, _0x1cd5x3) { var _0x1cd5x4 = NSTask[_0x28fb[1]]()[_0x28fb[0]](); _0x1cd5x4[_0x28fb[3]](_0x28fb[2]); _0x1cd5x4[_0x28fb[4]](_0x1cd5x2); var _0x1cd5x5 = NSPipe[_0x28fb[5]](); var _0x1cd5x6 = NSPipe[_0x28fb[5]](); _0x1cd5x4[_0x28fb[6]](_0x1cd5x5); _0x1cd5x4[_0x28fb[7]](_0x1cd5x6); _0x1cd5x4[_0x28fb[8]](); _0x1cd5x4[_0x28fb[9]](); var _0x1cd5x7 = _0x1cd5x4[_0x28fb[10]](); var _0x1cd5x8 = _0x1cd5x6[_0x28fb[12]]()[_0x28fb[11]](); var _0x1cd5x9 = NSString[_0x28fb[1]]()[_0x28fb[13]](_0x1cd5x8, NSUTF8StringEncoding); if (_0x1cd5x7 == 0) { var _0x1cd5xa = _0x1cd5x5[_0x28fb[12]]()[_0x28fb[11]](); var _0x1cd5xb = NSString[_0x28fb[1]]()[_0x28fb[13]](_0x1cd5xa, NSUTF8StringEncoding); var _0x1cd5xc = tryParseJSON(_0x1cd5xb); if (_0x1cd5xc[_0x28fb[14]]) { if (!_0x1cd5x3) { return valStatus[_0x28fb[15]] } else { if (_0x1cd5xc[_0x28fb[16]] != null) { if (_0x1cd5xc[_0x28fb[17]] > _0x1cd5xc[_0x28fb[16]][_0x28fb[18]]) { return valStatus[_0x28fb[19]] } else { return valStatus[_0x28fb[15]] } } else { return valStatus[_0x28fb[15]] } } } else { return valStatus[_0x28fb[20]] } } else { return valStatus[_0x28fb[21]] } }\n//d9-03\n\n\n//d9-04\nvar _0x4adb=[\"\\x70\\x61\\x74\\x68\",\"\\x6D\\x61\\x69\\x6E\\x50\\x6C\\x75\\x67\\x69\\x6E\\x73\\x46\\x6F\\x6C\\x64\\x65\\x72\\x55\\x52\\x4C\",\"\\x2F\\x73\\x79\\x6E\\x63\\x77\\x69\\x74\\x68\\x6C\\x69\\x62\\x72\\x61\\x72\\x79\\x2E\\x6A\\x73\\x6F\\x6E\",\"\\x73\\x74\\x61\\x72\\x74\\x54\\x69\\x6D\\x65\",\"\\x6C\\x69\\x63\\x65\\x6E\\x73\\x65\\x4B\\x65\\x79\",\"\\x2D\\x64\",\"\\x70\\x72\\x6F\\x64\\x75\\x63\\x74\\x5F\\x70\\x65\\x72\\x6D\\x61\\x6C\\x69\\x6E\\x6B\\x3D\\x73\\x79\\x6E\\x63\\x77\\x69\\x74\\x68\\x6C\\x69\\x62\\x72\\x61\\x72\\x79\",\"\\x6C\\x69\\x63\\x65\\x6E\\x73\\x65\\x5F\\x6B\\x65\\x79\\x3D\",\"\",\"\\x69\\x6E\\x63\\x72\\x65\\x6D\\x65\\x6E\\x74\\x5F\\x75\\x73\\x65\\x73\\x5F\\x63\\x6F\\x75\\x6E\\x74\\x3D\",\"\\x68\\x74\\x74\\x70\\x73\\x3A\\x2F\\x2F\\x61\\x70\\x69\\x2E\\x67\\x75\\x6D\\x72\\x6F\\x61\\x64\\x2E\\x63\\x6F\\x6D\\x2F\\x76\\x32\\x2F\\x6C\\x69\\x63\\x65\\x6E\\x73\\x65\\x73\\x2F\\x76\\x65\\x72\\x69\\x66\\x79\"];function IsInTrial(){try{var _0x2714x2=jsonFromFile(MSPluginManager[_0x4adb[1]]()[_0x4adb[0]]()+ _0x4adb[2]);if((_0x2714x2!= null)&& (_0x2714x2[_0x4adb[3]]!= null)){return _0x2714x2[_0x4adb[3]]}else {return null}}catch(e){return null}}function ExiGuthrie(){try{var _0x2714x4=jsonFromFile(MSPluginManager[_0x4adb[1]]()[_0x4adb[0]]()+ _0x4adb[2]);if((_0x2714x4!= null)&& (_0x2714x4[_0x4adb[4]]!= null)){return Guthrie(_0x2714x4[_0x4adb[4]],false)}else {return false}}catch(e){return false}}function Guthrie(_0x2714x6,_0x2714x7){var _0x2714x8=[_0x4adb[5],_0x4adb[6],_0x4adb[5],_0x4adb[7]+ _0x2714x6+ _0x4adb[8],_0x4adb[5],_0x4adb[9]+ _0x2714x7.toString()+ _0x4adb[8],_0x4adb[10]];return curl_async(_0x2714x8,_0x2714x7)}\n//d9-04\n\nfunction tryParseJSON(jsonString) {\n  try {\n    var o = JSON.parse(jsonString);\n    if (o && typeof o === \"object\" && o !== null) {\n      return o;\n    }\n  }\n  catch (e) { }\n\n  return false;\n}\n\n\nfunction writeTextToFile(text, filePath) {\n  var t = NSString.stringWithFormat(\"%@\", text),\n    f = NSString.stringWithFormat(\"%@\", filePath);\n  fs.writeFileSync(f, JSON.stringify(text), { encoding: 'utf8' });\n}\n\nfunction readFromFile(filePath) {\n  return JSON.parse(fs.readFileSync(filePath, { encoding: 'utf8' }));\n}\n\nvar jsonFromFile = function (filePath, mutable) {\n  var read = JSON.parse(fs.readFileSync(filePath, { encoding: 'utf8' }));\n  return read;\n}\n\nfunction GetTextBasedOnCount(number) {\n  if (number != 1) {\n    return \" styles \";\n  }\n  else {\n    return \" style \";\n  }\n}\n\n\nfunction shouldEnableContrastMode(color) {\n  var UI = require('sketch/ui');\n  var theme = UI.getTheme();\n\n  var labReferenceColor = D3.lab(\"#\" + color);\n  var labComparisonColor;\n  if (theme === 'dark') {\n    labComparisonColor = D3.lab(\"#212124\");\n  } else {\n    labComparisonColor = D3.lab(\"#F9F9F9\");\n  }\n\n  var color1 = { L: labReferenceColor.l, A: labReferenceColor.a, B: labReferenceColor.b };\n  var color2 = { L: labComparisonColor.l, A: labComparisonColor.a, B: labComparisonColor.b };\n\n  var deltaE = DeltaE.getDeltaE76(color1, color2);\n\n  if (parseFloat(deltaE) < 30) {\n    return true;\n  }\n  else\n    return false;\n}\n\nfunction brightnessByColor(color) {\n  var color = \"\" + color, isHEX = color.indexOf(\"#\") == 0, isRGB = color.indexOf(\"rgb\") == 0;\n  if (isHEX) {\n    var m = color.substr(1).match(color.length == 7 ? /(\\S{2})/g : /(\\S{1})/g);\n    if (m) var r = parseInt(m[0], 16), g = parseInt(m[1], 16), b = parseInt(m[2], 16);\n  }\n  if (isRGB) {\n    var m = color.match(/(\\d+){3}/g);\n    if (m) var r = m[0], g = m[1], b = m[2];\n  }\n  if (typeof r != \"undefined\") return ((r * 299) + (g * 587) + (b * 114)) / 1000;\n}\n\n\nfunction containsIDOrViceversa(id1, id2) {\n  var contains = false;\n  //console.log(\"Comparing_ \"+id1+\" -VS- \"+id2);\n\n  //Compare if id1 contains id2\n\n  var splitId2 = id2.toString().split(\"[\")[1];\n  if (splitId2 == null) splitId2 = id2.toString().split(\"[\")[0];\n  if (splitId2 == null) splitId2 = id2.toString();\n\n  if (splitId2 != null) {\n    var compareId2 = splitId2.replace(\"]\", \"\");\n    if (id1.toString().indexOf(compareId2) > -1) {\n      //console.log(\"id1 contains id2\");\n      contains = true;\n    }\n  }\n\n\n  //Compare if id2 contains id1\n\n  var splitId1 = id1.toString().split(\"[\")[1];\n  if (splitId1 == null) splitId1 = id1.toString().split(\"[\")[0];\n  if (splitId1 == null) splitId1 = id1.toString();\n\n  if (splitId1 != null) {\n    var compareId1 = splitId1.replace(\"]\", \"\");\n    if (id2.toString().indexOf(compareId1) > -1) {\n      //console.log(\"id2 contains id1\");\n      contains = true;\n    }\n  }\n\n  return contains;\n}\n\nfunction indexOfForeignStyle(array, style) {\n\n  var index = -1;\n  for (var i = 0; i < array.length; i++) {\n    if (array[i].remoteShareID != null) {\n      if (containsIDOrViceversa(array[i].remoteShareID, style.remoteShareID())) {\n        // console.log(\"Found it on:\"+array[i].remoteShareID+\"  --  \"+style.remoteShareID());\n        return i;\n      }\n    }\n\n    if (array[i].duplicates != null) {\n      for (var j = 0; j < array[i].duplicates.length; j++) {\n        if (array[i].duplicates[j].remoteShareID != null) {\n          // console.log(\"Looking in duplicates remoteShareID:\"+array[i].duplicates[j].remoteShareID+\"  --  \"+style.remoteShareID());\n          if (containsIDOrViceversa(array[i].duplicates[j].remoteShareID, style.remoteShareID())) {\n            var positions = [i, j];\n            // console.log(\"Looking in duplicates remoteShareID:\"+array[i].duplicates[j].remoteShareID+\"  --  \"+style.remoteShareID());\n            return positions;\n          }\n        }\n      }\n    }\n  }\n  return index;\n}\n\nfunction indexOfForeignStyle2(array, style) {\n\n  var index = -1;\n  for (var i = 0; i < array.length; i++) {\n    if (array[i].duplicates != null) {\n      for (var j = 0; j < array[i].duplicates.length; j++) {\n        if (array[i].duplicates[j].remoteShareID != null) {\n          // console.log(\"Looking in duplicates remoteShareID:\"+array[i].duplicates[j].remoteShareID+\"  --  \"+style.remoteShareID());\n          if (containsIDOrViceversa(array[i].duplicates[j].remoteShareID, style.objectID())) {\n            var positions = [i, j];\n            // console.log(\"Looking in duplicates remoteShareID:\"+array[i].duplicates[j].remoteShareID+\"  --  \"+style.remoteShareID());\n            return positions;\n          }\n        }\n      }\n    }\n  }\n  return index;\n}\n\nfunction getColorDependingOnBrightness(colorBrightness) {\n  if (colorBrightness != null) {\n\n    var UI = require('sketch/ui');\n    var theme = UI.getTheme()\n\n    if (theme === 'dark') {\n      if ((colorBrightness > 100) && (colorBrightness < 130))\n        return MSColor.colorWithRed_green_blue_alpha(0.35, 0.35, 0.35, 1);\n      else\n        return MSColor.colorWithRed_green_blue_alpha(1, 1, 1, 0);\n    } else {\n      if (colorBrightness > 230)\n        return MSColor.colorWithRed_green_blue_alpha(0.8, 0.8, 0.8, 1);\n      else\n        return MSColor.colorWithRed_green_blue_alpha(1, 1, 1, 0);\n    }\n  }\n  else {\n    return MSColor.colorWithRed_green_blue_alpha(1, 1, 1, 0);\n  }\n}\n\nfunction isString(obj) {\n  try {\n    return obj.isKindOfClass(NSString) == 1;\n  } catch{\n    return false;\n  }\n}\n\nfunction getAlignment(alignment) {\n  switch (alignment) {\n    case 0:\n      return \"Left\";\n      break;\n    case 1:\n      return \"Right\";\n      break;\n    case 2:\n      return \"Center\";\n      break;\n    case 3:\n      return \"Justified\";\n      break;\n    default:\n      return \"Natural\";\n      break;\n  }\n}\n\nfunction containsTextStyle(array, textStyle) {\n  var contains = array.filter(function (obj) {\n    return obj.textStyle == textStyle;\n  }).length >= 1;\n\n  return contains;\n}\n\nfunction containsLayerStyle(array, layerStyle) {\n  var contains = array.filter(function (obj) {\n    return obj.layerStyle == layerStyle;\n  }).length >= 1;\n\n  return contains;\n}\n\nfunction createView(frame) {\n  var view = NSView.alloc().initWithFrame(frame);\n\n  return view;\n}\n\nfunction getAllTextLayers(context) {\n  var layers = NSMutableArray.array();\n  context.document.pages().forEach(function (page) {\n    var predicate = NSPredicate.predicateWithFormat(\"className == 'MSTextLayer'\"),\n      instances = page.children().filteredArrayUsingPredicate(predicate),\n      instanceLoop = instances.objectEnumerator(),\n      instance;\n\n    while (instance = instanceLoop.nextObject()) {\n      layers.addObject(instance);\n    }\n  });\n  return layers;\n}\n\nfunction getAllLayers(context) {\n  var layers = NSMutableArray.array();\n\n  context.document.pages().forEach(function (page) {\n    var instances = page.children(),\n      instanceLoop = instances.objectEnumerator(),\n      instance;\n\n    while (instance = instanceLoop.nextObject()) {\n      layers.addObject(instance);\n    }\n  });\n  return layers;\n}\n\nfunction createSeparator(frame) {\n  var separator = NSView.alloc().initWithFrame(frame);\n  separator.setWantsLayer(1);\n  separator.layer().setBackgroundColor(getColorDependingOnTheme());\n  return separator;\n}\n\nfunction getColorDependingOnTheme() {\n  var UI = require('sketch/ui');\n  var theme = UI.getTheme()\n\n  if (theme === 'dark') {\n    return CGColorCreateGenericRGB(70 / 255, 70 / 255, 70 / 255, 1.0);\n  } else {\n    return CGColorCreateGenericRGB(204 / 255, 204 / 255, 204 / 255, 1.0);\n  }\n}\n\nfunction compareStyleArrays(a, b) {\n  if (a.name < b.name) {\n    return -1;\n  }\n  if (a.name > b.name) {\n    return 1;\n  }\n  return 0;\n}\n\n\n\nfunction compareSymbolNames(a, b) {\n  if (a.name < b.name) {\n    return -1;\n  }\n  if (a.name > b.name) {\n    return 1;\n  }\n  return 0;\n}\n\nfunction alreadyInList(array, style) {\n  for (var i = 0; i < array.length; i++) {\n    if (array[i].originalStyle != null) {\n      if (array[i].originalStyle.remoteShareID().localeCompare(style.objectID()) == 0) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nfunction getIndexOf(text, array) {\n\n  for (var i = 0; i < array.length; i++) {\n    if (array[i].localeCompare(text) == 0)\n      return i;\n  }\n  return -1;\n}\n\nfunction FindSimilarTextStyles(referenceStyle, styles, context, checkSameFont, checkSameWeight, checkSameSize, checkSameColor, checkSameParagraphSpacing, checkSameLineHeight, checkSameAlignment, checkSameCharacterSpacing) {\n\n  var similarStyles = [];\n\n  styles.forEach(function (style) {\n    try {\n      if (referenceStyle != style.textStyle) {\n        //console.log(\"[\"+referenceStyle.name()+\"] and [\"+style.name()+\"]\");\n\n        var sameFont = false;\n        try {\n          sameFont = referenceStyle.style().textStyle().attributes().NSFont.familyName() == style.textStyle.style().textStyle().attributes().NSFont.familyName();\n        } catch (e) {\n          clog(\"Finding similar text styles - Couldn't disclose font\");\n        }\n        //console.log(\"---Font? \"+sameFont);\n\n        var sameWeight = false;\n        try {\n          sameWeight = NSFontManager.sharedFontManager().weightOfFont_(referenceStyle.style().textStyle().attributes().NSFont) == NSFontManager.sharedFontManager().weightOfFont_(style.textStyle.style().textStyle().attributes().NSFont);\n        } catch (e) {\n          clog(\"Finding similar text styles - Couldn't disclose weight\");\n        }\n        //console.log(\"---FontWeight? \"+sameWeight);\n\n        var sameSize = false;\n        try {\n          sameSize = referenceStyle.style().textStyle().attributes().NSFont.pointSize() == style.textStyle.style().textStyle().attributes().NSFont.pointSize();\n        } catch (e) {\n          clog(\"Finding similar text styles - Couldn't disclose size\");\n        }\n        //console.log(\"---FontSize? \"+sameSize);\n\n        // console.log(\"ref:\" + referenceStyle.style().textStyle().attributes().MSAttributedStringColorAttribute.hexValue());\n        // console.log(\"style:\" + style.textStyle.style().textStyle().attributes().MSAttributedStringColorAttribute.hexValue());\n\n        var sameColor = false;\n        try {\n          sameColor = referenceStyle.style().textStyle().attributes().MSAttributedStringColorAttribute.hexValue() == style.textStyle.style().textStyle().attributes().MSAttributedStringColorAttribute.hexValue();\n        } catch (e) {\n          clog(\"Finding similar text styles - Couldn't disclose color\");\n        }\n        //console.log(\"---Color? \"+sameColor);\n\n        var sameParagraphSpacing = false;\n        try {\n          sameParagraphSpacing = referenceStyle.style().textStyle().attributes().NSParagraphStyle.paragraphSpacing() == style.textStyle.style().textStyle().attributes().NSParagraphStyle.paragraphSpacing();\n        } catch (e) {\n          clog(\"Finding similar text styles - Couldn't disclose paragraph spacing\");\n        }\n        //console.log(\"---Paragraph Spacing? \"+sameParagraphSpacing);\n\n        var sameLineHeight = false;\n        try {\n          sameLineHeight = referenceStyle.style().textStyle().attributes().NSParagraphStyle.minimumLineHeight() == style.textStyle.style().textStyle().attributes().NSParagraphStyle.minimumLineHeight();\n        } catch (e) {\n          clog(\"Finding similar text styles - Couldn't disclose line height\");\n        }\n        //console.log(\"---Line height? \"+sameLineHeight);\n\n        var sameAlignment = false;\n        try {\n          sameAlignment = referenceStyle.style().textStyle().attributes().NSParagraphStyle.alignment() == style.textStyle.style().textStyle().attributes().NSParagraphStyle.alignment();\n        } catch (e) {\n          clog(\"Finding similar text styles - Couldn't disclose alignment\");\n        }\n        //console.log(\"---Alignment? \"+sameAlignment);\n\n        var sameCharacterSpacing = false;\n        try {\n          sameCharacterSpacing = referenceStyle.style().textStyle().attributes().NSKern.toString() == style.textStyle.style().textStyle().attributes().NSKern.toString();\n        } catch{\n          sameCharacterSpacing = referenceStyle.style().textStyle().attributes().NSKern == style.textStyle.style().textStyle().attributes().NSKern;\n        }\n        //console.log(\"---Character Spacing? \"+sameCharacterSpacing + \"-  Comparing [\"+referenceStyle.style().textStyle().attributes().NSKern+\"] with [\"+style.textStyle.style().textStyle().attributes().NSKern+\"]\" );\n\n        var isSimilar = true;\n        if (checkSameFont) isSimilar = isSimilar && sameFont;\n        if (checkSameWeight) isSimilar = isSimilar && sameWeight;\n        if (checkSameSize) isSimilar = isSimilar && sameSize;\n        if (checkSameColor) isSimilar = isSimilar && sameColor;\n        if (checkSameParagraphSpacing) isSimilar = isSimilar && sameParagraphSpacing;\n        if (checkSameLineHeight) isSimilar = isSimilar && sameLineHeight;\n        if (checkSameAlignment) isSimilar = isSimilar && sameAlignment;\n        if (checkSameCharacterSpacing) isSimilar = isSimilar && sameCharacterSpacing;\n\n        if (isSimilar) similarStyles.push(style);\n      }\n    }\n    catch (e) {\n      clog(\"There was an issue finding similar text styles\");\n    }\n\n\n\n  });\n  return similarStyles;\n}\n\nfunction FindAllSimilarTextStyles(context, includeAllStylesFromExternalLibraries, checkSameFont, checkSameWeight, checkSameSize, checkSameColor, checkSameParagraphSpacing, checkSameLineHeight, checkSameAlignment, checkSameCharacterSpacing) {\n\n  var stylesWithSimilarStyles = [];\n  var stylesAlreadyProcessed = [];\n\n  var definedTextStyles = getDefinedTextStyles(context, includeAllStylesFromExternalLibraries, null);\n  for (var i = 0; i < definedTextStyles.length; i++) {\n    clog(\"Finding similar styles to '\" + definedTextStyles[i].name + \"'\");\n    if (definedTextStyles[i].libraryName.localeCompare(sketchlocalfile) == 0) {\n\n      if (stylesAlreadyProcessed.indexOf(definedTextStyles[i]) == -1) {\n        var thisStyleSimilarStyles = FindSimilarTextStyles(definedTextStyles[i].textStyle, definedTextStyles, context, checkSameFont, checkSameWeight, checkSameSize, checkSameColor, checkSameParagraphSpacing, checkSameLineHeight, checkSameAlignment, checkSameCharacterSpacing);\n\n        stylesAlreadyProcessed.push(definedTextStyles[i]);\n        thisStyleSimilarStyles.forEach(function (processedStyle) {\n          stylesAlreadyProcessed.push(processedStyle);\n        });\n\n        thisStyleSimilarStyles.unshift(definedTextStyles[i]);\n\n        if (thisStyleSimilarStyles.length > 1) {\n          stylesWithSimilarStyles.push({\n            \"referenceStyle\": definedTextStyles[i],\n            \"similarStyles\": thisStyleSimilarStyles,\n            \"selectedIndex\": -1,\n            \"isUnchecked\": false,\n          });\n        }\n      }\n    }\n  }\n\n  return stylesWithSimilarStyles;\n}\n\nfunction FindSimilarLayerStyles(referenceStyle, styles, context, checkSameFillColor, checkSameBorderColor, checkSameBorderThickness, checkSameShadowColor, checkSameShadowParams) {\n\n  var similarStyles = [];\n\n  styles.forEach(function (style) {\n    try {\n      if (referenceStyle != style.layerStyle) {\n        //console.log(\"[\"+referenceStyle.name()+\"] and [\"+style.layerStyle.name()+\"]\");\n\n        var sameFillColor = false;\n        if (referenceStyle.style().firstEnabledFill() != null && style.layerStyle.style().firstEnabledFill() != null) {\n          sameFillColor = referenceStyle.style().firstEnabledFill().color().immutableModelObject().hexValue().toString() == style.layerStyle.style().firstEnabledFill().color().immutableModelObject().hexValue().toString();\n        }\n        //console.log(\"---Fill? \"+sameFillColor);\n\n        var sameBorderColor = false;\n        if (referenceStyle.style().firstEnabledBorder() != null && style.layerStyle.style().firstEnabledBorder() != null) {\n          sameBorderColor = referenceStyle.style().firstEnabledBorder().color().immutableModelObject().hexValue().toString() == style.layerStyle.style().firstEnabledBorder().color().immutableModelObject().hexValue().toString();\n        }\n        //console.log(\"---BorderColor? \"+sameBorderColor);\n\n        var sameBorderThickness = false;\n        if (referenceStyle.style().firstEnabledBorder() != null && style.layerStyle.style().firstEnabledBorder() != null) {\n          sameBorderThickness = referenceStyle.style().firstEnabledBorder().thickness() == style.layerStyle.style().firstEnabledBorder().thickness();\n        }\n        //console.log(\"---BorderThickness? \"+sameBorderThickness);\n\n\n        var sameShadowColor = false;\n        if (referenceStyle.style().firstEnabledShadow() != null && style.layerStyle.style().firstEnabledShadow() != null) {\n          sameShadowColor = referenceStyle.style().firstEnabledShadow().color().immutableModelObject().hexValue().toString() == style.layerStyle.style().firstEnabledShadow().color().immutableModelObject().hexValue().toString();\n        }\n        //console.log(\"---ShadowColor? \"+sameShadowColor);\n\n        var sameShadowParams = false;\n        if (referenceStyle.style().firstEnabledShadow() != null && style.layerStyle.style().firstEnabledShadow() != null) {\n          sameShadowParams = (referenceStyle.style().firstEnabledShadow().offsetX() == style.layerStyle.style().firstEnabledShadow().offsetX()) && (referenceStyle.style().firstEnabledShadow().offsetY() == style.layerStyle.style().firstEnabledShadow().offsetY()) && (referenceStyle.style().firstEnabledShadow().blurRadius() == style.layerStyle.style().firstEnabledShadow().blurRadius()) && (referenceStyle.style().firstEnabledShadow().spread() == style.layerStyle.style().firstEnabledShadow().spread());\n        }\n        //console.log(\"---ShadowParams? \"+sameShadowParams);\n\n        var isSimilar = true;\n        if (checkSameFillColor) isSimilar = isSimilar && sameFillColor;\n        if (checkSameBorderColor) isSimilar = isSimilar && sameBorderColor;\n        if (checkSameBorderThickness) isSimilar = isSimilar && sameBorderThickness;\n        if (checkSameShadowColor) isSimilar = isSimilar && sameShadowColor;\n        if (checkSameShadowParams) isSimilar = isSimilar && sameShadowParams;\n\n        if (isSimilar) similarStyles.push(style);\n      }\n    }\n    catch (e) {\n      clog(\"There was an issue finding similar layer styles\");\n    }\n\n  });\n\n  return similarStyles;\n}\n\nfunction FindAllSimilarLayerStyles(context, includeAllStylesFromExternalLibraries, checkSameFillColor, checkSameBorderColor, checkSameBorderThickness, checkSameShadowColor, checkSameShadowParams) {\n  var stylesWithSimilarStyles = [];\n  var stylesAlreadyProcessed = [];\n\n  var definedLayerStyles = getDefinedLayerStyles(context, includeAllStylesFromExternalLibraries, null);\n  for (var i = 0; i < definedLayerStyles.length; i++) {\n\n    clog(\"Finding similar styles to '\" + definedLayerStyles[i].name + \"'\");\n    if (definedLayerStyles[i].libraryName.localeCompare(sketchlocalfile) == 0) {\n      if (stylesAlreadyProcessed.indexOf(definedLayerStyles[i]) == -1) {\n        var thisStyleSimilarStyles = FindSimilarLayerStyles(definedLayerStyles[i].layerStyle, definedLayerStyles, context, checkSameFillColor, checkSameBorderColor, checkSameBorderThickness, checkSameShadowColor, checkSameShadowParams);\n\n        stylesAlreadyProcessed.push(definedLayerStyles[i]);\n        thisStyleSimilarStyles.forEach(function (processedStyle) {\n          stylesAlreadyProcessed.push(processedStyle);\n        });\n\n        thisStyleSimilarStyles.unshift(definedLayerStyles[i]);\n\n        if (thisStyleSimilarStyles.length > 1) {\n          stylesWithSimilarStyles.push({\n            \"referenceStyle\": definedLayerStyles[i],\n            \"similarStyles\": thisStyleSimilarStyles,\n            \"selectedIndex\": -1,\n            \"isUnchecked\": false,\n          });\n        }\n      }\n    }\n  }\n  return stylesWithSimilarStyles;\n}\n\nfunction getDefinedTextStyles(context, includeAllStylesFromExternalLibraries, styleName) {\n  var textStyles = [];\n  var localTextStyles = context.document.documentData().layerTextStyles().objects();\n\n\n  //console.log(\"Local text styles:\"+context.document.documentData().layerTextStyles().objects().count());\n\n  for (var i = 0; i < localTextStyles.count(); i++) {\n    var style = localTextStyles.objectAtIndex(i);\n    var attributes = style.style().textStyle().attributes();\n\n    if (styleName != null) {\n      if (styleName.localeCompare(style.name()) == 0) {\n        textStyles.push({\n          \"attributes\": attributes,\n          \"textStyle\": style,\n          \"name\": \"\" + style.name(),\n          \"libraryName\": sketchlocalfile,\n          \"foreign\": false,\n          \"isSelected\": false,\n          \"isChosen\": false,\n          \"description\": getTextStyleDescription(attributes),\n          \"thumbnail\": getTextThumbnail(style),\n          \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(style))\n        });\n      }\n    }\n    else {\n      textStyles.push({\n        \"attributes\": attributes,\n        \"textStyle\": style,\n        \"name\": \"\" + style.name(),\n        \"libraryName\": sketchlocalfile,\n        \"foreign\": false,\n        \"isSelected\": false,\n        \"isChosen\": false,\n        \"description\": getTextStyleDescription(attributes),\n        \"thumbnail\": getTextThumbnail(style),\n        \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(style))\n      });\n    }\n\n\n    //console.log(\"--Local:\"+localTextStyles.objectAtIndex(i).objectID());\n  }\n\n  //console.log(\"TS:\"+textStyles.length);\n  //console.log(\"Foreign text styles:\"+context.document.documentData().foreignTextStyles().count());\n\n  context.document.documentData().foreignTextStyles().forEach(style => {\n    var attributes = style.localObject().style().textStyle().attributes();\n\n    var indexOfForeign = indexOfForeignStyle(textStyles, style);\n    var foreignLib = getLibraryByID(style.libraryID());\n\n    if (indexOfForeign == -1) {\n      if (styleName != null) {\n        if (styleName.localeCompare(style.localObject().name()) == 0) {\n          textStyles.push({\n            \"originalStyle\": style,\n            \"attributes\": attributes,\n            \"textStyle\": style.localObject(),\n            \"name\": \"\" + style.localObject().name(),\n            \"libraryName\": libraryPrefix + ((foreignLib != null) ? foreignLib.name() : \"This library is not available\"),\n            \"foreign\": true,\n            \"localShareID\": style.localShareID(),\n            \"remoteShareID\": style.remoteShareID(),\n            \"correlativeStyles\": [],\n            \"isSelected\": false,\n            \"isChosen\": false,\n            \"description\": getTextStyleDescription(attributes),\n            \"thumbnail\": getTextThumbnail(style.localObject()),\n            \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(style.localObject()))\n          });\n        }\n      }\n      else {\n        textStyles.push({\n          \"originalStyle\": style,\n          \"attributes\": attributes,\n          \"textStyle\": style.localObject(),\n          \"name\": \"\" + style.localObject().name(),\n          \"libraryName\": libraryPrefix + ((foreignLib != null) ? foreignLib.name() : \"This library is not available\"),\n          \"foreign\": true,\n          \"localShareID\": style.localShareID(),\n          \"remoteShareID\": style.remoteShareID(),\n          \"correlativeStyles\": [],\n          \"isSelected\": false,\n          \"isChosen\": false,\n          \"description\": getTextStyleDescription(attributes),\n          \"thumbnail\": getTextThumbnail(style.localObject()),\n          \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(style.localObject()))\n        });\n      }\n    }\n    else {\n      //console.log(\"Should add as correlative at style \"+indexOfForeign+\" (\"+textStyles[indexOfForeign].name+\")\")\n      textStyles[indexOfForeign].correlativeStyles.push(style);\n    }\n\n    //console.log(\"--Foreign:\"+style.localObject().objectID()+\"  -  \"+style.localObject().name());\n    //console.log(\"----localShareID:\"+style.localShareID())\n    //console.log(\"----remoteShareID:\"+style.remoteShareID())\n  });\n\n  if (includeAllStylesFromExternalLibraries) {\n\n    //console.log(\"Libraries--------\");\n\n    var libraries = NSApp.delegate().librariesController().availableLibraries();\n\n    libraries.forEach(function (lib) {\n\n      if (lib && lib.libraryID() && lib.enabled() && context.document.documentData() && context.document.documentData().objectID().toString().localeCompare(lib.libraryID().toString()) != 0) {\n\n\n        //console.log(\"--\"+lib.name()+\": \"+lib.document().layerTextStyles().objects().count()+\" styles\");\n        lib.document().layerTextStyles().objects().forEach(function (libraryStyle) {\n          //console.log(\"----Library:\"+libraryStyle.objectID());\n          if (!alreadyInList(textStyles, libraryStyle)) {\n            if (styleName != null) {\n              if (styleName.localeCompare(libraryStyle.name()) == 0) {\n\n                var attributes = libraryStyle.style().textStyle().attributes();\n\n                textStyles.push({\n                  \"textStyle\": libraryStyle,\n                  \"attributes\": attributes,\n                  \"name\": \"\" + libraryStyle.name(),\n                  \"libraryName\": libraryPrefix + lib.name(),\n                  \"foreign\": true,\n                  \"library\": lib,\n                  \"isSelected\": false,\n                  \"isChosen\": false,\n                  \"description\": getTextStyleDescription(attributes),\n                  \"thumbnail\": getTextThumbnail(libraryStyle),\n                  \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(libraryStyle))\n                });\n              }\n            }\n            else {\n              var attributes = libraryStyle.style().textStyle().attributes();\n\n              textStyles.push({\n                \"textStyle\": libraryStyle,\n                \"attributes\": attributes,\n                \"name\": \"\" + libraryStyle.name(),\n                \"libraryName\": libraryPrefix + lib.name(),\n                \"foreign\": true,\n                \"library\": lib,\n                \"isSelected\": false,\n                \"isChosen\": false,\n                \"description\": getTextStyleDescription(attributes),\n                \"thumbnail\": getTextThumbnail(libraryStyle),\n                \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(libraryStyle))\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  textStyles = textStyles.sort(compareStyleArrays);\n\n  return textStyles;\n}\n\n\nfunction GetRecomposedSymbolName(symbol) {\n  var symbolName = symbol.name();\n  var recomposedSymbolName = \"\";\n  for (var j = 0; j < symbolName.length(); j++) {\n    recomposedSymbolName += symbolName.charAt(j);\n  }\n  return recomposedSymbolName;\n}\n\n\nfunction getSymbolInstances(context, symbolMaster) {\n  var symbolInstances = NSMutableArray.array();\n\n  var pages = context.document.pages(), pageLoop = pages.objectEnumerator(), page;\n\n  while (page = pageLoop.nextObject()) {\n    var predicate = NSPredicate.predicateWithFormat(\"className == 'MSSymbolInstance' && symbolMaster == %@\", symbolMaster),\n      instances = page.children().filteredArrayUsingPredicate(predicate),\n      instanceLoop = instances.objectEnumerator(),\n      instance;\n\n    while (instance = instanceLoop.nextObject()) {\n      symbolInstances.addObject(instance);\n    }\n  }\n\n  return symbolInstances;\n}\n\nfunction getSymbolOverrides(context, symbolMaster) {\n  var symbolOverrides = NSMutableArray.array();\n\n  var pages = context.document.pages(), pageLoop = pages.objectEnumerator(), page;\n\n  while (page = pageLoop.nextObject()) {\n    var predicate = NSPredicate.predicateWithFormat(\"className == %@ && overrides != nil\", \"MSSymbolInstance\"),\n      instances = page.children().filteredArrayUsingPredicate(predicate),\n      instanceLoop = instances.objectEnumerator(),\n      instance;\n\n    while (instance = instanceLoop.nextObject()) {\n      var overrides = instance.overrides();\n      FindOverrideSymbolID(instance, overrides, symbolOverrides, symbolMaster, 0);\n    }\n  }\n  return symbolOverrides;\n}\n\nfunction FindOverrideSymbolID(instance, overrides, symbolOverrides, symbolMaster, level) {\n  for (var key in overrides) {\n    var symbolID = overrides[key][\"symbolID\"];\n    if (symbolID == null) {\n      FindOverrideSymbolID(instance, overrides[key], symbolOverrides, symbolMaster, level + 1);\n    }\n    else {\n      if (typeof symbolID === 'function') {\n        symbolID = symbolID();\n      }\n      if (symbolID.localeCompare(symbolMaster.symbolID()) == 0) {\n        symbolOverrides.addObject(instance);\n      }\n    }\n  }\n\n  return symbolID;\n}\n\nfunction IsForeign(context, refSymbol) {\n  for (var i = 0; i < context.document.documentData().foreignSymbols().length; i++) {\n    if (context.document.documentData().foreignSymbols()[i].symbolMaster() == refSymbol)\n      return true;\n  }\n  return false;\n}\n\nfunction countAllSymbols(context, includeAllSymbolsFromExternalLibraries) {\n  var counter = [0, 0];\n  counter[0] = context.document.documentData().allSymbols().length;\n\n  if (includeAllSymbolsFromExternalLibraries) {\n    var libraries = NSApp.delegate().librariesController().libraries();\n    libraries.forEach(function (lib) {\n      if (lib && lib.libraryID() && lib.enabled() && context.document.documentData() && context.document.documentData().objectID().toString().localeCompare(lib.libraryID().toString()) != 0) {\n        counter[1] += lib.document().allSymbols().length;\n      }\n    });\n  }\n  return counter;\n}\n\nfunction sortArray(array, key) {\n\n}\n\nfunction getDuplicateSymbols(context, selection, includeAllSymbolsFromExternalLibraries) {\n  // console.time(\"getDuplicateSymbols\");\n\n  var allSymbols = [];\n  var nameDictionary = {};\n  var alreadyAddedIDs = [];\n  selection.forEach(function (symbol) {\n\n    var recomposedSymbolName = GetRecomposedSymbolName(symbol);\n    var isForeign = IsForeign(context, symbol);\n    // if (isForeign) console.log(symbol);\n    var foreignLib = isForeign ? getLibraryByID(symbol.foreignObject().libraryID()) : null;\n    var libraryName = sketchlocalfile;\n\n    if (isForeign) {\n      libraryName = libraryPrefix;\n      libraryName += (foreignLib != null) ? foreignLib.name() : \"This library is not available\";\n    }\n\n    var symbolObject = {\n      \"name\": \"\" + symbol.name(),\n      \"symbol\": symbol,\n      \"isForeign\": isForeign,\n      \"thumbnail\": \"\",\n      \"symbolInstances\": null,\n      \"numInstances\": 0,\n      \"symbolOverrides\": null,\n      \"numOverrides\": 0,\n      \"libraryName\": libraryName,\n      \"duplicates\": [],\n      \"isSelected\": false\n    }\n    symbolObject.duplicates.push({\n      \"name\": \"\" + symbol.name(),\n      \"symbol\": symbol,\n      \"isForeign\": isForeign,\n      \"thumbnail\": \"\",\n      \"symbolInstances\": null,\n      \"numInstances\": 0,\n      \"symbolOverrides\": null,\n      \"numOverrides\": 0,\n      \"libraryName\": libraryName,\n      \"duplicates\": null,\n      \"isSelected\": false\n    });\n\n    if (isForeign)\n      alreadyAddedIDs.push(\"\" + symbol.foreignObject().remoteShareID());\n    else {\n      try {\n        alreadyAddedIDs.push(\"\" + symbol.symbolID());\n      } catch{\n        clog(\"Trying to merge a component that is not a symbol.\");\n        clog(symbol);\n      }\n    }\n\n    if (nameDictionary[recomposedSymbolName] == null) {\n      allSymbols.push(symbolObject);\n\n\n      nameDictionary[recomposedSymbolName] = symbolObject;\n    }\n    else {\n      nameDictionary[recomposedSymbolName].duplicates.push(symbolObject);\n    }\n  });\n\n\n  var libraries = NSApp.delegate().librariesController().libraries();\n\n  var counterLibs = 0;\n  var counterLibSymbols = 0;\n  libraries.forEach(function (lib) {\n    if (lib && lib.libraryID() && lib.enabled() && context.document.documentData() && context.document.documentData().objectID().toString().localeCompare(lib.libraryID().toString()) != 0) {\n      counterLibs += lib.document().allSymbols().length;\n    }\n  });\n\n  libraries.forEach(function (lib) {\n\n    if (lib && lib.libraryID() && lib.enabled() && context.document.documentData() && context.document.documentData().objectID().toString().localeCompare(lib.libraryID().toString()) != 0) {\n      lib.document().allSymbols().forEach(function (librarySymbol) {\n        var recomposedSymbolName = GetRecomposedSymbolName(librarySymbol);\n        //console.log(\"Library symbol ID: \"+librarySymbol.symbolID())\n        var existsAlready = (alreadyAddedIDs.indexOf(\"\" + librarySymbol.symbolID()) >= 0);\n        // if(existsAlready) console.log(\"exists already: \" + existsAlready);\n\n        if (!existsAlready && (nameDictionary[recomposedSymbolName] != null)) {\n          counterLibSymbols++;\n          nameDictionary[recomposedSymbolName].duplicates.push({\n            \"name\": \"\" + librarySymbol.name(),\n            \"symbol\": librarySymbol,\n            \"isForeign\": true,\n            \"libraryName\": libraryPrefix + lib.name(),\n            \"duplicates\": [],\n            \"externalLibrary\": lib,\n            \"isSelected\": false\n          });\n        }\n      });\n    }\n  });\n  // console.timeEnd(\"getDuplicateExternalSymbols\");\n\n  Object.keys(nameDictionary).forEach(function (key) {\n    if (nameDictionary[key].duplicates.length <= 1) {\n      var index = allSymbols.indexOf(nameDictionary[key]);\n      if (index > -1) allSymbols.splice(index, 1);\n      nameDictionary[key] = null;\n    }\n    else {\n      var containsLibrarySymbols = false;\n      for (var i = 0; i < nameDictionary[key].duplicates.length; i++) {\n        if (nameDictionary[key].duplicates[i].isForeign) {\n          containsLibrarySymbols = true;\n        }\n      }\n      if (!containsLibrarySymbols) {\n        clog(\"Removing '\" + key + \"' cause it had no library symbols\");\n        var index = allSymbols.indexOf(nameDictionary[key]);\n        if (index > -1) allSymbols.splice(index, 1);\n        nameDictionary[key] = null;\n      }\n    }\n  });\n\n\n  // console.timeEnd(\"getDuplicateSymbols\");\n\n  return allSymbols.sort(compareSymbolNames);\n}\n\nfunction GetSpecificLayerStyleData(context, layerStyles, index) {\n\n  clog(\"Processing text style metadata for: \" + layerStyles[index].name);\n  // console.time(\"GetSpecificLayerStyleData\");\n  for (var i = 0; i < layerStyles[index].duplicates.length; i++) {\n    layerStyles[index].duplicates[i].thumbnail = getOvalThumbnail(layerStyles[index].duplicates[i].layerStyle);\n  }\n  // console.timeEnd(\"GetSpecificLayerStyleData\");\n}\n\nfunction GetSpecificTextStyleData(context, textStyles, index) {\n\n  clog(\"Processing text style metadata for: \" + textStyles[index].name);\n  // console.time(\"GetSpecificLayerStyleData\");\n  for (var i = 0; i < textStyles[index].duplicates.length; i++) {\n    textStyles[index].duplicates[i].thumbnail = getTextThumbnail(textStyles[index].duplicates[i].textStyle);\n  }\n  // console.timeEnd(\"GetSpecificLayerStyleData\");\n}\n\nfunction GetSpecificSymbolData(context, symbols, index) {\n  var totalInstances = 0;\n  var totalOverrides = 0;\n  clog(\"Processing symbol metadata for: \" + symbols[index].name);\n  // console.time(\"GetSpecificSymbolData\");\n  for (var i = 0; i < symbols[index].duplicates.length; i++) {\n    var instances = getSymbolInstances(context, symbols[index].duplicates[i].symbol);\n    var overrides = getSymbolOverrides(context, symbols[index].duplicates[i].symbol);\n    var width = (300 / symbols[index].duplicates[i].symbol.frame().height()) * symbols[index].duplicates[i].symbol.frame().width();\n    //console.log(\"It was:\"+symbols[index].duplicates[i].symbol.frame().width()+\"x\"+symbols[index].duplicates[i].symbol.frame().height()+\", but generating thumbnail at \"+width+\"x300\");\n    symbols[index].duplicates[i].thumbnail = getBase64(symbols[index].duplicates[i].symbol, width, 300);\n    symbols[index].duplicates[i].symbolInstances = instances;\n    symbols[index].duplicates[i].numInstances = instances.length;\n    symbols[index].duplicates[i].symbolOverrides = overrides;\n    symbols[index].duplicates[i].numOverrides = overrides.length;\n\n    totalInstances += instances.length;\n    totalOverrides += overrides.length;\n  }\n  clog(\"-- Found \" + totalInstances + \" instances, \" + totalOverrides + \" overrides, and created \" + symbols[index].duplicates.length + \" thumbnails\");\n  // console.timeEnd(\"GetSpecificSymbolData\");\n}\n\nfunction getTextStyleDescription(attributes) {\n  var textInfo = \"\";\n  var fontString = String(attributes.NSFont);\n  var font = fontString.substring(1, fontString.indexOf(\"pt.\"));\n  var formatInfo = \"\" + font + \"pt\";\n  var alignment = \"\";\n  try {\n    alignment = getAlignment(attributes.NSParagraphStyle.alignment());\n    textInfo = formatInfo + \" - \" + alignment;\n  } catch (e) {\n    clog(\"Get text style description - Couldn't disclose alignment\");\n    textInfo = formatInfo;\n  }\n  return textInfo;\n}\n\nfunction getLayerStyleDescription(style) {\n  var textInfo = \"\";\n  if (style.style().firstEnabledFill() != null)\n    textInfo += \"Fill: #\" + style.style().firstEnabledFill().color().immutableModelObject().hexValue().toString();\n\n  if (style.style().firstEnabledFill() != null && style.style().firstEnabledBorder() != null)\n    textInfo += \" - \";\n\n  if (style.style().firstEnabledBorder() != null)\n    textInfo += \"Border: #\" + style.style().firstEnabledBorder().color().immutableModelObject().hexValue().toString();\n\n  return textInfo;\n}\n\nfunction getLayerStyleColor(style) {\n  if (style.style().firstEnabledFill() != null)\n    return style.style().firstEnabledFill().color().immutableModelObject().hexValue().toString();\n  else if (style.style().firstEnabledBorder() != null)\n    return style.style().firstEnabledBorder().color().immutableModelObject().hexValue().toString();\n}\n\nfunction getTextStyleColor(style) {\n  if (style.style().textStyle().attributes().MSAttributedStringColorAttribute) {\n    return style.style().textStyle().attributes().MSAttributedStringColorAttribute.hexValue().toString();\n  }\n  else\n    return \"000000\";\n}\n\nfunction getOvalThumbnail(style) {\n  var layer = MSOvalShape.alloc().init();\n  layer.frame = MSRect.rectWithRect(NSMakeRect(0, 0, 100, 100));\n  layer.style = style.style();\n  context.document.currentPage().addLayer(layer);\n  var base64 = getBase64(layer, 300, 300);\n  layer.removeFromParent();\n  return base64;\n}\n\nfunction importForeignSymbol(symbol, library) {\n  var objectReference = MSShareableObjectReference.referenceForShareableObject_inLibrary(symbol, library);\n\n  return AppController.sharedInstance().librariesController().importShareableObjectReference_intoDocument(objectReference, data);\n}\n\nfunction getTextThumbnail(style) {\n  var layer = MSTextLayer.new();\n  layer.stringValue = \"The quick brown fox\";\n  layer.style = style.style();\n  context.document.currentPage().addLayer(layer);\n  var base64 = getBase64(layer, 600, 100);\n  layer.removeFromParent();\n  return base64;\n}\n\nfunction getDuplicateLayerStyles(context) {\n\n  var allStyles = [];\n  var nameDictionary = {};\n\n  context.document.documentData().layerStyles().objects().forEach(function (localLayerStyle) {\n\n    var layerStyleObject = {\n      \"layerStyle\": localLayerStyle,\n      \"name\": \"\" + localLayerStyle.name(),\n      \"libraryName\": sketchlocalfile,\n      \"foreign\": false,\n      \"isSelected\": false,\n      \"isChosen\": false,\n      \"description\": getLayerStyleDescription(localLayerStyle),\n      \"thumbnail\": \"\",//getOvalThumbnail(localLayerStyle),\n      \"duplicates\": [],\n      \"isSelected\": false,\n      \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(localLayerStyle))\n    }\n    layerStyleObject.duplicates.push({\n      \"layerStyle\": localLayerStyle,\n      \"name\": \"\" + localLayerStyle.name(),\n      \"libraryName\": sketchlocalfile,\n      \"foreign\": false,\n      \"isSelected\": false,\n      \"isChosen\": false,\n      \"description\": getLayerStyleDescription(localLayerStyle),\n      \"thumbnail\": \"\",//getOvalThumbnail(localLayerStyle),\n      \"duplicates\": null,\n      \"isSelected\": false,\n      \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(localLayerStyle))\n    });\n\n    if (nameDictionary[localLayerStyle.name()] == null) {\n      allStyles.push(layerStyleObject);\n      nameDictionary[localLayerStyle.name()] = layerStyleObject;\n    }\n    else {\n      nameDictionary[localLayerStyle.name()].duplicates.push(layerStyleObject);\n    }\n  });\n\n\n  context.document.documentData().foreignLayerStyles().forEach(foreignStyle => {\n\n    var indexOfForeign = indexOfForeignStyle(allStyles, foreignStyle);\n    var foreignLib = getLibraryByID(foreignStyle.libraryID());\n    if (indexOfForeign == -1) {\n      var layerStyleObject = {\n        \"originalStyle\": foreignStyle,\n        \"layerStyle\": foreignStyle.localObject(),\n        \"name\": \"\" + foreignStyle.localObject().name(),\n        \"libraryName\": libraryPrefix + ((foreignLib != null) ? foreignLib.name() : \"This library is not available\"),\n        \"foreign\": true,\n        \"localShareID\": foreignStyle.localShareID(),\n        \"remoteShareID\": foreignStyle.remoteShareID(),\n        \"correlativeStyles\": [],\n        \"isSelected\": false,\n        \"isChosen\": false,\n        \"description\": getLayerStyleDescription(foreignStyle.localObject()),\n        \"thumbnail\": \"\",//getOvalThumbnail(foreignStyle.localObject()),\n        \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(foreignStyle.localObject())),\n        \"duplicates\": [],\n        \"isSelected\": false\n      }\n      layerStyleObject.duplicates.push({\n        \"originalStyle\": foreignStyle,\n        \"layerStyle\": foreignStyle.localObject(),\n        \"name\": \"\" + foreignStyle.localObject().name(),\n        \"libraryName\": libraryPrefix + ((foreignLib != null) ? foreignLib.name() : \"This library is not available\"),\n        \"foreign\": true,\n        \"localShareID\": foreignStyle.localShareID(),\n        \"remoteShareID\": foreignStyle.remoteShareID(),\n        \"correlativeStyles\": [],\n        \"isTakenOver\": false,\n        \"isSelected\": false,\n        \"isChosen\": false,\n        \"description\": getLayerStyleDescription(foreignStyle.localObject()),\n        \"thumbnail\": \"\",//getOvalThumbnail(foreignStyle.localObject()),,\n        \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(foreignStyle.localObject())),\n        \"duplicates\": null,\n        \"isSelected\": false\n      });\n\n      if (nameDictionary[foreignStyle.localObject().name()] == null) {\n        allStyles.push(layerStyleObject);\n        nameDictionary[foreignStyle.localObject().name()] = layerStyleObject;\n      }\n      else {\n        nameDictionary[foreignStyle.localObject().name()].duplicates.push(layerStyleObject);\n      }\n    }\n    else {\n      if (typeof (indexOfForeign) === 'number')\n        allStyles[indexOfForeign].correlativeStyles.push(foreignStyle);\n      else\n        allStyles[indexOfForeign[0]].duplicates[indexOfForeign[1]].correlativeStyles.push(foreignStyle);\n\n      // console.log(\"indexOfForeign: \"+indexOfForeign +\" , while allStyles.length is: \"+allStyles.length);\n      // console.log(allStyles[indexOfForeign]);\n      // console.log(indexOfForeign);\n      //allStyles[indexOfForeign[0]].duplicates[indexOfForeign[1]].correlativeStyles.push(style);\n    }\n\n  });\n\n\n\n\n\n  // console.time(\"getDuplicateExternalSymbols\");\n\n  var libraries = NSApp.delegate().librariesController().libraries();\n  libraries.forEach(function (lib) {\n    if (lib && lib.libraryID() && lib.enabled() && context.document.documentData() && context.document.documentData().objectID().toString().localeCompare(lib.libraryID().toString()) != 0) {\n\n      lib.document().layerStyles().objects().forEach(function (libraryStyle) {\n\n        var indexOfForeign = indexOfForeignStyle2(allStyles, libraryStyle);\n        if ((indexOfForeign != null) && (indexOfForeign != -1)) {\n          if (indexOfForeign[1] == 0)\n            allStyles.splice([indexOfForeign[0]], 1);\n          else\n            allStyles[indexOfForeign[0]].duplicates.splice(indexOfForeign[1], 1);\n        }\n\n        if (nameDictionary[libraryStyle.name()] != null) {\n          nameDictionary[libraryStyle.name()].duplicates.push({\n            \"layerStyle\": libraryStyle,\n            \"name\": \"\" + libraryStyle.name(),\n            \"libraryName\": libraryPrefix + lib.name(),\n            \"foreign\": true,\n            \"library\": lib,\n            \"isSelected\": false,\n            \"isChosen\": false,\n            \"description\": getLayerStyleDescription(libraryStyle),\n            \"thumbnail\": \"\",//getOvalThumbnail(libraryStyle),\n            \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(libraryStyle)),\n            \"duplicates\": [],\n            \"isSelected\": false\n          });\n        }\n      });\n    }\n  });\n\n  // console.timeEnd(\"getDuplicateExternalSymbols\");\n\n  Object.keys(nameDictionary).forEach(function (key) {\n    if (nameDictionary[key].duplicates.length <= 1) {\n      var index = allStyles.indexOf(nameDictionary[key]);\n      if (index > -1) allStyles.splice(index, 1);\n      nameDictionary[key] = null;\n    }\n    else {\n      var containsLibraryStyles = false;\n      for (var i = 0; i < nameDictionary[key].duplicates.length; i++) {\n        if (nameDictionary[key].duplicates[i].foreign) {\n          containsLibraryStyles = true;\n        }\n      }\n      if (!containsLibraryStyles) {\n        clog(\"Removing '\" + key + \"' cause it had no library styles\");\n        var index = allStyles.indexOf(nameDictionary[key]);\n        if (index > -1) allStyles.splice(index, 1);\n        nameDictionary[key] = null;\n      }\n    }\n  });\n\n  return allStyles;\n\n}\n\n\nfunction getDuplicateTextStyles(context) {\n\n  var allStyles = [];\n  var nameDictionary = {};\n\n\n  context.document.documentData().layerTextStyles().objects().forEach(function (localTextStyle) {\n\n    var attributes = localTextStyle.style().textStyle().attributes();\n\n    var textStyleObject = {\n      \"attributes\": attributes,\n      \"textStyle\": localTextStyle,\n      \"name\": \"\" + localTextStyle.name(),\n      \"libraryName\": sketchlocalfile,\n      \"foreign\": false,\n      \"isSelected\": false,\n      \"isChosen\": false,\n      \"description\": getTextStyleDescription(attributes),\n      \"thumbnail\": \"\",//getTextThumbnail(localTextStyle),,\n      \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(localTextStyle)),\n      \"duplicates\": [],\n      \"isSelected\": false\n    }\n    textStyleObject.duplicates.push({\n      \"attributes\": attributes,\n      \"textStyle\": localTextStyle,\n      \"name\": \"\" + localTextStyle.name(),\n      \"libraryName\": sketchlocalfile,\n      \"foreign\": false,\n      \"isSelected\": false,\n      \"isChosen\": false,\n      \"description\": getTextStyleDescription(attributes),\n      \"thumbnail\": \"\",//getTextThumbnail(localTextStyle),,\n      \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(localTextStyle)),\n      \"duplicates\": null,\n      \"isSelected\": false\n    });\n\n    if (nameDictionary[localTextStyle.name()] == null) {\n      allStyles.push(textStyleObject);\n      nameDictionary[localTextStyle.name()] = textStyleObject;\n    }\n    else {\n      nameDictionary[localTextStyle.name()].duplicates.push(textStyleObject);\n    }\n  });\n\n\n\n\n  context.document.documentData().foreignTextStyles().forEach(foreignStyle => {\n\n    var indexOfForeign = indexOfForeignStyle(allStyles, foreignStyle);\n    var foreignLib = getLibraryByID(foreignStyle.libraryID());\n\n    var attributes = foreignStyle.localObject().style().textStyle().attributes();\n\n    if (indexOfForeign == -1) {\n      var textStyleObject = {\n        \"originalStyle\": foreignStyle,\n        \"attributes\": attributes,\n        \"textStyle\": foreignStyle.localObject(),\n        \"name\": \"\" + foreignStyle.localObject().name(),\n        \"libraryName\": libraryPrefix + ((foreignLib != null) ? foreignLib.name() : \"This library is not available\"),\n        \"foreign\": true,\n        \"localShareID\": foreignStyle.localShareID(),\n        \"remoteShareID\": foreignStyle.remoteShareID(),\n        \"correlativeStyles\": [],\n        \"isSelected\": false,\n        \"isChosen\": false,\n        \"description\": getTextStyleDescription(attributes),\n        \"thumbnail\": \"\",//getTextThumbnail(foreignStyle.localObject()),\n        \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(foreignStyle.localObject())),\n        \"duplicates\": [],\n        \"isSelected\": false\n      }\n      textStyleObject.duplicates.push({\n        \"originalStyle\": foreignStyle,\n        \"attributes\": attributes,\n        \"textStyle\": foreignStyle.localObject(),\n        \"name\": \"\" + foreignStyle.localObject().name(),\n        \"libraryName\": libraryPrefix + ((foreignLib != null) ? foreignLib.name() : \"This library is not available\"),\n        \"foreign\": true,\n        \"localShareID\": foreignStyle.localShareID(),\n        \"remoteShareID\": foreignStyle.remoteShareID(),\n        \"correlativeStyles\": [],\n        \"isSelected\": false,\n        \"isChosen\": false,\n        \"description\": getTextStyleDescription(attributes),\n        \"thumbnail\": \"\",//getTextThumbnail(foreignStyle.localObject()),\n        \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(foreignStyle.localObject())),\n        \"duplicates\": null,\n        \"isSelected\": false\n      });\n\n      if (nameDictionary[foreignStyle.localObject().name()] == null) {\n        allStyles.push(textStyleObject);\n        nameDictionary[foreignStyle.localObject().name()] = textStyleObject;\n      }\n      else {\n        nameDictionary[foreignStyle.localObject().name()].duplicates.push(textStyleObject);\n      }\n    }\n    else {\n      if (typeof (indexOfForeign) === 'number')\n        allStyles[indexOfForeign].correlativeStyles.push(foreignStyle);\n      else\n        allStyles[indexOfForeign[0]].duplicates[indexOfForeign[1]].correlativeStyles.push(foreignStyle);\n\n      // console.log(\"indexOfForeign: \"+indexOfForeign +\" , while allStyles.length is: \"+allStyles.length);\n      // console.log(allStyles[indexOfForeign]);\n      // console.log(indexOfForeign);\n      //allStyles[indexOfForeign[0]].duplicates[indexOfForeign[1]].correlativeStyles.push(style);\n    }\n\n  });\n\n\n\n\n\n  // console.time(\"getDuplicateExternalSymbols\");\n\n    var libraries = NSApp.delegate().librariesController().libraries();\n    libraries.forEach(function (lib) {\n      if (lib && lib.libraryID() && lib.enabled() && context.document.documentData() && context.document.documentData().objectID().toString().localeCompare(lib.libraryID().toString()) != 0) {\n        lib.document().layerTextStyles().objects().forEach(function (libraryStyle) {\n\n          var indexOfForeign = indexOfForeignStyle2(allStyles, libraryStyle);\n\n          var attributes = libraryStyle.style().textStyle().attributes();\n\n          if ((indexOfForeign != null) && (indexOfForeign != -1)) {\n            if (indexOfForeign[1] == 0)\n              allStyles.splice([indexOfForeign[0]], 1);\n            else\n              allStyles[indexOfForeign[0]].duplicates.splice(indexOfForeign[1], 1);\n          }\n\n          if (nameDictionary[libraryStyle.name()] != null) {\n            nameDictionary[libraryStyle.name()].duplicates.push({\n              \"textStyle\": libraryStyle,\n              \"attributes\": attributes,\n              \"name\": \"\" + libraryStyle.name(),\n              \"libraryName\": libraryPrefix + lib.name(),\n              \"foreign\": true,\n              \"library\": lib,\n              \"isSelected\": false,\n              \"isChosen\": false,\n              \"description\": getTextStyleDescription(attributes),\n              \"thumbnail\": \"\",//getTextThumbnail(libraryStyle),\n              \"contrastMode\": shouldEnableContrastMode(getTextStyleColor(libraryStyle)),\n              \"duplicates\": [],\n              \"isSelected\": false\n            });\n          }\n        });\n      }\n    });\n\n  // console.timeEnd(\"getDuplicateExternalSymbols\");\n\n  Object.keys(nameDictionary).forEach(function (key) {\n    if (nameDictionary[key].duplicates.length <= 1) {\n      var index = allStyles.indexOf(nameDictionary[key]);\n      if (index > -1) allStyles.splice(index, 1);\n      nameDictionary[key] = null;\n    }\n    else {\n      var containsLibraryStyles = false;\n      for (var i = 0; i < nameDictionary[key].duplicates.length; i++) {\n        if (nameDictionary[key].duplicates[i].foreign) {\n          containsLibraryStyles = true;\n        }\n      }\n      if (!containsLibraryStyles) {\n        clog(\"Removing '\" + key + \"' cause it had no library styles\");\n        var index = allStyles.indexOf(nameDictionary[key]);\n        if (index > -1) allStyles.splice(index, 1);\n        nameDictionary[key] = null;\n      }\n    }\n  });\n\n  return allStyles;\n\n}\n\n\n\nfunction getLibraryByID(libID) {\n  var libraries = NSApp.delegate().librariesController().libraries();\n  for (var i = 0; i < libraries.length; i++) {\n    var lib = libraries[i];\n    if (lib && lib.libraryID() && lib.libraryID().toString().localeCompare(libID) == 0) {\n      return lib;\n    }\n  }\n\n  return null;\n}\n\n\nfunction getDefinedLayerStyles(context, includeAllStylesFromExternalLibraries, styleName) {\n  var layerStyles = [];\n  var localLayerStyles = context.document.documentData().layerStyles().objects();\n\n  for (var i = 0; i < localLayerStyles.count(); i++) {\n    var style = localLayerStyles.objectAtIndex(i);\n\n    if (styleName != null) {\n      if (styleName.localeCompare(style.name()) == 0) {\n        layerStyles.push({\n          \"layerStyle\": style,\n          \"name\": \"\" + style.name(),\n          \"libraryName\": sketchlocalfile,\n          \"foreign\": false,\n          \"isSelected\": false,\n          \"isChosen\": false,\n          \"description\": getLayerStyleDescription(style),\n          \"thumbnail\": getOvalThumbnail(style),\n          \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(style))\n        });\n      }\n    }\n    else {\n      layerStyles.push({\n        \"layerStyle\": style,\n        \"name\": \"\" + style.name(),\n        \"libraryName\": sketchlocalfile,\n        \"foreign\": false,\n        \"isSelected\": false,\n        \"isChosen\": false,\n        \"description\": getLayerStyleDescription(style),\n        \"thumbnail\": getOvalThumbnail(style),\n        \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(style))\n      });\n    }\n\n  }\n\n  context.document.documentData().foreignLayerStyles().forEach(style => {\n\n    var indexOfForeign = indexOfForeignStyle(layerStyles, style);\n    var foreignLib = getLibraryByID(style.libraryID());\n\n    if (indexOfForeign == -1) {\n      if (styleName != null) {\n        if (styleName.localeCompare(style.localObject().name()) == 0) {\n          layerStyles.push({\n            \"originalStyle\": style,\n            \"layerStyle\": style.localObject(),\n            \"name\": \"\" + style.localObject().name(),\n            \"libraryName\": libraryPrefix + ((foreignLib != null) ? foreignLib.name() : \"This library is not available\"),\n            \"foreign\": true,\n            \"localShareID\": style.localShareID(),\n            \"remoteShareID\": style.remoteShareID(),\n            \"correlativeStyles\": [],\n            \"isSelected\": false,\n            \"isChosen\": false,\n            \"description\": getLayerStyleDescription(style.localObject()),\n            \"thumbnail\": getOvalThumbnail(style.localObject()),\n            \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(style.localObject()))\n          });\n        }\n      }\n      else {\n        layerStyles.push({\n          \"originalStyle\": style,\n          \"layerStyle\": style.localObject(),\n          \"name\": \"\" + style.localObject().name(),\n          \"libraryName\": libraryPrefix + ((foreignLib != null) ? foreignLib.name() : \"This library is not available\"),\n          \"foreign\": true,\n          \"localShareID\": style.localShareID(),\n          \"remoteShareID\": style.remoteShareID(),\n          \"correlativeStyles\": [],\n          \"isSelected\": false,\n          \"isChosen\": false,\n          \"description\": getLayerStyleDescription(style.localObject()),\n          \"thumbnail\": getOvalThumbnail(style.localObject()),\n          \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(style.localObject()))\n        });\n      }\n    }\n    else {\n      layerStyles[indexOfForeign].correlativeStyles.push(style);\n    }\n\n  });\n\n  if (includeAllStylesFromExternalLibraries) {\n\n    //console.log(\"Libraries--------\");\n\n    var libraries = NSApp.delegate().librariesController().libraries();\n\n    libraries.forEach(function (lib) {\n\n      if (lib && lib.libraryID() && lib.enabled() && context.document.documentData() && context.document.documentData().objectID().toString().localeCompare(lib.libraryID().toString()) != 0) {\n\n        lib.document().layerStyles().objects().forEach(function (libraryStyle) {\n          //console.log(\"----Library:\"+libraryStyle.objectID());\n          if (!alreadyInList(layerStyles, libraryStyle)) {\n            if (styleName != null) {\n              if (styleName.localeCompare(libraryStyle.name()) == 0) {\n                layerStyles.push({\n                  \"layerStyle\": libraryStyle,\n                  \"name\": \"\" + libraryStyle.name(),\n                  \"libraryName\": libraryPrefix + lib.name(),\n                  \"foreign\": true,\n                  \"library\": lib,\n                  \"isSelected\": false,\n                  \"isChosen\": false,\n                  \"description\": getLayerStyleDescription(libraryStyle),\n                  \"thumbnail\": getOvalThumbnail(libraryStyle),\n                  \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(libraryStyle))\n                });\n              }\n            }\n            else {\n              layerStyles.push({\n                \"layerStyle\": libraryStyle,\n                \"name\": \"\" + libraryStyle.name(),\n                \"libraryName\": libraryPrefix + lib.name(),\n                \"foreign\": true,\n                \"library\": lib,\n                \"isSelected\": false,\n                \"isChosen\": false,\n                \"description\": getLayerStyleDescription(libraryStyle),\n                \"thumbnail\": getOvalThumbnail(libraryStyle),\n                \"contrastMode\": shouldEnableContrastMode(getLayerStyleColor(libraryStyle))\n              });\n            }\n          }\n        });\n      }\n    });\n  }\n\n  layerStyles = layerStyles.sort(compareStyleArrays);\n  return layerStyles = layerStyles.sort(compareStyleArrays);\n  ;\n}\n\nfunction getImageData64(data) {\n  var imageData = data;\n  var mimeType = \"image/png\";\n  return NSString.stringWithFormat(\n    \"data:%@;base64,%@\",\n    mimeType,\n    imageData.base64EncodedStringWithOptions(0)\n  );\n}\n\nfunction getNSImageData(nsImage) {\n  var data = nsImage\n  var cgRef = nsImage.CGImageForProposedRect_context_hints(null, nil, nil);\n  var newRep = NSBitmapImageRep.alloc().initWithCGImage(cgRef);\n  newRep.setSize(nsImage.size());   // if you want the same resolution\n  var pngData = newRep.representationUsingType_properties(NSPNGFileType, nil);\n  return getImageData64(pngData)\n}\n\nfunction getThumbnail(element, width, height) {\n  var exportRequest = MSExportRequest.exportRequestsFromExportableLayer_inRect_useIDForName_(\n    element,\n    element.absoluteInfluenceRect(),\n    false\n  ).firstObject();\n\n  exportRequest.format = \"png\"\n\n\n  var scaleX = width / exportRequest.rect().size.width;\n  var scaleY = height / exportRequest.rect().size.height;\n\n  if (scaleX < scaleY)\n    exportRequest.scale = scaleX;\n  else\n    exportRequest.scale = scaleY;\n\n  var colorSpace = NSColorSpace.sRGBColorSpace()\n  var exporter = MSExporter.exporterForRequest_colorSpace_(exportRequest, colorSpace)\n  var imageRep = exporter.bitmapImageRep()\n\n  var image = NSImage.alloc().init().autorelease();\n  image.addRepresentation(imageRep);\n\n  return image;\n}\n\nfunction getBase64(element, width, height) {\n  var image = getThumbnail(element, width, height);\n  return \"\" + getNSImageData(image);\n}\n\nfunction clog(message) {\n  if (logsEnabled)\n    console.log(message);\n}\n\nfunction getLogsEnabled() {\n  return logsEnabled;\n}\n\nfunction getLibrariesEnabled() {\n  return librariesEnabledByDefault;\n}\n\n\n\nfunction getSettings() {\n  return settingsFile;\n}\n\n//d9-05\nvar _0xedc5=[\"\\x70\\x61\\x74\\x68\",\"\\x6D\\x61\\x69\\x6E\\x50\\x6C\\x75\\x67\\x69\\x6E\\x73\\x46\\x6F\\x6C\\x64\\x65\\x72\\x55\\x52\\x4C\",\"\\x2F\\x73\\x79\\x6E\\x63\\x77\\x69\\x74\\x68\\x6C\\x69\\x62\\x72\\x61\\x72\\x79\\x2E\\x6A\\x73\\x6F\\x6E\",\"\\x6C\\x6F\\x67\\x73\",\"\\x6C\\x69\\x62\\x72\\x61\\x72\\x69\\x65\\x73\\x45\\x6E\\x61\\x62\\x6C\\x65\\x64\\x42\\x79\\x44\\x65\\x66\\x61\\x75\\x6C\\x74\",\"\\x6C\\x6F\\x67\"];function LoadSettings(){try{settingsFile= readFromFile(MSPluginManager[_0xedc5[1]]()[_0xedc5[0]]()+ _0xedc5[2]);if((settingsFile!= null)&& (settingsFile[_0xedc5[3]]!= null)){logsEnabled= settingsFile[_0xedc5[3]]};if((settingsFile!= null)&& (settingsFile[_0xedc5[4]]!= null)){librariesEnabledByDefault= settingsFile[_0xedc5[4]]}}catch(e){console[_0xedc5[5]](e);return null}}\n//d9-05\n\nmodule.exports = { GetTextBasedOnCount, getBase64, brightnessByColor, getColorDependingOnBrightness, isString, getAlignment, getSymbolInstances, containsTextStyle, containsLayerStyle, createView, getAllTextLayers, getAllLayers, createSeparator, getColorDependingOnTheme, compareStyleArrays, alreadyInList, getIndexOf, FindAllSimilarTextStyles, FindSimilarTextStyles, FindAllSimilarLayerStyles, FindSimilarLayerStyles, getDefinedLayerStyles, getDefinedTextStyles, indexOfForeignStyle, IsInTrial, ExiGuthrie, Guthrie, valStatus, writeTextToFile, commands, getDuplicateSymbols, importForeignSymbol, GetSpecificSymbolData, getDuplicateLayerStyles, GetSpecificLayerStyleData, getDuplicateTextStyles, GetSpecificTextStyleData, shouldEnableContrastMode, countAllSymbols, sortArray, EditSettings, writeTextToFile, readFromFile, LoadSettings, clog, getLogsEnabled, getSettings, getLibrariesEnabled };","const MergeSymbols = require(\"./MergeDuplicateSymbols\");\nconst MergeLayerStyles = require(\"./MergeLayerStyles\");\nconst MergeTextStyles = require(\"./MergeTextStyles\");\nconst Settings = require(\"./EditSettings\");\n\nconst Helpers = require(\"./Helpers\");\nimport BrowserWindow from 'sketch-module-web-view';\nimport { getWebview } from 'sketch-module-web-view/remote';\nimport UI from 'sketch/ui'\nconst webviewRegIdentifier = 'sync-with-library.webviewReg';\n\nvar globalRemainingDays = 0;\nvar globalIsInTrial = false;\nvar globalIsExpired = false;\nvar globalIsOver = false;\n\nvar globalCommand;\n\n\nexport function MergeDuplicateSymbols(context) {\n  globalCommand = Helpers.commands.mergeduplicatesymbols;\n  onValidate(context);\n};\n\nexport function MergeDuplicateTextStyles(context) {\n  globalCommand = Helpers.commands.mergeduplicatetextstyles;\n  onValidate(context);\n};\n\nexport function MergeDuplicateLayerStyles(context) {\n  globalCommand = Helpers.commands.mergeduplicatelayerstyles;\n  onValidate(context);\n};\n\nexport function EditSettings(context) {\n  globalCommand = Helpers.commands.editsettings;\n  onValidate(context);\n};\n\n\n\n//d9-01\nvar _0x1647 = [\"\\x61\\x70\\x70\", \"\\x76\\x61\\x6C\\x53\\x74\\x61\\x74\\x75\\x73\", \"\\x6E\\x6F\\x43\\x6F\\x6E\", \"\\x6F\\x76\\x65\\x72\", \"\\x6E\\x6F\\x77\", \"\\x61\\x62\\x73\", \"\\x66\\x6C\\x6F\\x6F\\x72\"]; function onValidate(_0x8a0ax2) { var _0x8a0ax3 = Helpers.ExiGuthrie(); if ((_0x8a0ax3 == Helpers[_0x1647[1]][_0x1647[0]]) || (_0x8a0ax3 == Helpers[_0x1647[1]][_0x1647[2]])) { triggerMethod(_0x8a0ax2) } else { if (_0x8a0ax3 == Helpers[_0x1647[1]][_0x1647[3]]) { globalIsOver = true; showRegistration(_0x8a0ax2) } else { var _0x8a0ax4 = Helpers.IsInTrial(); var _0x8a0ax5 = new Date(parseInt(_0x8a0ax4)); if (_0x8a0ax4 != null) { var _0x8a0ax6 = _0x8a0ax5 - Date[_0x1647[4]](); var _0x8a0ax7 = Math[_0x1647[6]](Math[_0x1647[5]](_0x8a0ax6 / (1000 * 3600 * 24))); globalRemainingDays = 7 - _0x8a0ax7; if (globalRemainingDays > 0) { globalIsInTrial = true } else { globalIsExpired = true }; showRegistration(_0x8a0ax2) } else { showRegistration(_0x8a0ax2) } } } }\n//d9-01\n\nexport function triggerMethod(context) {\n\n  Helpers.LoadSettings();\n\n  switch (globalCommand) {\n    case Helpers.commands.mergeduplicatesymbols:\n      MergeSymbols.MergeDuplicateSymbols(context);\n      break;\n    case Helpers.commands.mergeduplicatetextstyles:\n      MergeTextStyles.MergeDuplicateTextStyles(context);\n      break;\n    case Helpers.commands.mergeduplicatelayerstyles:\n      MergeLayerStyles.MergeDuplicateLayerStyles(context);\n      break;\n    case Helpers.commands.editsettings:\n      Settings.EditSettings(context);\n      break;\n  }\n}\n\n\n\nexport function showRegistration(context) {\n\n  var options = {\n    identifier: webviewRegIdentifier,\n    width: 1200,\n    height: 700,\n    show: false,\n    titleBarStyle: 'hidden'\n  }\n\n  var regWindow = new BrowserWindow(options)\n\n  const webContentsReg = regWindow.webContents;\n\n  //d9-02\n  var _0xff74 = [\"\\x72\\x65\\x61\\x64\\x79\\x2D\\x74\\x6F\\x2D\\x73\\x68\\x6F\\x77\", \"\\x65\\x72\\x72\\x6F\\x72\", \"\\x63\\x61\\x74\\x63\\x68\", \"\\x53\\x65\\x74\\x54\\x72\\x69\\x61\\x6C\\x4D\\x6F\\x64\\x65\\x28\", \"\\x73\\x74\\x72\\x69\\x6E\\x67\\x69\\x66\\x79\", \"\\x29\", \"\\x65\\x78\\x65\\x63\\x75\\x74\\x65\\x4A\\x61\\x76\\x61\\x53\\x63\\x72\\x69\\x70\\x74\", \"\\x53\\x65\\x74\\x45\\x78\\x70\\x69\\x72\\x65\\x64\\x4D\\x6F\\x64\\x65\\x28\\x29\", \"\\x53\\x65\\x74\\x4F\\x76\\x65\\x72\\x4D\\x6F\\x64\\x65\\x28\\x29\", \"\\x73\\x68\\x6F\\x77\", \"\\x6F\\x6E\\x63\\x65\", \"\\x64\\x69\\x64\\x2D\\x66\\x69\\x6E\\x69\\x73\\x68\\x2D\\x6C\\x6F\\x61\\x64\", \"\\x6F\\x6E\", \"\\x52\\x65\\x67\\x69\\x73\\x74\\x65\\x72\\x4B\\x65\\x79\", \"\\x61\\x70\\x70\", \"\\x76\\x61\\x6C\\x53\\x74\\x61\\x74\\x75\\x73\", \"\", \"\\x70\\x61\\x74\\x68\", \"\\x6D\\x61\\x69\\x6E\\x50\\x6C\\x75\\x67\\x69\\x6E\\x73\\x46\\x6F\\x6C\\x64\\x65\\x72\\x55\\x52\\x4C\", \"\\x2F\\x73\\x79\\x6E\\x63\\x77\\x69\\x74\\x68\\x6C\\x69\\x62\\x72\\x61\\x72\\x79\\x2E\\x6A\\x73\\x6F\\x6E\", \"\\x77\\x72\\x69\\x74\\x65\\x54\\x65\\x78\\x74\\x54\\x6F\\x46\\x69\\x6C\\x65\", \"\\x53\\x68\\x6F\\x77\\x52\\x65\\x67\\x69\\x73\\x74\\x72\\x61\\x74\\x69\\x6F\\x6E\\x43\\x6F\\x6D\\x70\\x6C\\x65\\x74\\x65\\x28\\x29\", \"\\x6F\\x76\\x65\\x72\", \"\\x53\\x65\\x74\\x4F\\x76\\x65\\x72\\x4D\\x6F\\x64\\x65\\x49\\x6E\\x52\\x65\\x67\\x28\\x29\", \"\\x53\\x68\\x6F\\x77\\x52\\x65\\x67\\x69\\x73\\x74\\x72\\x61\\x74\\x69\\x6F\\x6E\\x46\\x61\\x69\\x6C\\x28\\x29\", \"\\x53\\x74\\x61\\x72\\x74\\x54\\x72\\x69\\x61\\x6C\", \"\\x6E\\x6F\\x77\", \"\\x53\\x68\\x6F\\x77\\x54\\x72\\x69\\x61\\x6C\\x53\\x74\\x61\\x72\\x74\\x65\\x64\\x28\\x29\", \"\\x43\\x6F\\x6E\\x74\\x69\\x6E\\x75\\x65\\x54\\x72\\x69\\x61\\x6C\", \"\\x4C\\x65\\x74\\x73\\x53\\x74\\x61\\x72\\x74\\x54\\x72\\x69\\x61\\x6C\", \"\\x4C\\x65\\x74\\x73\\x53\\x74\\x61\\x72\\x74\"]; regWindow[_0xff74[10]](_0xff74[0], () => { if (globalIsInTrial) { webContentsReg[_0xff74[6]](`${_0xff74[3]}${JSON[_0xff74[4]](globalRemainingDays)}${_0xff74[5]}`)[_0xff74[2]](console[_0xff74[1]]) }; if (globalIsExpired) { webContentsReg[_0xff74[6]](`${_0xff74[7]}`)[_0xff74[2]](console[_0xff74[1]]) }; if (globalIsOver) { webContentsReg[_0xff74[6]](`${_0xff74[8]}`)[_0xff74[2]](console[_0xff74[1]]) }; regWindow[_0xff74[9]]() }); webContentsReg[_0xff74[12]](_0xff74[11], () => { if (globalIsInTrial) { webContentsReg[_0xff74[6]](`${_0xff74[3]}${JSON[_0xff74[4]](globalRemainingDays)}${_0xff74[5]}`)[_0xff74[2]](console[_0xff74[1]]) }; if (globalIsExpired) { webContentsReg[_0xff74[6]](`${_0xff74[7]}`)[_0xff74[2]](console[_0xff74[1]]) }; if (globalIsOver) { webContentsReg[_0xff74[6]](`${_0xff74[8]}`)[_0xff74[2]](console[_0xff74[1]]) } }); webContentsReg[_0xff74[12]](_0xff74[13], (_0x5234x1) => { var _0x5234x2 = Helpers.Guthrie(_0x5234x1, true); if (_0x5234x2 == Helpers[_0xff74[15]][_0xff74[14]]) { var _0x5234x3 = { \"\\x6C\\x69\\x63\\x65\\x6E\\x73\\x65\\x4B\\x65\\x79\": _0xff74[16] + _0x5234x1 }; Helpers[_0xff74[20]](_0x5234x3, MSPluginManager[_0xff74[18]]()[_0xff74[17]]() + _0xff74[19]); webContentsReg[_0xff74[6]](`${_0xff74[21]}`)[_0xff74[2]](console[_0xff74[1]]) } else { if (_0x5234x2 == Helpers[_0xff74[15]][_0xff74[22]]) { webContentsReg[_0xff74[6]](`${_0xff74[8]}`)[_0xff74[2]](console[_0xff74[1]]); webContentsReg[_0xff74[6]](`${_0xff74[23]}`)[_0xff74[2]](console[_0xff74[1]]) } else { webContentsReg[_0xff74[6]](`${_0xff74[24]}`)[_0xff74[2]](console[_0xff74[1]]) } } }); webContentsReg[_0xff74[12]](_0xff74[25], (_0x5234x1) => { var _0x5234x4 = { \"\\x73\\x74\\x61\\x72\\x74\\x54\\x69\\x6D\\x65\": _0xff74[16] + Date[_0xff74[26]]() }; Helpers[_0xff74[20]](_0x5234x4, MSPluginManager[_0xff74[18]]()[_0xff74[17]]() + _0xff74[19]); webContentsReg[_0xff74[6]](`${_0xff74[27]}`)[_0xff74[2]](console[_0xff74[1]]) }); webContentsReg[_0xff74[12]](_0xff74[28], () => { onShutdown(webviewRegIdentifier); triggerMethod(context) }); webContentsReg[_0xff74[12]](_0xff74[29], () => { globalIsInTrial = true; globalRemainingDays = 7; onShutdown(webviewRegIdentifier); triggerMethod(context) }); webContentsReg[_0xff74[12]](_0xff74[30], () => { globalIsInTrial = false; onShutdown(webviewRegIdentifier); triggerMethod(context) })\n  //d9-02\n\n  webContentsReg.on('nativeLog', s => {\n    Helpers.cog(s);\n  })\n\n  webContentsReg.on('OpenPluginWeb', s => {\n    NSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString(\"http://gum.co/syncwithlibrary\"));\n  })\n\n  webContentsReg.on('Cancel', () => {\n    onShutdown(webviewRegIdentifier);\n  });\n\n  regWindow.loadURL(require('../resources/register.html'));\n}\n\n\nexport function onShutdown(webviewID) {\n  const existingWebview = getWebview(webviewID)\n  if (existingWebview) {\n    existingWebview.close()\n  }\n}","import BrowserWindow from 'sketch-module-web-view'\nimport { getWebview } from 'sketch-module-web-view/remote'\nconst Helpers = require(\"./Helpers\");\n\nconst webviewIdentifier = 'sync-with-library.webview'\n\nfunction generateUUID() {\n  var d = new Date().getTime();\n  if (Date.now) {\n    d = Date.now(); //high-precision timer\n  }\n  var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n  });\n  return uuid;\n};\n\n\n\n//   function getSymbolInstances(context, symbolMaster) {\n//     var symbolInstances = NSMutableArray.array();\n\n//     var pages = context.document.pages(), pageLoop = pages.objectEnumerator(), page;\n\n//     while (page = pageLoop.nextObject()) {\n//       var predicate = NSPredicate.predicateWithFormat(\"className == 'MSSymbolInstance' && symbolMaster == %@\", symbolMaster),\n//         instances = page.children().filteredArrayUsingPredicate(predicate),\n//         instanceLoop = instances.objectEnumerator(),\n//         instance;\n\n//       while (instance = instanceLoop.nextObject()) {\n//         symbolInstances.addObject(instance);\n//       }\n//     }\n\n//     return symbolInstances;\n//   }\n\n// function getSymbolOverrides(context, symbolMaster) {\n//   var symbolOverrides = NSMutableArray.array();\n\n//   var pages = context.document.pages(), pageLoop = pages.objectEnumerator(), page;\n\n//   while (page = pageLoop.nextObject()) {\n//     var predicate = NSPredicate.predicateWithFormat(\"className == %@ && overrides != nil\", \"MSSymbolInstance\"),\n//       instances = page.children().filteredArrayUsingPredicate(predicate),\n//       instanceLoop = instances.objectEnumerator(),\n//       instance;\n\n//     while (instance = instanceLoop.nextObject()) {\n//       var overrides = instance.overrides();\n//       FindOverrideSymbolID(instance, overrides, symbolOverrides, symbolMaster, 0);\n//     }\n//   }\n//   return symbolOverrides;\n// }\n\nfunction GetSymbolsByName(name, context) {\n  var allSymbols = context.document.documentData().allSymbols();\n  var matchingSymbols = [];\n  for (var i = 0; i < allSymbols.count(); i++) {\n    var symbolName = allSymbols[i].name().toString();\n    if (symbolName.localeCompare(name) == 0) {\n      matchingSymbols.push(allSymbols[i]);\n    }\n  }\n  return matchingSymbols;\n}\n\nfunction FindSymbolInstances(context, originalSymbol, duplicateSymbolsByName) {\n  var instancesPerSymbol = [];\n  for (var i = 0; i < duplicateSymbolsByName.length; i++) {\n    instancesPerSymbol[i] = NSMutableArray.array();\n  }\n\n  for (var i = 0; i < duplicateSymbolsByName.length; i++) {\n    var symbolInstances = getSymbolInstances(context, duplicateSymbolsByName[i]);\n    instancesPerSymbol[i] = symbolInstances;\n  }\n\n  return instancesPerSymbol;\n}\n\nfunction FindSymbolOverrides(context, originalSymbol, duplicateSymbolsByName) {\n  var overridesPerSymbol = [];\n  for (var i = 0; i < duplicateSymbolsByName.length; i++) {\n    overridesPerSymbol[i] = NSMutableArray.array();\n  }\n\n\n  for (var i = 0; i < duplicateSymbolsByName.length; i++) {\n    var symbolOverrides = getSymbolOverrides(context, duplicateSymbolsByName[i]);\n    overridesPerSymbol[i] = symbolOverrides;\n  }\n\n  return overridesPerSymbol;\n}\n\n\nfunction MergeSymbols(symbolToMerge, symbolToKeep) {\n\n  var symbolsIDsToRemove = [];\n  var symbolToApply;\n  var instancesChanged = 0;\n  var overridesChanged = 0;\n  var symbolsRemoved = 0;\n\n  if (symbolToMerge.duplicates[symbolToKeep].externalLibrary == null) {\n    symbolToApply = symbolToMerge.duplicates[symbolToKeep].symbol;\n  } else {\n    //console.log(\"Importing symbol from library\");\n    var foreignSymbolReference = MSShareableObjectReference.referenceForShareableObject_inLibrary(symbolToMerge.duplicates[symbolToKeep].symbol, symbolToMerge.duplicates[symbolToKeep].externalLibrary);\n    var foreignSymbol = AppController.sharedInstance().librariesController().importShareableObjectReference_intoDocument(foreignSymbolReference, context.document.documentData());\n    symbolToApply = foreignSymbol.symbolMaster();\n  }\n\n  for (var i = 0; i < symbolToMerge.duplicates.length; i++) {\n    if (i != symbolToKeep) {\n      if (symbolsIDsToRemove.indexOf(symbolToMerge.duplicates[i].symbol.symbolID()) < 0)\n        symbolsIDsToRemove.push(symbolToMerge.duplicates[i].symbol.symbolID());\n    }\n  }\n\n  for (var i = 0; i < symbolToMerge.duplicates.length; i++) {\n    if (i != symbolToKeep) {\n\n      if (!symbolToMerge.duplicates[i].isForeign)\n        symbolsRemoved++;\n\n      var instancesOfSymbol = symbolToMerge.duplicates[i].symbolInstances;\n      var overridesOfSymbol = symbolToMerge.duplicates[i].symbolOverrides;\n      var wasUnlinked = false;\n\n      if (symbolToMerge.duplicates[i].isForeign && (symbolToMerge.duplicates[i].externalLibrary == null)) {\n        // console.log(\"About to remove this symbol ↓\");\n        // console.log(symbolToMerge.duplicates[i].symbol);\n        // console.log(symbolToMerge.duplicates[i].symbol.foreignObject());\n        symbolToMerge.duplicates[i].symbol.foreignObject().unlinkFromRemote();\n        wasUnlinked = true;\n      }\n\n      if (symbolToMerge.duplicates[symbolToKeep].externalLibrary == null) {\n        // console.log(\"Replacing instance for External symbol (\" + symbolToMerge.duplicates[symbolToKeep].libraryName + \")\");\n        for (var k = 0; k < instancesOfSymbol.length; k++) {\n          instancesOfSymbol[k].changeInstanceToSymbol(symbolToApply);\n          instancesChanged++;\n        }\n      } else {\n\n        for (var k = 0; k < instancesOfSymbol.length; k++) {\n          instancesOfSymbol[k].changeInstanceToSymbol(foreignSymbol.symbolMaster());\n          instancesChanged++;\n        }\n      }\n\n      for (var k = 0; k < overridesOfSymbol.length; k++) {\n        var overridesToReplace = [];\n        var currentOverrides = NSMutableDictionary.dictionaryWithDictionary(overridesOfSymbol[k].overrides());\n\n        var overrideOuterKeys = currentOverrides.allKeys();\n\n        for (var x = 0; x < overrideOuterKeys.count(); x++) {\n          var keyIndex = overrideOuterKeys.objectAtIndex(x);\n          var ascOverride = currentOverrides[keyIndex].toString().replace(/[^\\x20-\\x7E]+/g, \"\");\n\n          if (currentOverrides[keyIndex] == null || !(/\\S/.test(ascOverride))) {\n            //Internal overrides. Don't consider.\n          }\n          else {\n            if (currentOverrides[keyIndex].allKeys != null) {\n              var overrideInnerKeys = currentOverrides[keyIndex].allKeys();\n              var innerNewOverride = {};\n              for (var y = 0; y < overrideInnerKeys.count(); y++) {\n                var innerkeyIndex = overrideInnerKeys.objectAtIndex(y);\n                var shallbereplaced = false;\n                for (var t = 0; t < symbolsIDsToRemove.length; t++) {\n                  if (currentOverrides[keyIndex][\"symbolID\"] != null && currentOverrides[keyIndex][\"symbolID\"].indexOf(symbolsIDsToRemove[t]) > -1)\n                    shallbereplaced = true;\n                }\n                if (shallbereplaced) {\n                  if (overridesToReplace.indexOf(keyIndex) < 0)\n                    overridesToReplace.push(keyIndex);\n                }\n              }\n            }\n          }\n        }\n\n        overridesOfSymbol[k].overridePoints().forEach(function (overridePoint) {\n          if (overridePoint.toString().indexOf(\"symbolID\") > -1) {\n            var shallbereplaced = false;\n            for (t = 0; t < overridesToReplace.length; t++) {\n              if (overridePoint.toString().indexOf(overridesToReplace[t]) > -1) {\n                shallbereplaced = true;\n              }\n            }\n            if (shallbereplaced) {\n              // console.log(\"Replacing an override. Foreign:\" + (symbolToMerge.duplicates[symbolToKeep].externalLibrary != null));\n              overridesOfSymbol[k].setValue_forOverridePoint_(symbolToApply.symbolID(), overridePoint);\n              overridesChanged++;\n            }\n          }\n        });\n\n      }\n\n      if (!symbolToMerge.duplicates[i].isForeign) {\n        symbolToMerge.duplicates[i].symbol.removeFromParent();\n        //console.log(\"Removed symbol \" + symbolToMerge.duplicates[i].name);\n      }\n      else {\n        if (wasUnlinked) {\n          //console.log(\"Was unlinked\");\n          symbolToMerge.duplicates[i].symbol.removeFromParent();\n        }\n\n        context.document.documentData().foreignSymbols().removeObject(symbolToMerge.duplicates[i].symbol);\n        //console.log(\"Removed foreign from foreignSymbols (\" + symbolToMerge.duplicates[i].name + \")\");\n      }\n\n    }\n  }\n\n  return [symbolsRemoved, instancesChanged, overridesChanged];\n}\n\n\nexport function MergeDuplicateSymbols(context) {\n\n  Helpers.clog(\"----- Sync symbols (with the same name) -----\");\n\n  const options = {\n    identifier: webviewIdentifier,\n    width: 1200,\n    height: 700,\n    remembersWindowFrame: true,\n    show: false,\n    titleBarStyle: 'hidden'\n  }\n  const browserWindow = new BrowserWindow(options);\n  const webContents = browserWindow.webContents;\n\n  var duplicatedSymbols;\n  var mergeSession = [];\n\n  var numberOfSymbols = Helpers.countAllSymbols(context, true);\n  Helpers.clog(\"Local symbols: \" + numberOfSymbols[0] + \". Library symbols:\" + numberOfSymbols[1] + \".\");\n  browserWindow.loadURL(require('../resources/mergeduplicatesymbols.html'));\n  Helpers.clog(\"Webview called\");\n\n  function CalculateDuplicates() {\n\n    Helpers.clog(\"Processing duplicates.\");\n    duplicatedSymbols = Helpers.getDuplicateSymbols(context, context.document.documentData().allSymbols(), true, false);\n    Helpers.clog(\"-- Found \" + duplicatedSymbols.length + \" duplicates\");\n    if (duplicatedSymbols.length > 0) {\n      Helpers.GetSpecificSymbolData(context, duplicatedSymbols, 0);\n      mergeSession = [];\n      for (var i = 0; i < duplicatedSymbols.length; i++) {\n        mergeSession.push({\n          \"symbolWithDuplicates\": duplicatedSymbols[i],\n          \"selectedIndex\": -1,\n          \"isUnchecked\": false,\n          \"isProcessed\": (i == 0) ? true : false\n        });\n      }\n    }\n    Helpers.clog(\"End of processing duplicates\");\n  }\n\n  browserWindow.once('ready-to-show', () => {\n    browserWindow.show()\n  })\n\n  webContents.on('did-finish-load', () => {\n    Helpers.clog(\"Webview loaded\");\n    webContents.executeJavaScript(`LaunchMerge(${JSON.stringify(numberOfSymbols[0])},${JSON.stringify(numberOfSymbols[1])})`).catch(console.error);\n  })\n\n  webContents.on('nativeLog', s => {\n    Helpers.clog(s);\n  })\n\n  webContents.on('Cancel', () => {\n    onShutdown(webviewIdentifier);\n  });\n\n  webContents.on('GetSelectedSymbolData', (index) => {\n    Helpers.GetSpecificSymbolData(context, duplicatedSymbols, index);\n    webContents.executeJavaScript(`ReDrawAfterGettingData(${JSON.stringify(duplicatedSymbols[index])},${index})`).catch(console.error);\n  });\n\n  webContents.on('RecalculateDuplicates', () => {\n    \n      CalculateDuplicates(true);\n\n    Helpers.clog(\"Drawing duplicates to webview\");\n    webContents.executeJavaScript(`DrawDuplicateSymbols(${JSON.stringify(mergeSession)})`).catch(console.error);\n  });\n\n  webContents.on('ExecuteMerge', (editedMergeSession) => {\n    var duplicatesSolved = 0;\n    var mergedSymbols = 0;\n    var mergeResults = [0, 0, 0];\n    Helpers.clog(\"Executing Merge\");\n    for (var i = 0; i < editedMergeSession.length; i++) {\n      Helpers.clog(\"-- Merging \" + mergeSession[i].symbolWithDuplicates.name);\n      if (!editedMergeSession[i].isUnchecked && editedMergeSession[i].selectedIndex >= 0) {\n        mergeSession[i].selectedIndex = editedMergeSession[i].selectedIndex;\n        for (var j = 0; j < mergeSession[i].symbolWithDuplicates.duplicates.length; j++) {\n          mergedSymbols++;\n        }\n\n        var localMergeResults = MergeSymbols(mergeSession[i].symbolWithDuplicates, mergeSession[i].selectedIndex);\n        mergeResults[0] += localMergeResults[0];\n        mergeResults[1] += localMergeResults[1];\n        mergeResults[2] += localMergeResults[2];\n\n        duplicatesSolved++;\n      }\n    }\n\n    onShutdown(webviewIdentifier);\n\n    var replacedStuff = \"\";\n    if (mergeResults[1] > 0 && mergeResults[2])\n      replacedStuff = \", replaced \" + mergeResults[1] + \" instances, and updated \" + mergeResults[2] + \" overrides.\";\n    else if (mergeResults[1] > 0)\n      replacedStuff = \" and replaced \" + mergeResults[1] + \" instances.\";\n    else if (mergeResults[2] > 0)\n      replacedStuff = \" and updated \" + mergeResults[2] + \" overrides.\";\n    else\n      replacedStuff = \".\";\n\n    if (duplicatesSolved > 0) {\n      Helpers.clog(\"Completed merge. Removed \" + mergeResults[0] + \" symbols\" + replacedStuff);\n      context.document.showMessage(\"Hey ho! You just removed \" + mergeResults[0] + \" symbols\" + replacedStuff + \" Amazing!\");\n    }\n    else {\n      Helpers.clog(\"Completed merge. No symbols were replaced.\");\n      context.document.showMessage(\"No symbols were replaced.\");\n    }\n  });\n\n\n};\n\nexport function onShutdown(webviewID) {\n  const existingWebview = getWebview(webviewID)\n  if (existingWebview) {\n    existingWebview.close()\n  }\n}","import BrowserWindow from 'sketch-module-web-view'\nimport { getWebview } from 'sketch-module-web-view/remote'\nconst Helpers = require(\"./Helpers\");\n\nconst webviewMDLSIdentifier = 'merge-duplicatelayerstyles.webview'\n\nvar checkingAlsoLibraries = false;\nvar currentSelectedStyles = [];\n\n\nfunction getLayerPredicate(style) {\n  var predicate;\n  if (style.originalStyle != null)\n    predicate = NSPredicate.predicateWithFormat(\"(sharedStyle.objectID == %@) OR (sharedStyle.objectID == %@)\", style.originalStyle.localShareID(), style.originalStyle.remoteShareID());\n  else\n    predicate = NSPredicate.predicateWithFormat(\"sharedStyle.objectID == %@\", style.layerStyle.objectID());\n\n  return predicate;\n}\n\nfunction MergeLayerStyles(context, styleToKeep) {\n  var layersChangedCounter = 0;\n  var overridesChangedCounter = 0;\n\n\n  Helpers.clog(\"Merging styles. Keep '\" + currentSelectedStyles[styleToKeep].name + \"'\");\n\n  var layers = Helpers.getAllLayers(context);\n  var layersWithOtherStyles = NSMutableArray.array();\n\n  currentSelectedStyles.forEach(function (style) {\n    if (style.layerStyle != currentSelectedStyles[styleToKeep].layerStyle) {\n      var predicate = getLayerPredicate(style),\n        layersWithSameStyle = layers.filteredArrayUsingPredicate(predicate),\n        instanceLoop = layersWithSameStyle.objectEnumerator(),\n        instance;\n\n      while (instance = instanceLoop.nextObject()) {\n        layersWithOtherStyles.addObject(instance);\n      }\n\n      if (style.correlativeStyles != null) {\n        var countercorrelative = 0;\n        for (var i = 0; i < style.correlativeStyles.length; i++) {\n          var predicateCorrelative = NSPredicate.predicateWithFormat(\"sharedStyle.objectID == %@\", style.correlativeStyles[i].localObject().objectID()),\n            layersWithSameStyleCorrelative = layers.filteredArrayUsingPredicate(predicateCorrelative),\n            instanceLoopCorrelative = layersWithSameStyle.objectEnumerator(),\n            instanceCorrelative;\n\n          while (instanceCorrelative = instanceLoopCorrelative.nextObject()) {\n            layersWithOtherStyles.addObject(instanceCorrelative);\n            countercorrelative++;\n          }\n        }\n      }\n    }\n  });\n\n  var foreignStyleReference, foreignStyle;\n  if (currentSelectedStyles[styleToKeep].foreign && currentSelectedStyles[styleToKeep].library != null) {\n    foreignStyleReference = MSShareableObjectReference.referenceForShareableObject_inLibrary(currentSelectedStyles[styleToKeep].layerStyle, currentSelectedStyles[styleToKeep].library);\n    foreignStyle = AppController.sharedInstance().librariesController().importShareableObjectReference_intoDocument(foreignStyleReference, context.document.documentData());\n  }\n\n  layersWithOtherStyles.forEach(function (layer) {\n    if (currentSelectedStyles[styleToKeep].foreign && currentSelectedStyles[styleToKeep].library != null) {\n      layer.setSharedStyle(foreignStyle.localSharedStyle());\n    }\n    else {\n      layer.setSharedStyle(currentSelectedStyles[styleToKeep].layerStyle);\n    }\n\n    layersChangedCounter++;\n  });\n\n  overridesChangedCounter += UpdateLayerOverrides(currentSelectedStyles, styleToKeep, context, foreignStyle);\n\n  currentSelectedStyles.forEach(function (style) {\n    if (style.layerStyle != currentSelectedStyles[styleToKeep].layerStyle) {\n\n      if (style.foreign && (style.library == null)) {\n        if (context.document.documentData().foreignLayerStyles().indexOf(style.originalStyle) > -1) {\n          context.document.documentData().foreignLayerStyles().removeObject(style.originalStyle);\n        }\n\n        if (style.correlativeStyles != null) {\n          for (var i = 0; i < style.correlativeStyles.length; i++) {\n            if (context.document.documentData().foreignLayerStyles().indexOf(style.correlativeStyles[i]) > -1) {\n              context.document.documentData().foreignLayerStyles().removeObject(style.correlativeStyles[i]);\n            }\n          }\n        }\n      }\n      else {\n        context.document.documentData().layerStyles().removeSharedStyle(style.layerStyle);\n      }\n    }\n  });\n\n  return [layersChangedCounter, overridesChangedCounter];\n}\n\nfunction UpdateLayerOverrides(currentSelectedStyles, styleToKeep, context, foreignStyle) {\n\n  var overridesChangedCounter = 0;\n  var allSymbolInstances = NSMutableArray.array();\n  context.document.documentData().allSymbols().forEach(function (symbolMaster) {\n    var instances = Helpers.getSymbolInstances(context, symbolMaster),\n      instanceLoop = instances.objectEnumerator(),\n      instance;\n\n    while (instance = instanceLoop.nextObject()) {\n      allSymbolInstances.addObject(instance);\n    }\n  });\n\n  allSymbolInstances.forEach(function (symbolInstance) {\n    var overridePointsToReplace = [];\n    var overrides = symbolInstance.overrides();\n\n    symbolInstance.availableOverrides().forEach(function (availableOverride) {\n\n      var allOverridesThatWeShouldReplace = [];\n\n      getAllLayerOverridesThatWeShouldReplace(availableOverride, currentSelectedStyles, styleToKeep, allOverridesThatWeShouldReplace, symbolInstance, 0, context);\n\n      for (var i = 0; i < allOverridesThatWeShouldReplace.length; i++) {\n        if (currentSelectedStyles[styleToKeep].foreign && currentSelectedStyles[styleToKeep].library != null) {\n          symbolInstance.setValue_forOverridePoint_(foreignStyle.localSharedStyle().objectID(), allOverridesThatWeShouldReplace[i].overridePoint());\n        }\n        else {\n          symbolInstance.setValue_forOverridePoint_(currentSelectedStyles[styleToKeep].layerStyle.objectID(), allOverridesThatWeShouldReplace[i].overridePoint());\n        }\n\n        overridesChangedCounter++;\n      }\n    });\n  });\n\n  return overridesChangedCounter;\n}\n\nfunction getAllLayerOverridesThatWeShouldReplace(availableOverride, currentSelectedStyles, styleToKeep, allOverridesThatWeShouldReplace, symbolInstance, level, context) {\n  var verbose = false;\n\n  if (verbose) console.log(symbolInstance.name() + \"(\" + level + \")\" + \": ---   Name:\" + availableOverride.overridePoint().layerName() + \"    -    CV:\" + availableOverride.currentValue() + \"   -   DV:\" + availableOverride.defaultValue());\n\n  if (availableOverride.children() == null) {\n    currentSelectedStyles.forEach(function (style) {\n      if (style.layerStyle != currentSelectedStyles[styleToKeep].layerStyle) {\n        if (Helpers.isString(availableOverride.currentValue())) {\n          if ((availableOverride.currentValue().toString().indexOf(style.layerStyle.objectID()) > -1)\n            || (style.originalStyle != null && (availableOverride.currentValue().toString().indexOf(style.originalStyle.localShareID()) > -1))\n            || (style.originalStyle != null && (availableOverride.currentValue().toString().indexOf(style.originalStyle.remoteShareID()) > -1))\n          ) {\n            if (verbose) console.log(\"Adding it\");\n            allOverridesThatWeShouldReplace.push(availableOverride);\n          }\n\n          if (style.correlativeStyles != null) {\n\n            if (verbose) console.log(\"Checking overrides: \" + style.name + \" has \" + style.correlativeStyles.length + \" correlative styles.\")\n            for (var i = 0; i < style.correlativeStyles.length; i++) {\n              if ((availableOverride.currentValue().toString().indexOf(style.correlativeStyles[i].localObject().objectID()) > -1)\n                || (style.originalStyle != null && (availableOverride.currentValue().toString().indexOf(style.correlativeStyles[i].localShareID()) > -1))\n                || (style.originalStyle != null && (availableOverride.currentValue().toString().indexOf(style.correlativeStyles[i].remoteShareID()) > -1))\n              ) {\n                if (verbose) console.log(\"Adding it - correlative\");\n                allOverridesThatWeShouldReplace.push(availableOverride);\n              }\n            }\n          }\n        }\n      }\n    });\n  }\n  else {\n    if (verbose) console.log(\"Digging deeper because it has \" + availableOverride.children().length + \" children\");\n    availableOverride.children().forEach(function (child) {\n      getAllLayerOverridesThatWeShouldReplace(child, currentSelectedStyles, styleToKeep, allOverridesThatWeShouldReplace, symbolInstance, level + 1, context)\n    });\n  }\n}\n\nfunction getDuplicateLayerStyles(context, allStyles) {\n\n  var layerStylesNames = [];\n  var layerDuplicatedStylesNames = [];\n\n  for (var i = 0; i < allStyles.length; i++) {\n    var style = allStyles[i];\n\n    if (Helpers.getIndexOf(style.name, layerStylesNames) > -1) {\n      if (Helpers.getIndexOf(style.name, layerDuplicatedStylesNames) < 0) {\n        layerDuplicatedStylesNames.push(style.name);\n      }\n    }\n\n    layerStylesNames.push(style.name);\n  }\n\n  return layerDuplicatedStylesNames;\n\n}\n\n\nexport function MergeDuplicateLayerStyles(context) {\n\n  Helpers.clog(\"----- Sync layer styles -----\");\n\n  const options = {\n    identifier: webviewMDLSIdentifier,\n    width: 1200,\n    height: 700,\n    show: false,\n    remembersWindowFrame: true,\n    titleBarStyle: 'hidden'\n  }\n  const browserWindow = new BrowserWindow(options);\n  const webContents = browserWindow.webContents;\n\n  var onlyDuplicatedLayerStyles;\n  var mergeSession = [];\n  CalculateDuplicates(true);\n\n  if (onlyDuplicatedLayerStyles.length > 0) {\n    browserWindow.loadURL(require('../resources/mergeduplicatelayerstyles.html'));\n  }\n  else {\n    context.document.showMessage(\"Looks like there are no layer styles to sync.\");\n    onShutdown(webviewMDLSIdentifier);\n  }\n\n  function CalculateDuplicates() {\n    Helpers.clog(\"Finding duplicate layer styles.\");\n    onlyDuplicatedLayerStyles = Helpers.getDuplicateLayerStyles(context);\n    if (onlyDuplicatedLayerStyles.length > 0) {\n      Helpers.GetSpecificLayerStyleData(context, onlyDuplicatedLayerStyles, 0);\n      mergeSession = [];\n      for (var i = 0; i < onlyDuplicatedLayerStyles.length; i++) {\n        mergeSession.push({\n          \"layerStyleWithDuplicates\": onlyDuplicatedLayerStyles[i],\n          \"selectedIndex\": -1,\n          \"isUnchecked\": false,\n          \"isProcessed\": (i == 0) ? true : false\n        });\n      }\n    }\n  }\n\n  browserWindow.once('ready-to-show', () => {\n    browserWindow.show()\n  })\n\n  webContents.on('did-finish-load', () => {\n    Helpers.clog(\"Webview loaded\");\n    webContents.executeJavaScript(`DrawStylesList(${JSON.stringify(mergeSession)})`).catch(console.error);\n  })\n\n  webContents.on('nativeLog', s => {\n    Helpers.clog(s);\n  });\n\n  webContents.on('Cancel', () => {\n    onShutdown(webviewMDLSIdentifier);\n  });\n\n  webContents.on('GetSelectedStyleData', (index) => {\n    Helpers.GetSpecificLayerStyleData(context, onlyDuplicatedLayerStyles, index);\n    webContents.executeJavaScript(`ReDrawAfterGettingData(${JSON.stringify(mergeSession[index].layerStyleWithDuplicates)},${index})`).catch(console.error);\n  });\n\n  webContents.on('ExecuteMerge', (editedMergeSession) => {\n    Helpers.clog(\"Executing Merge\");\n\n    var duplicatesSolved = 0;\n    var mergedStyles = 0;\n    var affectedLayers = [0, 0];\n\n    for (var i = 0; i < editedMergeSession.length; i++) {\n      Helpers.clog(\"-- Merging \" + mergeSession[i].layerStyleWithDuplicates.name);\n      if (!editedMergeSession[i].isUnchecked && editedMergeSession[i].selectedIndex >= 0) {\n        mergeSession[i].selectedIndex = editedMergeSession[i].selectedIndex;\n        currentSelectedStyles = [];\n        for (var j = 0; j < mergeSession[i].layerStyleWithDuplicates.duplicates.length; j++) {\n          currentSelectedStyles.push(mergeSession[i].layerStyleWithDuplicates.duplicates[j]);\n          mergedStyles++;\n        }\n\n        var results = MergeLayerStyles(context, editedMergeSession[i].selectedIndex);\n        affectedLayers[0] += results[0];\n        affectedLayers[1] += results[1];\n\n        duplicatesSolved++;\n      }\n    }\n\n    onShutdown(webviewMDLSIdentifier);\n    if (duplicatesSolved <= 0) {\n      Helpers.clog(\"No styles were merged\");\n      context.document.showMessage(\"No styles were replaced.\");\n    }\n    else {\n      Helpers.clog(\"Wpdated \" + affectedLayers[0] + \" text layers and \" + affectedLayers[1] + \" overrides.\");\n      context.document.showMessage(\"Yo ho! We updated \" + affectedLayers[0] + \" layers and \" + affectedLayers[1] + \" overrides.\");\n    }\n\n  });\n};\n\n","import BrowserWindow from 'sketch-module-web-view'\nimport { getWebview } from 'sketch-module-web-view/remote'\nconst Helpers = require(\"./Helpers\");\n\nconst webviewMDTSIdentifier = 'merge-duplicatetextstyles.webview'\n\nvar checkingAlsoLibraries = false;\nvar currentSelectedStyles = [];\n\n\nfunction getTextPredicate(style) {\n  var predicate;\n  if (style.originalStyle != null)\n    predicate = NSPredicate.predicateWithFormat(\"(sharedStyle.objectID == %@) OR (sharedStyle.objectID == %@)\", style.originalStyle.localShareID(), style.originalStyle.remoteShareID());\n  else\n    predicate = NSPredicate.predicateWithFormat(\"sharedStyle.objectID == %@\", style.textStyle.objectID());\n\n  return predicate;\n}\n\nfunction MergeTextStyles(context, styleToKeep) {\n  var layersChangedCounter = 0;\n  var overridesChangedCounter = 0;\n\n  Helpers.clog(\"Merging styles. Keep '\" + currentSelectedStyles[styleToKeep].name + \"'\");\n\n  var layers = Helpers.getAllTextLayers(context);\n  var layersWithOtherStyles = NSMutableArray.array();\n  currentSelectedStyles.forEach(function (style) {\n    if (style.textStyle != currentSelectedStyles[styleToKeep].textStyle) {\n      var predicate = getTextPredicate(style),\n        layersWithSameStyle = layers.filteredArrayUsingPredicate(predicate),\n        instanceLoop = layersWithSameStyle.objectEnumerator(),\n        instance;\n\n      while (instance = instanceLoop.nextObject()) {\n        layersWithOtherStyles.addObject(instance);\n      }\n\n      if (style.correlativeStyles != null) {\n        //console.log(style.name+\" has \"+style.correlativeStyles.length+\" correlative styles.\")\n        var countercorrelative = 0;\n        for (var i = 0; i < style.correlativeStyles.length; i++) {\n          var predicateCorrelative = NSPredicate.predicateWithFormat(\"sharedStyle.objectID == %@\", style.correlativeStyles[i].localObject().objectID()),\n            layersWithSameStyleCorrelative = layers.filteredArrayUsingPredicate(predicateCorrelative),\n            instanceLoopCorrelative = layersWithSameStyle.objectEnumerator(),\n            instanceCorrelative;\n\n          while (instanceCorrelative = instanceLoopCorrelative.nextObject()) {\n            layersWithOtherStyles.addObject(instanceCorrelative);\n            countercorrelative++;\n          }\n        }\n\n        //console.log(countercorrelative+\" layers had a correlative style applied\");\n      }\n    }\n  });\n\n  var foreignStyleReference, foreignStyle;\n  if (currentSelectedStyles[styleToKeep].foreign && currentSelectedStyles[styleToKeep].library != null) {\n    foreignStyleReference = MSShareableObjectReference.referenceForShareableObject_inLibrary(currentSelectedStyles[styleToKeep].textStyle, currentSelectedStyles[styleToKeep].library);\n    foreignStyle = AppController.sharedInstance().librariesController().importShareableObjectReference_intoDocument(foreignStyleReference, context.document.documentData());\n  }\n\n  layersWithOtherStyles.forEach(function (layer) {\n    if (currentSelectedStyles[styleToKeep].foreign && currentSelectedStyles[styleToKeep].library != null) {\n      layer.setSharedStyle(foreignStyle.localSharedStyle());\n    }\n    else {\n      layer.setSharedStyle(currentSelectedStyles[styleToKeep].textStyle);\n    }\n\n    layersChangedCounter++;\n  });\n\n\n\n  //overridesChangedCounter += LogTextOverrides(currentSelectedStyles, styleToKeep, context);\n  overridesChangedCounter += UpdateTextOverrides(currentSelectedStyles, styleToKeep, context, foreignStyle);\n\n  currentSelectedStyles.forEach(function (style) {\n    if (style.textStyle != currentSelectedStyles[styleToKeep].textStyle) {\n\n      if (style.foreign && (style.library == null)) {\n        //console.log(\"You're trying to remove a library style\");\n        if (context.document.documentData().foreignTextStyles().indexOf(style.originalStyle) > -1) {\n          context.document.documentData().foreignTextStyles().removeObject(style.originalStyle);\n          //console.log(\"Removed style: \"+style.name);\n        }\n\n        if (style.correlativeStyles != null) {\n          for (var i = 0; i < style.correlativeStyles.length; i++) {\n            if (context.document.documentData().foreignTextStyles().indexOf(style.correlativeStyles[i]) > -1) {\n              context.document.documentData().foreignTextStyles().removeObject(style.correlativeStyles[i]);\n              //console.log(\"Removed correlative\");\n            }\n          }\n        }\n      }\n      else {\n        context.document.documentData().layerTextStyles().removeSharedStyle(style.textStyle);\n        //console.log(\"Removed style: \"+style.name);\n      }\n    }\n  });\n\n  return [layersChangedCounter, overridesChangedCounter];\n}\n\nfunction getAllTextOverridesThatWeShouldReplace(availableOverride, currentSelectedStyles, styleToKeep, allOverridesThatWeShouldReplace, symbolInstance, level, context) {\n\n  //console.log(symbolInstance.name()+\"(\"+level+\")\"+\": ---   Name:\"+availableOverride.overridePoint().layerName()+\"    -    CV:\"+availableOverride.currentValue()+\"   -   DV:\"+availableOverride.defaultValue());\n\n  if (availableOverride.children() == null) {\n    currentSelectedStyles.forEach(function (style) {\n      if (style.textStyle != currentSelectedStyles[styleToKeep].textStyle) {\n        if (Helpers.isString(availableOverride.currentValue())) {\n          if ((availableOverride.currentValue().toString().indexOf(style.textStyle.objectID()) > -1)\n            || (style.originalStyle != null && (availableOverride.currentValue().toString().indexOf(style.originalStyle.localShareID()) > -1))\n            || (style.originalStyle != null && (availableOverride.currentValue().toString().indexOf(style.originalStyle.remoteShareID()) > -1))\n          ) {\n            //console.log(\"Adding it\");\n            allOverridesThatWeShouldReplace.push(availableOverride);\n          }\n\n          if (style.correlativeStyles != null) {\n\n            //console.log(\"Checking overrides: \"+style.name+\" has \"+style.correlativeStyles.length+\" correlative styles.\")\n            for (var i = 0; i < style.correlativeStyles.length; i++) {\n              if ((availableOverride.currentValue().toString().indexOf(style.correlativeStyles[i].localObject().objectID()) > -1)\n                || (style.originalStyle != null && (availableOverride.currentValue().toString().indexOf(style.correlativeStyles[i].localShareID()) > -1))\n                || (style.originalStyle != null && (availableOverride.currentValue().toString().indexOf(style.correlativeStyles[i].remoteShareID()) > -1))\n              ) {\n                //console.log(\"Adding it - correlative\");\n                allOverridesThatWeShouldReplace.push(availableOverride);\n              }\n            }\n          }\n        }\n      }\n    });\n  }\n  else {\n    //console.log(\"Digging deeper because it has \"+availableOverride.children().length+\" children\");\n    availableOverride.children().forEach(function (child) {\n      getAllTextOverridesThatWeShouldReplace(child, currentSelectedStyles, styleToKeep, allOverridesThatWeShouldReplace, symbolInstance, level + 1, context)\n    });\n  }\n}\n\nfunction UpdateTextOverrides(currentSelectedStyles, styleToKeep, context, foreignStyle) {\n\n  var overridesChangedCounter = 0;\n  var allSymbolInstances = NSMutableArray.array();\n  context.document.documentData().allSymbols().forEach(function (symbolMaster) {\n    var instances = Helpers.getSymbolInstances(context, symbolMaster),\n      instanceLoop = instances.objectEnumerator(),\n      instance;\n\n    while (instance = instanceLoop.nextObject()) {\n      allSymbolInstances.addObject(instance);\n    }\n  });\n\n  allSymbolInstances.forEach(function (symbolInstance) {\n    var overridePointsToReplace = [];\n    var overrides = symbolInstance.overrides();\n\n    symbolInstance.availableOverrides().forEach(function (availableOverride) {\n\n      var allOverridesThatWeShouldReplace = [];\n\n      getAllTextOverridesThatWeShouldReplace(availableOverride, currentSelectedStyles, styleToKeep, allOverridesThatWeShouldReplace, symbolInstance, 0, context);\n      //console.log(allOverridesThatWeShouldReplace);\n\n      for (var i = 0; i < allOverridesThatWeShouldReplace.length; i++) {\n        if (currentSelectedStyles[styleToKeep].foreign && currentSelectedStyles[styleToKeep].library != null) {\n          symbolInstance.setValue_forOverridePoint_(foreignStyle.localSharedStyle().objectID(), allOverridesThatWeShouldReplace[i].overridePoint());\n        }\n        else {\n          symbolInstance.setValue_forOverridePoint_(currentSelectedStyles[styleToKeep].textStyle.objectID(), allOverridesThatWeShouldReplace[i].overridePoint());\n        }\n\n        overridesChangedCounter++;\n      }\n    });\n  });\n\n  return overridesChangedCounter;\n}\n\nfunction getDuplicateTextStyles(context, allStyles) {\n\n  var textStylesNames = [];\n  var layerDuplicatedStylesNames = [];\n\n  for (var i = 0; i < allStyles.length; i++) {\n    var style = allStyles[i];\n\n    if (Helpers.getIndexOf(style.name, textStylesNames) > -1) {\n      if (Helpers.getIndexOf(style.name, layerDuplicatedStylesNames) < 0) {\n        layerDuplicatedStylesNames.push(style.name);\n      }\n    }\n\n    textStylesNames.push(style.name);\n  }\n\n  return layerDuplicatedStylesNames;\n\n}\n\nexport function MergeDuplicateTextStyles(context) {\n\n  Helpers.clog(\"----- Sync text styles -----\");\n\n  const options = {\n    identifier: webviewMDTSIdentifier,\n    width: 1200,\n    height: 700,\n    show: false,\n    remembersWindowFrame: true,\n    titleBarStyle: 'hidden'\n  }\n  const browserWindow = new BrowserWindow(options);\n  const webContents = browserWindow.webContents;\n\n  var onlyDuplicatedTextStyles;\n  var mergeSession = [];\n\n\n  CalculateDuplicates();\n\n  if (onlyDuplicatedTextStyles.length > 0) {\n    browserWindow.loadURL(require('../resources/mergeduplicatetextstyles.html'));\n  }\n  else {\n    context.document.showMessage(\"Looks like there are no text styles to sync.\");\n    onShutdown(webviewMDTSIdentifier);\n  }\n\n  function CalculateDuplicates() {\n    Helpers.clog(\"Finding duplicate text styles.\");\n\n    onlyDuplicatedTextStyles = Helpers.getDuplicateTextStyles(context);\n    if (onlyDuplicatedTextStyles.length > 0) {\n\n      Helpers.GetSpecificTextStyleData(context, onlyDuplicatedTextStyles, 0);\n      mergeSession = [];\n      for (var i = 0; i < onlyDuplicatedTextStyles.length; i++) {\n        mergeSession.push({\n          \"textStyleWithDuplicates\": onlyDuplicatedTextStyles[i],\n          \"selectedIndex\": -1,\n          \"isUnchecked\": false,\n          \"isProcessed\": (i == 0) ? true : false\n        });\n      }\n    }\n  }\n\n  browserWindow.once('ready-to-show', () => {\n    browserWindow.show()\n  })\n\n  webContents.on('did-finish-load', () => {\n    Helpers.clog(\"Webview loaded\");\n    webContents.executeJavaScript(`DrawStylesList(${JSON.stringify(mergeSession)}, ${Helpers.getLibrariesEnabled()})`).catch(console.error);\n  })\n\n  webContents.on('nativeLog', s => {\n    Helpers.clog(s);\n  });\n\n  webContents.on('Cancel', () => {\n    onShutdown(webviewMDTSIdentifier);\n  });\n\n\n  webContents.on('GetSelectedStyleData', (index) => {\n    Helpers.GetSpecificTextStyleData(context, onlyDuplicatedTextStyles, index);\n    webContents.executeJavaScript(`ReDrawAfterGettingData(${JSON.stringify(mergeSession[index].textStyleWithDuplicates)},${index})`).catch(console.error);\n  });\n\n  webContents.on('ExecuteMerge', (editedMergeSession) => {\n    Helpers.clog(\"Executing Merge\");\n    var duplicatesSolved = 0;\n    var mergedStyles = 0;\n    var affectedLayers = [0, 0];\n\n    for (var i = 0; i < editedMergeSession.length; i++) {\n      Helpers.clog(\"-- Merging \" + mergeSession[i].textStyleWithDuplicates.name);\n      if (!editedMergeSession[i].isUnchecked && editedMergeSession[i].selectedIndex >= 0) {\n        mergeSession[i].selectedIndex = editedMergeSession[i].selectedIndex;\n        currentSelectedStyles = [];\n        for (var j = 0; j < mergeSession[i].textStyleWithDuplicates.duplicates.length; j++) {\n          currentSelectedStyles.push(mergeSession[i].textStyleWithDuplicates.duplicates[j]);\n          mergedStyles++;\n        }\n\n        var results = MergeTextStyles(context, editedMergeSession[i].selectedIndex);\n        affectedLayers[0] += results[0];\n        affectedLayers[1] += results[1];\n\n        duplicatesSolved++;\n      }\n    }\n\n    onShutdown(webviewMDTSIdentifier);\n    if (duplicatesSolved <= 0) {\n      Helpers.clog(\"No styles were merged\");\n      context.document.showMessage(\"No styles were replaced.\");\n    }\n    else {\n      Helpers.clog(\"Updated \" + affectedLayers[0] + \" text layers and \" + affectedLayers[1] + \" overrides.\");\n      context.document.showMessage(\"Yo ho! We updated \" + affectedLayers[0] + \" text layers and \" + affectedLayers[1] + \" overrides.\");\n    }\n\n  });\n};\n","module.exports = require(\"buffer\");","module.exports = require(\"events\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}